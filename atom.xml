<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>KevinMkY&#39;s Blog</title>
  <subtitle>iOS Programm🐒</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2016-03-15T08:13:38.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>KevinMkY</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>分类方法tips</title>
    <link href="http://yoursite.com/2016/03/15/%E5%88%86%E7%B1%BB%E6%96%B9%E6%B3%95tips/"/>
    <id>http://yoursite.com/2016/03/15/分类方法tips/</id>
    <published>2016-03-15T08:01:39.000Z</published>
    <updated>2016-03-15T08:13:38.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;#分类方法tips&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;分类的优点&quot;&gt;&lt;a href=&quot;#分类的优点&quot; class=&quot;headerlink&quot; title=&quot;分类的优点&quot;&gt;&lt;/a&gt;分类的优点&lt;/h1&gt;&lt;p&gt;分类可以拓展原有类,而不破坏原有类的结构和逻辑.便于团队合作&lt;/p&gt;
&lt;p&gt;分类添加的方法对于当前类和子类都可以访问.&lt;/p&gt;
&lt;h1 id=&quot;分类的特点&quot;&gt;&lt;a href=&quot;#分类的特点&quot; class=&quot;headerlink&quot; title=&quot;分类的特点&quot;&gt;&lt;/a&gt;分类的特点&lt;/h1&gt;&lt;p&gt;如果多个分类实现了同样的方法,那么最后编译的分类会覆盖之前编译的分类,被链接到编译后的文件里去.对于这个类来说,分类方法就是全局方法&lt;/p&gt;
&lt;p&gt;这时候所有该分类的原有类别和其子类都会调用该分类里实现的方法.&lt;/p&gt;
&lt;h1 id=&quot;为何分类里不要重写系统的方法&quot;&gt;&lt;a href=&quot;#为何分类里不要重写系统的方法&quot; class=&quot;headerlink&quot; title=&quot;为何分类里不要重写系统的方法&quot;&gt;&lt;/a&gt;为何分类里不要重写系统的方法&lt;/h1&gt;&lt;p&gt;因为 iOS 有很多方法也是用分类实现的,如果我们重写了系统的方法,根据第二条原则,最后编译的是我们的分类(系统的分类在我们之前编译,所以方法被覆盖了),这时候系统调用该方法时候会调用错误的实现.极易出 BUG&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;#分类方法tips&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>一台电脑使用多个 SSH 授权</title>
    <link href="http://yoursite.com/2016/02/29/%E4%B8%80%E5%8F%B0%E7%94%B5%E8%84%91%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA-SSH-%E6%8E%88%E6%9D%83/"/>
    <id>http://yoursite.com/2016/02/29/一台电脑使用多个-SSH-授权/</id>
    <published>2016-02-29T09:09:22.000Z</published>
    <updated>2016-03-02T08:08:27.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一-新建SSH-key：&quot;&gt;&lt;a href=&quot;#一-新建SSH-key：&quot; class=&quot;headerlink&quot; title=&quot;一.新建SSH key：&quot;&gt;&lt;/a&gt;一.新建SSH key：&lt;/h1&gt;&lt;h2 id=&quot;先进到对应目录&quot;&gt;&lt;a href=&quot;#先进到对应目录&quot; class=&quot;headerlink&quot; title=&quot;先进到对应目录&quot;&gt;&lt;/a&gt;先进到对应目录&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;$cd~/.ssh&lt;br&gt;$ssh-keygen -t rsa -C”your@email.com”&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;需要分别生成3对私钥-amp-公钥-而且分别命名好&quot;&gt;&lt;a href=&quot;#需要分别生成3对私钥-amp-公钥-而且分别命名好&quot; class=&quot;headerlink&quot; title=&quot;需要分别生成3对私钥&amp;amp;公钥,而且分别命名好&quot;&gt;&lt;/a&gt;需要分别生成3对私钥&amp;amp;公钥,而且分别命名好&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;github&lt;/li&gt;
&lt;li&gt;公司的&lt;/li&gt;
&lt;li&gt;oschina&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;注意名字&quot;&gt;&lt;a href=&quot;#注意名字&quot; class=&quot;headerlink&quot; title=&quot;注意名字&quot;&gt;&lt;/a&gt;注意名字&lt;/h2&gt;&lt;p&gt;Enter fileinwhichto save the key (/c/Users/Administrator/.ssh/id_rsa):id_rsa_XXX&lt;/p&gt;
&lt;h1 id=&quot;二-生成-config-文件&quot;&gt;&lt;a href=&quot;#二-生成-config-文件&quot; class=&quot;headerlink&quot; title=&quot;二.生成 config 文件&quot;&gt;&lt;/a&gt;二.生成 config 文件&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;$touch config&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/ssh%2F1.png&quot; width=&quot;219&quot; &quot;=&quot;&quot; height=&quot;“294&quot;&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;然后将下列内容拷贝进去-注意如果有红色下划线表示拷贝有问题-自己要重新输入下&quot;&gt;&lt;a href=&quot;#然后将下列内容拷贝进去-注意如果有红色下划线表示拷贝有问题-自己要重新输入下&quot; class=&quot;headerlink&quot; title=&quot;然后将下列内容拷贝进去(注意如果有红色下划线表示拷贝有问题,自己要重新输入下)&quot;&gt;&lt;/a&gt;然后将下列内容拷贝进去(注意如果有红色下划线表示拷贝有问题,自己要重新输入下)&lt;/h2&gt;&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;Host github&lt;span class=&quot;selector-class&quot;&gt;.com&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  HostName github&lt;span class=&quot;selector-class&quot;&gt;.com&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  User git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  IdentityFile ~/.ssh/github_rsa&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;Host oschina&lt;span class=&quot;selector-class&quot;&gt;.net&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  HostName git&lt;span class=&quot;selector-class&quot;&gt;.oschina&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.net&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  User git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  IdentityFile ~/.ssh/id_rsa_oschina&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/ssh%2F2.png&quot; width=&quot;371&quot; height=&quot;211&quot;&gt;&lt;/p&gt;
&lt;p&gt;此处我省略了公司的,是因为公司的名字为 id_rsa,即是默认的那个&lt;/p&gt;
&lt;h1 id=&quot;三-将pub-的公钥复制到对应网站里的-SSH-处黏贴&quot;&gt;&lt;a href=&quot;#三-将pub-的公钥复制到对应网站里的-SSH-处黏贴&quot; class=&quot;headerlink&quot; title=&quot;三.将pub 的公钥复制到对应网站里的 SSH 处黏贴&quot;&gt;&lt;/a&gt;三.将pub 的公钥复制到对应网站里的 SSH 处黏贴&lt;/h1&gt;&lt;h1 id=&quot;四-在命令行测试连接&quot;&gt;&lt;a href=&quot;#四-在命令行测试连接&quot; class=&quot;headerlink&quot; title=&quot;四.在命令行测试连接&quot;&gt;&lt;/a&gt;四.在命令行测试连接&lt;/h1&gt;&lt;figure class=&quot;highlight elixir&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$ &lt;/span&gt;ssh -T git&lt;span class=&quot;variable&quot;&gt;@github&lt;/span&gt;.com&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;回应 : Hi XXX! &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;$ &lt;/span&gt;ssh -T git&lt;span class=&quot;variable&quot;&gt;@git&lt;/span&gt;.oschina.net&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;回应 &lt;span class=&quot;symbol&quot;&gt;:Welcome&lt;/span&gt; to Git&lt;span class=&quot;variable&quot;&gt;@OSC&lt;/span&gt;, XXX!&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;等到上面的回应,则表示成功&lt;/p&gt;
&lt;h1 id=&quot;五-如果还是报错Permission-denied-publickey&quot;&gt;&lt;a href=&quot;#五-如果还是报错Permission-denied-publickey&quot; class=&quot;headerlink&quot; title=&quot;五.如果还是报错Permission denied (publickey).&quot;&gt;&lt;/a&gt;五.如果还是报错&lt;code&gt;Permission denied (publickey).&lt;/code&gt;&lt;/h1&gt;&lt;p&gt;则在命令行瞅瞅目前都有哪些 key 被添加进去了&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;$ssh-add -l&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$&lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;SHA256:&lt;/span&gt;XXX &lt;span class=&quot;regexp&quot;&gt;/Users/&lt;/span&gt;XXX&lt;span class=&quot;regexp&quot;&gt;/.ssh/&lt;/span&gt;id_rsa (RSA)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$&lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;SHA256:&lt;/span&gt;XXX &lt;span class=&quot;regexp&quot;&gt;/Users/&lt;/span&gt;XXX&lt;span class=&quot;regexp&quot;&gt;/.ssh/&lt;/span&gt;github_rsa (RSA)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;$&lt;span class=&quot;number&quot;&gt;2048&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;SHA256:&lt;/span&gt;XXX &lt;span class=&quot;regexp&quot;&gt;/Users/&lt;/span&gt;XXX&lt;span class=&quot;regexp&quot;&gt;/.ssh/&lt;/span&gt;id_rsa_gitoschina (RSA)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;如果没有在里面发现最新创建的 id_rsa 文件,则主动添加进去&lt;/p&gt;
&lt;figure class=&quot;highlight gams&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&lt;span class=&quot;meta-keyword&quot;&gt;$ssh&lt;/span&gt;-add /Users/XXX/.ssh/id_rsa_gitoschina&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;并且和上面写的 &lt;code&gt;config&lt;/code&gt; 里的文件名对应好&lt;/p&gt;
&lt;p&gt;再重复步骤四测试连接&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一-新建SSH-key：&quot;&gt;&lt;a href=&quot;#一-新建SSH-key：&quot; class=&quot;headerlink&quot; title=&quot;一.新建SSH key：&quot;&gt;&lt;/a&gt;一.新建SSH key：&lt;/h1&gt;&lt;h2 id=&quot;先进到对应目录&quot;&gt;&lt;a href=&quot;#先进到对应目
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>crash 日志解析</title>
    <link href="http://yoursite.com/2016/01/27/crash-%E6%97%A5%E5%BF%97%E8%A7%A3%E6%9E%90/"/>
    <id>http://yoursite.com/2016/01/27/crash-日志解析/</id>
    <published>2016-01-27T08:13:17.000Z</published>
    <updated>2016-02-01T06:51:29.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;作为一个程序员,和八阿哥(BUG) 打交道是家常便饭,而苹果也帮我们生成了很多 crash 日志来帮助我们分析错误的产生.&lt;/p&gt;
&lt;p&gt;下面主要说说如何用辅助工具&lt;code&gt;symbolicatecrash&lt;/code&gt;通过分析&lt;code&gt;dSYM&lt;/code&gt;等文件产生有用的 log 日志&lt;/p&gt;
&lt;h1 id=&quot;获取工具-文件&quot;&gt;&lt;a href=&quot;#获取工具-文件&quot; class=&quot;headerlink&quot; title=&quot;获取工具/文件&quot;&gt;&lt;/a&gt;获取工具/文件&lt;/h1&gt;&lt;p&gt;先去应用程序–&amp;gt; Xocde–&amp;gt;右键显示报内容,然后根据下面图片显示,一步一步找到&lt;code&gt;symbolicatecrash&lt;/code&gt;文件,接下来,咱们把它备份到桌面的新建文件夹里去.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-0.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-1.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;日志文件&quot;&gt;&lt;a href=&quot;#日志文件&quot; class=&quot;headerlink&quot; title=&quot;日志文件&quot;&gt;&lt;/a&gt;日志文件&lt;/h2&gt;&lt;p&gt;将真机连接 Xcode, 然后按照如下的方式获取 carsh 日志文件&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-2.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;dSYM&quot;&gt;&lt;a href=&quot;#dSYM&quot; class=&quot;headerlink&quot; title=&quot;dSYM&quot;&gt;&lt;/a&gt;dSYM&lt;/h2&gt;&lt;p&gt;debugging SYMbols,又称为调试符号表，是苹果为了方便调试和定位问题而使用的一种调试方案，本质上使用的是起源于贝尔实验室的DWARF（Debugging With Attributed Record Formats).&lt;/p&gt;
&lt;p&gt;对我们分析 crash 起到作用的其实是子目录&lt;code&gt;Contents--Resources--DWARF&lt;/code&gt;下的与 App 同名的文件,咱们也把这个单独拷贝出来备用&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-6.png&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;app&quot;&gt;&lt;a href=&quot;#app&quot; class=&quot;headerlink&quot; title=&quot;app&quot;&gt;&lt;/a&gt;app&lt;/h2&gt;&lt;p&gt; 这个就不用多说了, ipa&lt;/p&gt;
&lt;h2 id=&quot;存档每次发布的xcarchive&quot;&gt;&lt;a href=&quot;#存档每次发布的xcarchive&quot; class=&quot;headerlink&quot; title=&quot;存档每次发布的xcarchive&quot;&gt;&lt;/a&gt;存档每次发布的&lt;code&gt;xcarchive&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;咱们分析crash, 同时具备了&lt;code&gt;crash日志文件&lt;/code&gt;, &lt;code&gt;dSYM&lt;/code&gt;,&lt;code&gt;app&lt;/code&gt;这3个东西才能开始分析.而 &lt;code&gt;dSYM&lt;/code&gt; 和 &lt;code&gt;app&lt;/code&gt; 都在我们的&lt;code&gt;xcarchive&lt;/code&gt;文件里解包可以得到,这就是为什么我们一定要在每次发布版本的时候,将 xcode 自动生成的&lt;code&gt;xcarchive&lt;/code&gt;文件保存/归档.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-7.png&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;解析过程&quot;&gt;&lt;a href=&quot;#解析过程&quot; class=&quot;headerlink&quot; title=&quot;解析过程&quot;&gt;&lt;/a&gt;解析过程&lt;/h1&gt;&lt;p&gt;等如下文件齐全了,咱们就可以开始解析了&lt;/p&gt;
&lt;p&gt;1.cd 到下面几个文件的目录下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-4.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;2.输入命令行, XXX.log 或者 XXX.crash,表示将结果输出到 a.log 文件,注意空格&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;./symbolicatecrash /ABC/iWeidao.crash /ABC/iWeidao.app.dSYM &amp;gt; a.log&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;3.打开 a.log, 查看&lt;code&gt;Last exception&lt;/code&gt;,忽略系统自己的模块/库,将我们自己模块儿的地址纪录下来,此处是 0x100050000),后面多处会用到,&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160127-8.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;4.利用&lt;code&gt;atos&lt;/code&gt;方法,输入模块地址,进入调试模式,注意&lt;code&gt;armv7 , arm64&lt;/code&gt;,根据环境选择一个即可):&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$atos -o iWeidao -arch armv7 -l 0x100050000,然后回车&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;5.此步无报错可忽略,直接进入6 &lt;/p&gt;
&lt;p&gt;假如报错 &lt;code&gt;DEVELOPER_XXX&lt;/code&gt; 什么的,输入如下命令,注意 &lt;code&gt;Xcode.app&lt;/code&gt; 是与你应用程序里 Xcode 的名称一致的.命令行如下:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$export DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;6.将&lt;code&gt;a.log&lt;/code&gt;里每一处自己项目模块崩溃的地址依次输入进去,比如上图里的&lt;code&gt;0x100581ea8&lt;/code&gt; &lt;code&gt;0x100569e6c&lt;/code&gt;,每输入一次并回车,命令行都会返回当前崩溃所在行 ,比如&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2F112.jpg&quot;&gt;&lt;/p&gt;
&lt;p&gt;即可看到具体崩溃所在文件,所在行&lt;/p&gt;
&lt;h1 id=&quot;比较-UUID&quot;&gt;&lt;a href=&quot;#比较-UUID&quot; class=&quot;headerlink&quot; title=&quot;比较 UUID&quot;&gt;&lt;/a&gt;比较 UUID&lt;/h1&gt;&lt;p&gt;有个童鞋问我,如何知道产生crash 日志和咱们分析的dSYM 包是不是同一个,那么,过程如下:&lt;/p&gt;
&lt;p&gt;1.查看 crash 日志那个包的 UUID&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160201-0.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;2.查看咱们包的 UUID&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;$dwarfdump –uuid app.dSYM&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;结果如下:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/crash%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%2FQQ20160201-0%402x.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;这时候一个是大写,一个是小写,转化后如果是一致的,则表示是同一个包啦~&lt;/p&gt;
&lt;h1 id=&quot;谢谢&quot;&gt;&lt;a href=&quot;#谢谢&quot; class=&quot;headerlink&quot; title=&quot;谢谢&quot;&gt;&lt;/a&gt;谢谢&lt;/h1&gt;&lt;p&gt;这只能帮助我们定位,缩小范围,具体的情况还得靠程序猿们自己努力~fighting~&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;作为一个程序员,和八阿哥(BUG) 打交道是家常便饭,而苹果也帮我们生成了很多 crash 日志来帮助我们分析错误的产生.&lt;/p&gt;
&lt;p&gt;下
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>iOS 自定义相机, UIImagePickerController &amp;&amp; AVCaptureSession (附微信小视频模仿demo)</title>
    <link href="http://yoursite.com/2016/01/04/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%B8%E6%9C%BA/"/>
    <id>http://yoursite.com/2016/01/04/自定义相机/</id>
    <published>2016-01-04T06:05:14.000Z</published>
    <updated>2016-01-18T10:54:16.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;iOS 自定义相机, UIImagePickerController &amp;amp;&amp;amp; AVCaptureSession (附微信小视频模仿demo)&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;序&quot;&gt;&lt;a href=&quot;#序&quot; class=&quot;headerlink&quot; title=&quot;序&quot;&gt;&lt;/a&gt;序&lt;/h1&gt;&lt;p&gt;今天介绍自定义相机的两种方式,一种是&lt;code&gt;UIImagePickerController&lt;/code&gt;,一种是&lt;code&gt;AVCaptureSession&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&quot;UIImagePickerController&quot;&gt;&lt;a href=&quot;#UIImagePickerController&quot; class=&quot;headerlink&quot; title=&quot;UIImagePickerController&quot;&gt;&lt;/a&gt;UIImagePickerController&lt;/h2&gt;&lt;p&gt;&lt;code&gt;UIImagePickerController&lt;/code&gt;非常方便简单,是苹果自己封装好了的一套API,效果如下:&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%B8%E6%9C%BA%2FIMG_2768.PNG&quot; width=&quot;375&quot; height=&quot;667&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;AVCaptureSession&quot;&gt;&lt;a href=&quot;#AVCaptureSession&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureSession&quot;&gt;&lt;/a&gt;AVCaptureSession&lt;/h2&gt;&lt;p&gt;但是上面的 API只能进行简单的相机视图修改,有时无法满足我们的需求.例如我们需要更加复杂的&lt;code&gt;OverlayerView&lt;/code&gt;(自定义相机视图)，这时候我们就要自定义一个相机了.&lt;code&gt;AVCaptureSession&lt;/code&gt;能帮助我们.&lt;/p&gt;
&lt;h1 id=&quot;code&quot;&gt;&lt;a href=&quot;#code&quot; class=&quot;headerlink&quot; title=&quot;code&quot;&gt;&lt;/a&gt;code&lt;/h1&gt;&lt;p&gt;心急的人,完整Demo在最下边儿.其他朋友可依次看下去&lt;/p&gt;
&lt;h2 id=&quot;UIImagePickerController-1&quot;&gt;&lt;a href=&quot;#UIImagePickerController-1&quot; class=&quot;headerlink&quot; title=&quot;UIImagePickerController&quot;&gt;&lt;/a&gt;UIImagePickerController&lt;/h2&gt;&lt;h3 id=&quot;属性&quot;&gt;&lt;a href=&quot;#属性&quot; class=&quot;headerlink&quot; title=&quot;属性&quot;&gt;&lt;/a&gt;属性&lt;/h3&gt;&lt;p&gt;首先看到,需要遵守的协议有2个,分别是&lt;code&gt;UINavigationControllerDelegate&lt;/code&gt;和&lt;code&gt;UIImagePickerControllerDelegate&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt;)      &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; &amp;lt;&lt;span class=&quot;built_in&quot;&gt;UINavigationControllerDelegate&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerDelegate&lt;/span&gt;&amp;gt; delegate;	&lt;span class=&quot;comment&quot;&gt;//需要遵守的协议有2个&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;还有一些基本设置,如输入源/媒体类型,还有&lt;code&gt;allowsEditing&lt;/code&gt;为 YES 即可允许用户拍照后立即进行编辑,并且出现编辑框&lt;br&gt;&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//基本设置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           UIImagePickerControllerSourceType     sourceType;			&lt;span class=&quot;comment&quot;&gt;//图片输入源,相机或者相册,图库&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic,copy)      NSArray&amp;lt;NSString *&amp;gt;                   *mediaTypes;			&lt;span class=&quot;comment&quot;&gt;//媒体类型&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           BOOL                                  allowsEditing 			&lt;span class=&quot;comment&quot;&gt;//是否允许用户编辑&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           BOOL                                  allowsImageEditing 	&lt;span class=&quot;comment&quot;&gt;//废弃,用上面的即可&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这2个属性和视频相关&lt;br&gt;&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           NSTimeInterval                        videoMaximumDuration 	&lt;span class=&quot;comment&quot;&gt;//最长摄制时间&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           UIImagePickerControllerQualityType    videoQuality 			&lt;span class=&quot;comment&quot;&gt;//视频摄制质量&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;这2个和自定义相机视图有关,注意,下面的只有当输入源为&lt;code&gt;UIImagePickerControllerSourceTypeCamera&lt;/code&gt;才可用,否则崩溃&lt;br&gt;&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           BOOL                                  showsCameraControls 	&lt;span class=&quot;comment&quot;&gt;//默认 YES, 设置为 NO 即可关闭所有默认 UI&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nullable, nonatomic,strong) __kindof UIView                *cameraOverlayView  	&lt;span class=&quot;comment&quot;&gt;//自定义相机覆盖视图&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic)           CGAffineTransform                     cameraViewTransform 	&lt;span class=&quot;comment&quot;&gt;//拍摄时屏幕view的transform属性，可以实现旋转，缩放功能&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic) UIImagePickerControllerCameraCaptureMode cameraCaptureMode 			&lt;span class=&quot;comment&quot;&gt;//设置模式为拍照或者摄像&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic) UIImagePickerControllerCameraDevice      cameraDevice      			&lt;span class=&quot;comment&quot;&gt;//默认开启前置/后置摄像头&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;variable&quot;&gt;@property&lt;/span&gt;(nonatomic) UIImagePickerControllerCameraFlashMode   cameraFlashMode				&lt;span class=&quot;comment&quot;&gt;//设置默认的闪光灯模式,有开/关/自动&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;方法&quot;&gt;&lt;a href=&quot;#方法&quot; class=&quot;headerlink&quot; title=&quot;方法&quot;&gt;&lt;/a&gt;方法&lt;/h3&gt;&lt;p&gt;第一个是判断输入源的,一般用来判断是否支持拍照&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerSourceType&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerSourceTypePhotoLibrary&lt;/span&gt;,		&lt;span class=&quot;comment&quot;&gt;//图库&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerSourceTypeCamera&lt;/span&gt;,			&lt;span class=&quot;comment&quot;&gt;//相机--&amp;gt;这个就是拍照&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerSourceTypeSavedPhotosAlbum&lt;/span&gt;	&lt;span class=&quot;comment&quot;&gt;//相册&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isSourceTypeAvailable:(&lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerSourceType&lt;/span&gt;)sourceType;      		&lt;span class=&quot;comment&quot;&gt;//判断是否支持某种输入源&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这个是判断是否支持前/后置摄像头&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerCameraDevice&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerCameraDeviceRear&lt;/span&gt;,			&lt;span class=&quot;comment&quot;&gt;//后置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerCameraDeviceFront&lt;/span&gt;			&lt;span class=&quot;comment&quot;&gt;//前置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)isCameraDeviceAvailable:(&lt;span class=&quot;built_in&quot;&gt;UIImagePickerControllerCameraDevice&lt;/span&gt;)cameraDevice     &lt;span class=&quot;comment&quot;&gt;//是否支持前/后置摄像头&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;拍照/摄像的方法&lt;br&gt;&lt;figure class=&quot;highlight haml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-&lt;span class=&quot;ruby&quot;&gt; (void)takePicture;		&lt;span class=&quot;regexp&quot;&gt;//&lt;/span&gt;手动调取拍照的方法,也可当做&lt;span class=&quot;string&quot;&gt;`-imagePickerController:didFinishPickingMediaWithInfo:`&lt;/span&gt;代理的回调,无法捕捉动态图像&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-&lt;span class=&quot;ruby&quot;&gt; (BOOL)startVideoCapture;	&lt;span class=&quot;regexp&quot;&gt;//&lt;/span&gt;开始摄像&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-&lt;span class=&quot;ruby&quot;&gt; (void)stopVideoCapture;	&lt;span class=&quot;regexp&quot;&gt;//&lt;/span&gt;停止摄像&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;代理相关&quot;&gt;&lt;a href=&quot;#代理相关&quot; class=&quot;headerlink&quot; title=&quot;代理相关&quot;&gt;&lt;/a&gt;代理相关&lt;/h3&gt;&lt;p&gt;注意,&lt;code&gt;UIImagePickerController&lt;/code&gt;不能直接取消,必须在收到以下代理方法后才可以 &lt;code&gt;dismiss&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@protocol&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UIImagePickerControllerDelegate&lt;/span&gt;&amp;lt;&lt;span class=&quot;title&quot;&gt;NSObject&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@optional&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//这个已经废弃了,不用管&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)imagePickerController:(&lt;span class=&quot;built_in&quot;&gt;UIImagePickerController&lt;/span&gt; *)picker didFinishPickingImage:(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)image editingInfo:(&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *,&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;gt; *)editingInfo;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//主要是下面这2个&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//拍照后,点击使用照片和向此选取照片后都会调用以下代理方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)imagePickerController:(&lt;span class=&quot;built_in&quot;&gt;UIImagePickerController&lt;/span&gt; *)picker didFinishPickingMediaWithInfo:(&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *,&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;gt; *)info;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//点击取消的时候会调用,通常在此 dismiss &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)imagePickerControllerDidCancel:(&lt;span class=&quot;built_in&quot;&gt;UIImagePickerController&lt;/span&gt; *)picker;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;保存照片/视频到手机,三个比较重要的方法,记得导入&lt;code&gt;AssetsLibrary.framework&lt;/code&gt;,并且在需要调用存储方法的的地方导入&lt;code&gt;&amp;lt;AssetsLibrary/AssetsLibrary.h&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 将照片保存到相册,回调方法必须用 - (void)image:(UIImage *)image didFinishSavingWithError:(NSError *)error contextInfo:(void *)contextInfo;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIKIT_EXTERN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;UIImageWriteToSavedPhotosAlbum&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image, __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; completionTarget, __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; SEL completionSelector, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; contextInfo);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//是否可以将视频保存到相册,通常在调用下面的方法之前会调用这个&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIKIT_EXTERN&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;UIVideoAtPathIsCompatibleWithSavedPhotosAlbum&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *videoPath) &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;_1);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 将视频保存到相册,回调方法必须用 - (void)video:(NSString *)videoPath didFinishSavingWithError:(NSError *)error contextInfo:(void *)contextInfo; &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIKIT_EXTERN&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;UISaveVideoAtPathToSavedPhotosAlbum&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *videoPath, __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; completionTarget, __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; SEL completionSelector, &lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; * __&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; contextInfo) &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;_1);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;用法如下&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)savePic&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIImageWriteToSavedPhotosAlbum&lt;/span&gt;(imgPath, &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(image:didFinishSavingWithError:contextInfo:), &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;);    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)image:(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)image didFinishSavingWithError:(&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *)error contextInfo:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)contextInfo&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;保存照片过程中发生错误，错误信息:%@&quot;&lt;/span&gt;,error.localizedDescription);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;照片保存成功.&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)saveVideo&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UISaveVideoAtPathToSavedPhotosAlbum&lt;/span&gt;(videoPath,&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;, &lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(video:didFinishSavingWithError:contextInfo:), &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;);&lt;span class=&quot;comment&quot;&gt;//保存视频到相簿    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)video:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)videoPath didFinishSavingWithError:(&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *)error contextInfo:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; *)contextInfo&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;保存视频过程中发生错误，错误信息:%@&quot;&lt;/span&gt;,error.localizedDescription);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;视频保存成功.&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;另外一个是&lt;code&gt;ALAssetsLibrary&lt;/code&gt;,不过在 iOS9.0 已经全部被废弃了,改成了&lt;code&gt;PHPhotoLibrary&lt;/code&gt;(这是 &lt;code&gt;Photos&lt;/code&gt; 框架的一个组成部分,完整的可以&lt;a href=&quot;http://objccn.io/issue-21-4/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;点这个链接&lt;/a&gt;,关于这个框架的用法,改天再写一个吧)&lt;/p&gt;
&lt;p&gt;9.0及以前的写法&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//保存照片到相册&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; [[[ALAssetsLibrary alloc]init] writeImageToSavedPhotosAlbum:[img &lt;span class=&quot;built_in&quot;&gt;CGImage&lt;/span&gt;] orientation:(ALAssetOrientation)img.imageOrientation completionBlock:^(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *assetURL, &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;Save image fail：%@&quot;&lt;/span&gt;,error);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;Save image succeed.&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//保存视频到相册&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[[[ALAssetsLibrary alloc]init] writeVideoAtPathToSavedPhotosAlbum:[&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; URLWithString:videoPath] completionBlock:^(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *assetURL, &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;Save video fail：%@&quot;&lt;/span&gt;,error);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;Save video succeed.&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;AVCaptureSession-1&quot;&gt;&lt;a href=&quot;#AVCaptureSession-1&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureSession&quot;&gt;&lt;/a&gt;AVCaptureSession&lt;/h2&gt;&lt;p&gt;先放上一个微信小视频的模仿 Demo, 因为只能真机,所以比较嘈杂~大家别介意&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/%E5%B0%8F%E8%A7%86%E9%A2%911111.gif&quot; alt=&quot;&quot;&gt; &lt;/p&gt;
&lt;h3 id=&quot;流程&quot;&gt;&lt;a href=&quot;#流程&quot; class=&quot;headerlink&quot; title=&quot;流程&quot;&gt;&lt;/a&gt;流程&lt;/h3&gt;&lt;p&gt;&lt;code&gt;AVCaptureSession&lt;/code&gt;通过把设备的麦克风/摄像头(&lt;code&gt;AVCaptureDevice&lt;/code&gt;)实例化成数据流输入对象(&lt;code&gt;AVCaptureDeviceInput&lt;/code&gt;)后,再通过建立连接(&lt;code&gt;AVCaptionConnection&lt;/code&gt;)将录制数据通过数据流输出对象(&lt;code&gt;AVCaptureOutput&lt;/code&gt;)导出,而录制的时候咱们可以同步预览当前的录制界面(&lt;code&gt;AVCaptureVideoPreviewLayer&lt;/code&gt;).&lt;/p&gt;
&lt;figure class=&quot;highlight autohotkey&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;`AVCaptureSession`是一个会话对象,是设备音频/视频整个录制期间的管理者.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;`AVCaptureDevice`其实是咱们的物理设备映射到程序中的一个对象.咱们可以通过其来操作:闪光灯,手电筒,聚焦模式等&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;`AVCaptureDeviceInput`是录制期间输入流数据的管理对象.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;`AVCaptionConnection`是将输入流/输出流连接起来的连接对象,视频/音频稳定,预览与录制方向一致都在这里设置,还有audioChannels声道&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;`AVCaptureOutput`是输出流数据的管理对象,通过头文件可以看到有很多子类,而我们通常也使用其子类&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;`AVCaptureVideoPreviewLayer`是一个 `CALyer` ,可以让我们预览拍摄过程中的图像&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;详解各部分&quot;&gt;&lt;a href=&quot;#详解各部分&quot; class=&quot;headerlink&quot; title=&quot;详解各部分&quot;&gt;&lt;/a&gt;详解各部分&lt;/h3&gt;&lt;p&gt;此处,咱们就模仿一个微信小视频的 demo, 然后把各个主要步骤写在下面.&lt;/p&gt;
&lt;h4 id=&quot;授权&quot;&gt;&lt;a href=&quot;#授权&quot; class=&quot;headerlink&quot; title=&quot;授权&quot;&gt;&lt;/a&gt;授权&lt;/h4&gt;&lt;p&gt;首先获取授权&lt;code&gt;AVAuthorizationStatus&lt;/code&gt;,我们需要获取哪个设备的使用权限,就进行请求,需要注意的是,如果用户未进行授权授权选择,咱们还要重复请求一次.&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//获取授权&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)getAuthorization&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//此处获取摄像头授权&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; authorizationStatusForMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusAuthorized&lt;/span&gt;:       &lt;span class=&quot;comment&quot;&gt;//已授权，可使用    The client is authorized to access the hardware supporting a media type.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVAuthorizationStatusNotDetermined&lt;/span&gt;:    &lt;span class=&quot;comment&quot;&gt;//未进行授权选择     Indicates that the user has not yet made a choice regarding whether the client can access the hardware.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//则再次请求授权&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; requestAccessForMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; completionHandler:^(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; granted) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(granted)&amp;#123;    &lt;span class=&quot;comment&quot;&gt;//用户授权成功&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;        &lt;span class=&quot;comment&quot;&gt;//用户拒绝授权&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:                                    &lt;span class=&quot;comment&quot;&gt;//用户拒绝授权/未授权&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;相关枚举&lt;/p&gt;
&lt;figure class=&quot;highlight 1c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;/*&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     AVAuthorizationStatusNotDetermined = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;,&lt;span class=&quot;comment&quot;&gt;// 未进行授权选择&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     AVAuthorizationStatusRestricted,　　　　&lt;span class=&quot;comment&quot;&gt;// 未授权，且用户无法更新，如家长控制情况下&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     AVAuthorizationStatusDenied,　　　　　　 &lt;span class=&quot;comment&quot;&gt;// 用户拒绝App使用&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     AVAuthorizationStatusAuthorized,　　　　&lt;span class=&quot;comment&quot;&gt;// 已授权，可使用&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;根据流程创建对象&quot;&gt;&lt;a href=&quot;#根据流程创建对象&quot; class=&quot;headerlink&quot; title=&quot;根据流程创建对象&quot;&gt;&lt;/a&gt;根据流程创建对象&lt;/h4&gt;&lt;h5 id=&quot;AVCaptureSession-2&quot;&gt;&lt;a href=&quot;#AVCaptureSession-2&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureSession&quot;&gt;&lt;/a&gt;AVCaptureSession&lt;/h5&gt;&lt;p&gt;先创建本次小视频的会话对象&lt;code&gt;_captureSession&lt;/code&gt;,设置视频分辨率.注意,这个地方设置的模式/分辨率大小将影响你后面拍摄照片/视频的大小&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addSession&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _captureSession = [[&lt;span class=&quot;built_in&quot;&gt;AVCaptureSession&lt;/span&gt; alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([_captureSession canSetSessionPreset:&lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionPreset640x480&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [_captureSession setSessionPreset:&lt;span class=&quot;built_in&quot;&gt;AVCaptureSessionPreset640x480&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;相关枚举&lt;/p&gt;
&lt;figure class=&quot;highlight dns&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;/*  通常支持如下格式&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; (&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPresetLowQuality,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPreset&lt;span class=&quot;number&quot;&gt;960x540&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPreset&lt;span class=&quot;number&quot;&gt;640x480&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPresetMediumQuality,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPreset&lt;span class=&quot;number&quot;&gt;1920x1080&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPreset&lt;span class=&quot;number&quot;&gt;1280x720&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPresetHighestQuality,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; AVAssetExportPresetAppleM4A&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; )&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;AVCaptureDevice&quot;&gt;&lt;a href=&quot;#AVCaptureDevice&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureDevice&quot;&gt;&lt;/a&gt;AVCaptureDevice&lt;/h5&gt;&lt;p&gt;然后咱们要把设备接入进来了,依次是&lt;code&gt;_videoDevice&lt;/code&gt;和&lt;code&gt;_audioDevice&lt;/code&gt;,还有注意,在给会话信息添加设备对象的时候,需要调用&lt;code&gt;_captureSession&lt;/code&gt;的一个方法组&lt;code&gt;beginConfiguration&lt;/code&gt;和&lt;code&gt;commitConfiguration&lt;/code&gt;,最后,咱们把录制过程中的预览图层&lt;code&gt;PreviewLayer&lt;/code&gt;也添加进来,设置完毕后,开启会话&lt;code&gt;startRunning&lt;/code&gt;–&amp;gt;注意,不等于开始录制,在不再需要使用会话相关时,还需要&lt;code&gt;stopRunning&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight ini&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[_captureSession beginConfiguration]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[self addVideo]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[self addAudio]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[self addPreviewLayer]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[_captureSession commitConfiguration]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;section&quot;&gt;[_captureSession startRunning]&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&quot;video-相关&quot;&gt;&lt;a href=&quot;#video-相关&quot; class=&quot;headerlink&quot; title=&quot;video 相关&quot;&gt;&lt;/a&gt;video 相关&lt;/h6&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addVideo&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 获取摄像头输入设备， 创建 AVCaptureDeviceInput 对象&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _videoDevice = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; deviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; preferringPosition:&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionBack&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addVideoInput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; addMovieOutput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;相关枚举&lt;/p&gt;
&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;/* &lt;span class=&quot;type&quot;&gt;MediaType&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeVideo&lt;/span&gt;                 &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);       //视频&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeAudio&lt;/span&gt;                 &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);       //音频&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeText&lt;/span&gt;                  &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeClosedCaption&lt;/span&gt;         &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeSubtitle&lt;/span&gt;              &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeTimecode&lt;/span&gt;              &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeMetadata&lt;/span&gt;              &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_8, &lt;span class=&quot;number&quot;&gt;6&lt;/span&gt;_0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVF_EXPORT&lt;/span&gt; &lt;span class=&quot;type&quot;&gt;NSString&lt;/span&gt; *const &lt;span class=&quot;type&quot;&gt;AVMediaTypeMuxed&lt;/span&gt;                 &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;_7, &lt;span class=&quot;number&quot;&gt;4&lt;/span&gt;_0);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    /* &lt;span class=&quot;type&quot;&gt;AVCaptureDevicePosition&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     typedef &lt;span class=&quot;type&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;AVCaptureDevicePosition&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVCaptureDevicePositionUnspecified&lt;/span&gt;         = 0,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVCaptureDevicePositionBack&lt;/span&gt;                = 1,            //后置摄像头&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;span class=&quot;type&quot;&gt;AVCaptureDevicePositionFront&lt;/span&gt;               = 2             //前置摄像头&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125; &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(10_7, 4_0) __TVOS_PROHIBITED;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面是获取摄像头的方法&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 获取摄像头--&amp;gt;前/后&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *)deviceWithMediaType:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)mediaType preferringPosition:(&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePosition&lt;/span&gt;)position&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *devices = [&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; devicesWithMediaType:mediaType];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *captureDevice = devices.firstObject;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *device &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; devices ) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ( device.position == position ) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            captureDevice = device;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; captureDevice;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//下面这2个也可以获取前后摄像头,不过有一定的风险,假如手机又问题,找不到对应的 UniqueID 设备,则呵呵了&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//- (AVCaptureDevice *)frontCamera&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    return [AVCaptureDevice deviceWithUniqueID:@&quot;com.apple.avfoundation.avcapturedevice.built-in_video:1&quot;];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//- (AVCaptureDevice *)backCamera&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    return [AVCaptureDevice deviceWithUniqueID:@&quot;com.apple.avfoundation.avcapturedevice.built-in_video:0&quot;];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//&amp;#125;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;添加视频输入对象&lt;code&gt;AVCaptureDeviceInput&lt;/code&gt;,根据输入设备初始化输入对象，用户获取输入数据,将视频输入对象添加到会话 (AVCaptureSession) 中&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addVideoInput&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSError *videoError;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _videoInput = [[AVCaptureDeviceInput alloc] &lt;span class=&quot;string&quot;&gt;initWithDevice:&lt;/span&gt;_videoDevice &lt;span class=&quot;string&quot;&gt;error:&lt;/span&gt;&amp;amp;videoError];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (videoError) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;---- 取得摄像头设备时出错 ------ %@&quot;&lt;/span&gt;,videoError);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([_captureSession &lt;span class=&quot;string&quot;&gt;canAddInput:&lt;/span&gt;_videoInput]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [_captureSession &lt;span class=&quot;string&quot;&gt;addInput:&lt;/span&gt;_videoInput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;接下来是视频输出对象&lt;code&gt;AVCaptureMovieFileOutput&lt;/code&gt;及连接管理对象&lt;code&gt;AVCaptureConnection&lt;/code&gt;,还有视频稳定设置&lt;code&gt;preferredVideoStabilizationMode&lt;/code&gt;,视频旋转方向&lt;code&gt;setVideoOrientation&lt;/code&gt;等&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (void)&lt;span class=&quot;keyword&quot;&gt;addMovieOutput&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _movieOutput = [[AVCaptureMovieFileOutput alloc] init]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    if ([_captureSession canAddOutput:_movieOutput]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [_captureSession &lt;span class=&quot;keyword&quot;&gt;addOutput:_movieOutput];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        AVCaptureConnection *captureConnection = [_movieOutput connectionWithMediaType:AVMediaTypeVideo]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        if ([captureConnection isVideoStabilizationSupported]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            captureConnection.&lt;span class=&quot;keyword&quot;&gt;preferredVideoStabilizationMode &lt;/span&gt;= AVCaptureVideoStabilizationModeAuto&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        captureConnection.videoScaleAndCropFactor = captureConnection.videoMaxScaleAndCropFactor&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;相关枚举&lt;br&gt;&lt;figure class=&quot;highlight elm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;//设置视频旋转方向&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;/*&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; typedef &lt;span class=&quot;type&quot;&gt;NS_ENUM&lt;/span&gt;(&lt;span class=&quot;type&quot;&gt;NSInteger&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;AVCaptureVideoOrientation&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;type&quot;&gt;AVCaptureVideoOrientationPortrait&lt;/span&gt;           = 1,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;type&quot;&gt;AVCaptureVideoOrientationPortraitUpsideDown&lt;/span&gt; = 2,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;type&quot;&gt;AVCaptureVideoOrientationLandscapeRight&lt;/span&gt;     = 3,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;type&quot;&gt;AVCaptureVideoOrientationLandscapeLeft&lt;/span&gt;      = 4,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125; &lt;span class=&quot;type&quot;&gt;NS_AVAILABLE&lt;/span&gt;(10_7, 4_0) __TVOS_PROHIBITED;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h6 id=&quot;audio-相关&quot;&gt;&lt;a href=&quot;#audio-相关&quot; class=&quot;headerlink&quot; title=&quot;audio 相关&quot;&gt;&lt;/a&gt;audio 相关&lt;/h6&gt;&lt;p&gt;咱们再接着添加音频相关的,包括音频输入设备&lt;code&gt;AVCaptureDevice&lt;/code&gt;,音频输入对象&lt;code&gt;AVCaptureDeviceInput&lt;/code&gt;,并且将音频输入对象添加到会话&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addAudio&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSError *audioError;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _audioDevice = [AVCaptureDevice &lt;span class=&quot;string&quot;&gt;defaultDeviceWithMediaType:&lt;/span&gt;AVMediaTypeAudio];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _audioInput = [[AVCaptureDeviceInput alloc] &lt;span class=&quot;string&quot;&gt;initWithDevice:&lt;/span&gt;_audioDevice &lt;span class=&quot;string&quot;&gt;error:&lt;/span&gt;&amp;amp;audioError];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (audioError) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;取得录音设备时出错 ------ %@&quot;&lt;/span&gt;,audioError);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([_captureSession &lt;span class=&quot;string&quot;&gt;canAddInput:&lt;/span&gt;_audioInput]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [_captureSession &lt;span class=&quot;string&quot;&gt;addInput:&lt;/span&gt;_audioInput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&quot;AVCaptureVideoPreviewLayer&quot;&gt;&lt;a href=&quot;#AVCaptureVideoPreviewLayer&quot; class=&quot;headerlink&quot; title=&quot;AVCaptureVideoPreviewLayer&quot;&gt;&lt;/a&gt;AVCaptureVideoPreviewLayer&lt;/h6&gt;&lt;p&gt;通过会话&lt;code&gt;AVCaptureSession&lt;/code&gt;创建预览层&lt;code&gt;AVCaptureVideoPreviewLayer&lt;/code&gt;,设置填充模式&lt;code&gt;videoGravity&lt;/code&gt;,预览图层方向&lt;code&gt;videoOrientation&lt;/code&gt;,并且设置 &lt;code&gt;layer&lt;/code&gt; 想要显示的位置&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addPreviewLayer&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _captureVideoPreviewLayer = [[&lt;span class=&quot;built_in&quot;&gt;AVCaptureVideoPreviewLayer&lt;/span&gt; alloc] initWithSession:_captureSession];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _captureVideoPreviewLayer.frame = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view.layer.bounds;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    _captureVideoPreviewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _captureVideoPreviewLayer.connection.videoOrientation = [_movieOutput connectionWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt;].videoOrientation;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _captureVideoPreviewLayer.position = &lt;span class=&quot;built_in&quot;&gt;CGPointMake&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view.width*&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoView.height*&lt;span class=&quot;number&quot;&gt;0.5&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CALayer&lt;/span&gt; *layer = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoView.layer;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    layer.masksToBounds = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view layoutIfNeeded];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [layer addSublayer:_captureVideoPreviewLayer];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;相关枚举&lt;/p&gt;
&lt;figure class=&quot;highlight vbnet&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;/* 填充模式&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     Options are AVLayerVideoGravityResize, AVLayerVideoGravityResizeAspect &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; AVLayerVideoGravityResizeAspectFill. AVLayerVideoGravityResizeAspect &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;最后,开始录制视频,结束录制视频,重新录制&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (void)&lt;span class=&quot;selector-tag&quot;&gt;startRecord&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-attr&quot;&gt;[_movieOutput startRecordingToOutputFileURL:[self outPutFileURL]&lt;/span&gt; &lt;span class=&quot;selector-tag&quot;&gt;recordingDelegate&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:self&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (NSURL *)&lt;span class=&quot;selector-tag&quot;&gt;outPutFileURL&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    return &lt;span class=&quot;selector-attr&quot;&gt;[NSURL fileURLWithPath:[NSString stringWithFormat:@&quot;%@%@&quot;, NSTemporaryDirectory(), @&quot;outPut.mov&quot;]&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (void)&lt;span class=&quot;selector-tag&quot;&gt;stopRecord&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-attr&quot;&gt;[_movieOutput stopRecording]&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;录制相关delegate&quot;&gt;&lt;a href=&quot;#录制相关delegate&quot; class=&quot;headerlink&quot; title=&quot;录制相关delegate&quot;&gt;&lt;/a&gt;录制相关delegate&lt;/h5&gt;&lt;p&gt;包括开始录制,录制结束等&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)captureOutput:(&lt;span class=&quot;built_in&quot;&gt;AVCaptureFileOutput&lt;/span&gt; *)captureOutput didStartRecordingToOutputFileAtURL:(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *)fileURL fromConnections:(&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *)connections&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;---- 开始录制 ----&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)captureOutput:(&lt;span class=&quot;built_in&quot;&gt;AVCaptureFileOutput&lt;/span&gt; *)captureOutput didFinishRecordingToOutputFileAtURL:(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *)outputFileURL fromConnections:(&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *)connections error:(&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *)error&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;---- 录制结束 ----%@ &quot;&lt;/span&gt;,captureOutput.outputFileURL);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.canSave) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; pushToPlay:captureOutput.outputFileURL];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.canSave = &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;压缩-保存视频&quot;&gt;&lt;a href=&quot;#压缩-保存视频&quot; class=&quot;headerlink&quot; title=&quot;压缩/保存视频&quot;&gt;&lt;/a&gt;压缩/保存视频&lt;/h5&gt;&lt;p&gt;咱们需要把录制完毕的视频保存下来.而通常录制完毕的视频是很大的,咱们需要压缩一下再保存.&lt;/p&gt;
&lt;p&gt;可以通过&lt;code&gt;AVAssetExportSession&lt;/code&gt;来进行压缩,并且可以优化网络&lt;code&gt;shouldOptimizeForNetworkUse&lt;/code&gt;,设置转后的格式&lt;code&gt;outputFileType&lt;/code&gt;,并且开启异步压缩&lt;code&gt;exportAsynchronouslyWithCompletionHandler&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 保存压缩&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *)compressedURL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; fileURLWithPath:[[&lt;span class=&quot;built_in&quot;&gt;NSSearchPathForDirectoriesInDomains&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSDocumentDirectory&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;NSUserDomainMask&lt;/span&gt;, &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;) lastObject] stringByAppendingPathComponent:[&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;compressed.mp4&quot;&lt;/span&gt;]]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt;)fileSize:(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *)path&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [[&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; dataWithContentsOfURL:path] length]/&lt;span class=&quot;number&quot;&gt;1024.00&lt;/span&gt; /&lt;span class=&quot;number&quot;&gt;1024.00&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 压缩视频&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;IBAction&lt;/span&gt;)compressVideo:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;)sender&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;开始压缩,压缩前大小 %f MB&quot;&lt;/span&gt;,[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; fileSize:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoUrl]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVURLAsset&lt;/span&gt; *avAsset = [[&lt;span class=&quot;built_in&quot;&gt;AVURLAsset&lt;/span&gt; alloc] initWithURL:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoUrl options:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *compatiblePresets = [&lt;span class=&quot;built_in&quot;&gt;AVAssetExportSession&lt;/span&gt; exportPresetsCompatibleWithAsset:avAsset];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([compatiblePresets containsObject:&lt;span class=&quot;built_in&quot;&gt;AVAssetExportPresetLowQuality&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;AVAssetExportSession&lt;/span&gt; *exportSession = [[&lt;span class=&quot;built_in&quot;&gt;AVAssetExportSession&lt;/span&gt; alloc] initWithAsset:avAsset presetName:&lt;span class=&quot;built_in&quot;&gt;AVAssetExportPreset640x480&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        exportSession.outputURL = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; compressedURL];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        exportSession.shouldOptimizeForNetworkUse = &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        exportSession.outputFileType = &lt;span class=&quot;built_in&quot;&gt;AVFileTypeMPEG4&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [exportSession exportAsynchronouslyWithCompletionHandler:^&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([exportSession status] == &lt;span class=&quot;built_in&quot;&gt;AVAssetExportSessionStatusCompleted&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;压缩完毕,压缩后大小 %f MB&quot;&lt;/span&gt;,[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; fileSize:[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; compressedURL]]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; saveVideo:[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; compressedURL]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;当前压缩进度:%f&quot;&lt;/span&gt;,exportSession.progress);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)saveVideo:(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *)outputFileURL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [library writeVideoAtPathToSavedPhotosAlbum:outputFileURL&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                completionBlock:^(&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *assetURL, &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;保存视频失败:%@&quot;&lt;/span&gt;,error);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;保存视频到相册成功&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;播放录制完的视频以及重复播放&quot;&gt;&lt;a href=&quot;#播放录制完的视频以及重复播放&quot; class=&quot;headerlink&quot; title=&quot;播放录制完的视频以及重复播放&quot;&gt;&lt;/a&gt;播放录制完的视频以及重复播放&lt;/h5&gt;&lt;p&gt;播放录制的视频,以及重复播放&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)create&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _playItem = [&lt;span class=&quot;built_in&quot;&gt;AVPlayerItem&lt;/span&gt; playerItemWithURL:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoUrl];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _player = [&lt;span class=&quot;built_in&quot;&gt;AVPlayer&lt;/span&gt; playerWithPlayerItem:_playItem];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _playerLayer =[&lt;span class=&quot;built_in&quot;&gt;AVPlayerLayer&lt;/span&gt; playerLayerWithPlayer:_player];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _playerLayer.frame = &lt;span class=&quot;built_in&quot;&gt;CGRectMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;200&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    _playerLayer.videoGravity=&lt;span class=&quot;built_in&quot;&gt;AVLayerVideoGravityResizeAspectFill&lt;/span&gt;;&lt;span class=&quot;comment&quot;&gt;//视频填充模式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.view.layer addSublayer:_playerLayer];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [_player play];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)playbackFinished:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)notification&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [_player seekToTime:&lt;span class=&quot;built_in&quot;&gt;CMTimeMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [_player play];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h4 id=&quot;交互相关&quot;&gt;&lt;a href=&quot;#交互相关&quot; class=&quot;headerlink&quot; title=&quot;交互相关&quot;&gt;&lt;/a&gt;交互相关&lt;/h4&gt;&lt;p&gt;接下来,是一些和交互相关的,比如切换摄像头,开关闪光灯,还有白平衡啥的.&lt;/p&gt;
&lt;p&gt;注意,改变设备属性前一定要首先调用&lt;code&gt;lockForConfiguration&lt;/code&gt;方法加锁,调用完之后使用&lt;code&gt;unlockForConfiguration&lt;/code&gt;方法解锁.&lt;/p&gt;
&lt;p&gt;意义是—进行设备属性修改期间,先锁定设备,防止多处同时修改设备.因为可能有多处不同的修改,咱们将其封装起来最好&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)changeDevicePropertySafety:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^)(&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *captureDevice))propertyChange&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//也可以直接用_videoDevice,但是下面这种更好&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *captureDevice= [_videoInput device];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; lockAcquired = [captureDevice lockForConfiguration:&amp;amp;error];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!lockAcquired) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;锁定设备过程error，错误信息：%@&quot;&lt;/span&gt;,error.localizedDescription);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [_captureSession beginConfiguration];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        propertyChange(captureDevice);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [captureDevice unlockForConfiguration];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [_captureSession commitConfiguration];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;开-关闪光灯&quot;&gt;&lt;a href=&quot;#开-关闪光灯&quot; class=&quot;headerlink&quot; title=&quot;开/关闪光灯&quot;&gt;&lt;/a&gt;开/关闪光灯&lt;/h5&gt;&lt;p&gt;闪光模式开启后,并无明显感觉,所以还需要开启手电筒,并且开启前先判断是否自持,否则崩溃&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;IBAction&lt;/span&gt;)changeFlashlight:(&lt;span class=&quot;built_in&quot;&gt;UIButton&lt;/span&gt; *)sender &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; con1 = [_videoDevice hasTorch];    &lt;span class=&quot;comment&quot;&gt;//支持手电筒模式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; con2 = [_videoDevice hasFlash];    &lt;span class=&quot;comment&quot;&gt;//支持闪光模式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (con1 &amp;amp;&amp;amp; con2)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; changeDevicePropertySafety:^(&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *captureDevice) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (_videoDevice.flashMode == &lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOn&lt;/span&gt;)         &lt;span class=&quot;comment&quot;&gt;//闪光灯开&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [_videoDevice setFlashMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOff&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [_videoDevice setTorchMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeOff&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (_videoDevice.flashMode == &lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOff&lt;/span&gt;)  &lt;span class=&quot;comment&quot;&gt;//闪光灯关&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [_videoDevice setFlashMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFlashModeOn&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [_videoDevice setTorchMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureTorchModeOn&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        sender.selected=!sender.isSelected;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;不能切换闪光模式&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;切换摄像头&quot;&gt;&lt;a href=&quot;#切换摄像头&quot; class=&quot;headerlink&quot; title=&quot;切换摄像头&quot;&gt;&lt;/a&gt;切换摄像头&lt;/h5&gt;&lt;p&gt;根据现在正在使用的摄像头来判断需要切换的摄像头&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;IBAction&lt;/span&gt;)changeCamera&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; (_videoDevice.position) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionBack&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            _videoDevice = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; deviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; preferringPosition:&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionFront&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionFront&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            _videoDevice = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; deviceWithMediaType:&lt;span class=&quot;built_in&quot;&gt;AVMediaTypeVideo&lt;/span&gt; preferringPosition:&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevicePositionBack&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;default&lt;/span&gt;:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;break&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; changeDevicePropertySafety:^(&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *captureDevice) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; *newVideoInput = [[&lt;span class=&quot;built_in&quot;&gt;AVCaptureDeviceInput&lt;/span&gt; alloc] initWithDevice:_videoDevice error:&amp;amp;error];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (newVideoInput != &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;comment&quot;&gt;//必选先 remove 才能询问 canAdd&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [_captureSession removeInput:_videoInput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([_captureSession canAddInput:newVideoInput]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [_captureSession addInput:newVideoInput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                _videoInput = newVideoInput;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [_captureSession addInput:_videoInput];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;切换前/后摄像头失败, error = %@&quot;&lt;/span&gt;, error);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;聚焦模式-曝光模式-拉近-远镜头-焦距&quot;&gt;&lt;a href=&quot;#聚焦模式-曝光模式-拉近-远镜头-焦距&quot; class=&quot;headerlink&quot; title=&quot;聚焦模式,曝光模式,拉近/远镜头(焦距)&quot;&gt;&lt;/a&gt;聚焦模式,曝光模式,拉近/远镜头(焦距)&lt;/h5&gt;&lt;p&gt;同时存在单击和双击的手势,咱们如下设置,&lt;code&gt;requireGestureRecognizerToFail&lt;/code&gt;的作用就是每次只生效一个手势&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)addGenstureRecognizer&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UITapGestureRecognizer&lt;/span&gt; *singleTapGesture=[[&lt;span class=&quot;built_in&quot;&gt;UITapGestureRecognizer&lt;/span&gt; alloc]initWithTarget:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; action:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(singleTap:)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    singleTapGesture.numberOfTapsRequired = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    singleTapGesture.delaysTouchesBegan = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UITapGestureRecognizer&lt;/span&gt; *doubleTapGesture=[[&lt;span class=&quot;built_in&quot;&gt;UITapGestureRecognizer&lt;/span&gt; alloc]initWithTarget:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; action:&lt;span class=&quot;keyword&quot;&gt;@selector&lt;/span&gt;(doubleTap:)];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    doubleTapGesture.numberOfTapsRequired = &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    doubleTapGesture.delaysTouchesBegan = &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [singleTapGesture requireGestureRecognizerToFail:doubleTapGesture];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoView addGestureRecognizer:singleTapGesture];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoView addGestureRecognizer:doubleTapGesture];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;单击修改聚焦模式&lt;code&gt;setFocusMode&lt;/code&gt;及聚焦点&lt;code&gt;setFocusPointOfInterest&lt;/code&gt;,还有曝光模式&lt;code&gt;setExposureMode&lt;/code&gt;及曝光点&lt;code&gt;setExposurePointOfInterest&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;注意,摄像头的点范围是0~1,咱们需要把点转化一下,使用&lt;code&gt;captureDevicePointOfInterestForPoint&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)singleTap:(&lt;span class=&quot;built_in&quot;&gt;UITapGestureRecognizer&lt;/span&gt; *)tapGesture&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt; point= [tapGesture locationInView:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.videoView];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt; cameraPoint= [_captureVideoPreviewLayer captureDevicePointOfInterestForPoint:point];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; setFocusCursorAnimationWithPoint:point];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; changeDevicePropertySafety:^(&lt;span class=&quot;built_in&quot;&gt;AVCaptureDevice&lt;/span&gt; *captureDevice) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//聚焦&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([captureDevice isFocusModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeContinuousAutoFocus&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [captureDevice setFocusMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureFocusModeContinuousAutoFocus&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;聚焦模式修改失败&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//聚焦点的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([captureDevice isFocusPointOfInterestSupported]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [captureDevice setFocusPointOfInterest:cameraPoint];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//曝光模式&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([captureDevice isExposureModeSupported:&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeAutoExpose&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [captureDevice setExposureMode:&lt;span class=&quot;built_in&quot;&gt;AVCaptureExposureModeAutoExpose&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;曝光模式修改失败&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//曝光点的位置&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([captureDevice isExposurePointOfInterestSupported]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [captureDevice setExposurePointOfInterest:cameraPoint];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面是双击设置焦距&lt;code&gt;videoZoomFactor&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;span class=&quot;string&quot;&gt;doubleTap:&lt;/span&gt;(UITapGestureRecognizer *)tapGesture&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;双击&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [self &lt;span class=&quot;string&quot;&gt;changeDevicePropertySafety:&lt;/span&gt;^(AVCaptureDevice *captureDevice) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (captureDevice.videoZoomFactor == &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            CGFloat current = &lt;span class=&quot;number&quot;&gt;1.5&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (current &amp;lt; captureDevice.activeFormat.videoMaxZoomFactor) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [captureDevice &lt;span class=&quot;string&quot;&gt;rampToVideoZoomFactor:&lt;/span&gt;current &lt;span class=&quot;string&quot;&gt;withRate:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            [captureDevice &lt;span class=&quot;string&quot;&gt;rampToVideoZoomFactor:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;withRate:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;相关枚举&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureFocusModeLocked 锁定在当前焦距&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the focus should be locked at the lens&#39; current position.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureFocusModeAutoFocus 自动对焦一次,然后切换到焦距锁定&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the device should autofocus once and then change the focus mode to AVCaptureFocusModeLocked.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureFocusModeContinuousAutoFocus 当需要时.自动调整焦距&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the device should automatically focus when needed.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         */&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureExposureModeLocked  曝光锁定在当前值&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the exposure should be locked at its current value.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureExposureModeAutoExpose 曝光自动调整一次然后锁定&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the device should automatically adjust exposure once and then change the exposure mode to AVCaptureExposureModeLocked.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureExposureModeContinuousAutoExposure 曝光自动调整&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the device should automatically adjust exposure when needed.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;span class=&quot;doctag&quot;&gt;@constant&lt;/span&gt; AVCaptureExposureModeCustom 曝光只根据设定的值来&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         Indicates that the device should only adjust exposure according to user provided ISO, exposureDuration values.&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;         */&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;Demo&quot;&gt;&lt;a href=&quot;#Demo&quot; class=&quot;headerlink&quot; title=&quot;Demo&quot;&gt;&lt;/a&gt;Demo&lt;/h2&gt;&lt;p&gt;终于说完了,感觉越到后面越无力,还是放上一个 demo 吧,里面包含了上面介绍的两种方式.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/kevinMkY/MKCustomCamera&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Demo 下载地址&lt;/a&gt;&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;
</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;iOS 自定义相机, UIImagePickerController &amp;amp;&amp;amp; AVCaptureSession (附微信小视频模仿demo)&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="相机" scheme="http://yoursite.com/tags/%E7%9B%B8%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>webP 在 iOS 中的应用</title>
    <link href="http://yoursite.com/2015/12/17/webP-%E5%9C%A8-iOS-%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <id>http://yoursite.com/2015/12/17/webP-在-iOS-中的应用/</id>
    <published>2015-12-17T10:17:02.000Z</published>
    <updated>2015-12-18T10:13:58.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;    webP格式图片在iOS中的应用,详见内&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;序&quot;&gt;&lt;a href=&quot;#序&quot; class=&quot;headerlink&quot; title=&quot;序&quot;&gt;&lt;/a&gt;序&lt;/h1&gt;&lt;p&gt;本篇来源于&lt;a href=&quot;https://github.com/amfe/article/issues/21&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;15年双11手淘前端技术巡演 - H5性能最佳实践(点我打开)&lt;/a&gt;,它们在采用了 &lt;a href=&quot;http://baike.baidu.com/link?url=_M-vZznamGoy9nLEfu1eBsfqb8HUWPOwc0yfYF5TUcWjGiJBVT6sY8UEeyNkITM7_e8L_7aL_oiVuhKef5foEK&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;webp格式(点我打开)&lt;/a&gt; 的图片后,网络数据传输大幅减少&lt;/p&gt;
&lt;p&gt;以及腾讯发布的 &lt;a href=&quot;http://isux.tencent.com/introduction-of-webp.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;webp探寻之路(点我打开)&lt;/a&gt;都可以拿出非常漂亮的数据让我们转到 webP 的怀抱(至少部分)&lt;/p&gt;
&lt;p&gt;下面是 taobao 的优化对比图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/webpQQ20151218-0.png&quot; width=&quot;705&quot; height=&quot;911&quot;&gt;&lt;/p&gt;
&lt;p&gt;下面是 腾讯的 图片格式对比图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://isux.tencent.com/wp-content/uploads/2014/12/20141212164211465-590x201.png&quot; width=&quot;798&quot; height=&quot;273&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到有非常的实用价值,下面我们看看如何引入到具体项目中&lt;/p&gt;
&lt;h1 id=&quot;webp-在-iOS中-的应用&quot;&gt;&lt;a href=&quot;#webp-在-iOS中-的应用&quot; class=&quot;headerlink&quot; title=&quot;webp 在 iOS中 的应用&quot;&gt;&lt;/a&gt;webp 在 iOS中 的应用&lt;/h1&gt;&lt;h2 id=&quot;本地采用-webP-图片&quot;&gt;&lt;a href=&quot;#本地采用-webP-图片&quot; class=&quot;headerlink&quot; title=&quot;本地采用 webP 图片&quot;&gt;&lt;/a&gt;本地采用 webP 图片&lt;/h2&gt;&lt;h3 id=&quot;下载第三方库&quot;&gt;&lt;a href=&quot;#下载第三方库&quot; class=&quot;headerlink&quot; title=&quot;下载第三方库&quot;&gt;&lt;/a&gt;下载第三方库&lt;/h3&gt;&lt;p&gt;很幸运,SDWebImage里面有个webP 框架,可以将&lt;code&gt;webp&lt;/code&gt;–&amp;gt;&lt;code&gt;NSData&lt;/code&gt;–&amp;gt;&lt;code&gt;UIImage&lt;/code&gt;最后变为可识别的图片格式直接给控件调用&lt;/p&gt;
&lt;p&gt;但是我在&lt;a href=&quot;https://github.com/rs/SDWebImage&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;SDWebImage 的 github(点击跳转)&lt;/a&gt;上看见了下面这段话&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There are 3 subspecs available now: Core, MapKit and WebP (this means you can install only some of the SDWebImage modules. By default, you get just Core, so if you need WebP, you need to specify it).&lt;/p&gt;
&lt;p&gt;Podfile example:&lt;/p&gt;
&lt;p&gt;$pod ‘SDWebImage/WebP’&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;也就是说我们需要额外下载这个&lt;code&gt;webP&lt;/code&gt;库,注意,这个会从 google 下载,如果失败,开 VPN 试试,下载完成后,文件结构如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/webpQQ20151218-1.png&quot; width=&quot;352&quot; height=&quot;361&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;使用&quot;&gt;&lt;a href=&quot;#使用&quot; class=&quot;headerlink&quot; title=&quot;使用&quot;&gt;&lt;/a&gt;使用&lt;/h3&gt;&lt;p&gt;SDWebImage 的源码如下,我们直接使用转化出的 &lt;code&gt;UIImage&lt;/code&gt; 即可&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#ifdef SD_WEBP&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;UIKit/UIKit.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Fix for issue #416 Undefined symbols for architecture armv7 since WebP introduction when deploying to device&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; WebPInitPremultiplyNEON(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; WebPInitUpsamplersNEON(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; VP8DspInitNEON(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;UIImage&lt;/span&gt; (&lt;span class=&quot;title&quot;&gt;WebP&lt;/span&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *)sd_imageWithWebPData:(&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)data;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;别的办法&quot;&gt;&lt;a href=&quot;#别的办法&quot; class=&quot;headerlink&quot; title=&quot;别的办法&quot;&gt;&lt;/a&gt;别的办法&lt;/h3&gt;&lt;p&gt;据了解,还有部分三方库也可以…但是我没有进行研究了,我觉得原理应该都差不多,下面重点要说的是和 taobao 一样,如何在 webView 和网络传输中如何使用&lt;code&gt;webp&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;在-webView-中实用-webP&quot;&gt;&lt;a href=&quot;#在-webView-中实用-webP&quot; class=&quot;headerlink&quot; title=&quot;在 webView 中实用 webP&quot;&gt;&lt;/a&gt;在 webView 中实用 webP&lt;/h2&gt;&lt;p&gt;先给一个 &lt;code&gt;webP&lt;/code&gt; 测试 html: &lt;a href=&quot;http://testing.yongche.org/webp.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://testing.yongche.org/webp.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;html&lt;/code&gt; 的代码如下&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;charset&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;http-equiv&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;IE=edge&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;webp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;img&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://testing.yongche.org/images/150X1501.webp” width = 50 ,height = 20&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;img src=&quot;&lt;span class=&quot;attr&quot;&gt;http:&lt;/span&gt;//&lt;span class=&quot;attr&quot;&gt;testing.yongche.org&lt;/span&gt;/&lt;span class=&quot;attr&quot;&gt;images&lt;/span&gt;/&lt;span class=&quot;attr&quot;&gt;150X1501.webp&lt;/span&gt;&quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;第一个办法-和-JS-协作&quot;&gt;&lt;a href=&quot;#第一个办法-和-JS-协作&quot; class=&quot;headerlink&quot; title=&quot;第一个办法 和 JS 协作&quot;&gt;&lt;/a&gt;第一个办法 和 JS 协作&lt;/h3&gt;&lt;p&gt;webView 等网页上如果用的是 webP 图片,iOS 直接解析的话,会显示?图片.&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/webpQQ20151218-3.png&quot; width=&quot;373&quot; height=&quot;674&quot;&gt;&lt;/p&gt;
&lt;p&gt;后来决定这么搞:&lt;/p&gt;
&lt;p&gt;A. 在网页加载出后截取到 &lt;code&gt;HTML&lt;/code&gt; 及内部的 &lt;code&gt;JS&lt;/code&gt; 后,调用 &lt;code&gt;JS&lt;/code&gt; 预先准备好的方法获取需要转码的 &lt;code&gt;webP&lt;/code&gt; 格式图片下载地址(其实一个一个的遍历也行).&lt;br&gt;B. 在App 本地开启线程下载图片,下载完成后,将图片转码由 webP—&amp;gt; png—&amp;gt;Base64(因为实验出直接用 png/jpg 的话 没用)&lt;br&gt;C. 将 Base64及原图片下载地址一一对应调用 &lt;code&gt;JS&lt;/code&gt; 准备好的方法进行替换&lt;br&gt;D. 将下载后的图片进行缓存,并进行管理&lt;/p&gt;
&lt;p&gt;注意点:&lt;br&gt;A. 图片在最终显示成功前会显示成?,此处为了用户体验应该采用占位图片&lt;br&gt;B. 图片显示成功前应该保持网页布局不调整,需要由 JS 预先设置好布局&lt;br&gt;C. 图片在本地的缓存需要管理&lt;/p&gt;
&lt;p&gt;相应的,&lt;code&gt;HTML&lt;/code&gt;需要更改代码,如下&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;charset&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;http-equiv&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;X-UA-Compatible&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;IE=edge&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;viewport&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;content&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;webp&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;title&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; YongChe = &amp;#123;&amp;#125;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            YongChe.getAllWebPImg = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; images = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.getElementsByTagName(&lt;span class=&quot;string&quot;&gt;&#39;img&#39;&lt;/span&gt;); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; srcList = [];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; patt1 = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;RegExp&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&quot;\.webp$&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;var&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; images.length; i++) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;(patt1.test(images[i].src)) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                        srcList.push(images[i].src);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(srcList);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;JSON&lt;/span&gt;.stringify(srcList);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            YongChe.replaceWebPImg = &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;src, localPath&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                alert(localPath);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                elementList = &lt;span class=&quot;built_in&quot;&gt;document&lt;/span&gt;.querySelectorAll(&lt;span class=&quot;string&quot;&gt;&#39;img[src=&quot;&#39;&lt;/span&gt;+src+&lt;span class=&quot;string&quot;&gt;&#39;&quot;]&#39;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(elementList);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt;(element &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; elementList) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    elementList[element].src = localPath;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;head&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;img&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;src&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;http://testing.yongche.org/images/150X1501.webp” width = 50 ,height = 20&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;lt;img src=&quot;&lt;span class=&quot;attr&quot;&gt;http:&lt;/span&gt;//&lt;span class=&quot;attr&quot;&gt;testing.yongche.org&lt;/span&gt;/&lt;span class=&quot;attr&quot;&gt;images&lt;/span&gt;/&lt;span class=&quot;attr&quot;&gt;150X1501.webp&lt;/span&gt;&quot;&amp;gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;type&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;javascript&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(YongChe.getAllWebPImg());&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            YongChe.replaceWebPImg(&lt;span class=&quot;string&quot;&gt;&#39;http://testing.yongche.org/images/logo.png&#39;&lt;/span&gt;,&lt;span class=&quot;string&quot;&gt;&#39;http://testing.yongche.org/images/150X1501.webp&#39;&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;script&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;body&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;App本地也需要做出相应的措施&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//在 `webView` 加载完 `HTML` 后,解析源码,执行相应的 `JS` 方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;-(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)webViewDidFinishLoad:(&lt;span class=&quot;built_in&quot;&gt;UIWebView&lt;/span&gt; *)webView&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;//获取`HTML`代码&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *lJs = &lt;span class=&quot;string&quot;&gt;@&quot;document.documentElement.innerHTML&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *str = [webView stringByEvaluatingJavaScriptFromString:lJs];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//执行约定好的方法,获取需要下载的 webp 图片&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *imgs = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.webView stringByEvaluatingJavaScriptFromString:&lt;span class=&quot;string&quot;&gt;@&quot;YongChe.getAllWebPImg();&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt; *array = [&lt;span class=&quot;built_in&quot;&gt;NSJSONSerialization&lt;/span&gt; JSONObjectWithData:[imgs dataUsingEncoding:&lt;span class=&quot;built_in&quot;&gt;NSUTF8StringEncoding&lt;/span&gt;] options:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; error:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//此处,做示范,只转换第一个,将图片下载下来,并且转为 PNG 后,再转成 Base64,传给 JS 脚本执行&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *imgUrl = array.firstObject;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    __&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;typeof&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) weakSelf = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [SDWebImageCustomeDownLoad downloadWithURL:[&lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; URLWithString:imgUrl] progress:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; completed:^(&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *image, &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *error, SDImageCacheType cacheType, &lt;span class=&quot;built_in&quot;&gt;NSURL&lt;/span&gt; *imageURL) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *base = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;data:image/png;base64,%@&quot;&lt;/span&gt;,imgBase];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *js = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithFormat:&lt;span class=&quot;string&quot;&gt;@&quot;YongChe.replaceWebPImg(&#39;%@&#39;,&#39;%@&#39;)&quot;&lt;/span&gt;,imageURL,base];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [weakSelf.webView stringByEvaluatingJavaScriptFromString:js];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;下面这个方法是修改 &lt;code&gt;SDWebImage&lt;/code&gt; 自带的,本来是属于 &lt;code&gt;UIImage&lt;/code&gt;的分类方法,此处只是提取出下载这个操作,并没有深入更改,大家别介意&lt;br&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;span class=&quot;string&quot;&gt;downloadWithURL:&lt;/span&gt;(NSURL *)url &lt;span class=&quot;string&quot;&gt;progress:&lt;/span&gt;(SDWebImageDownloaderProgressBlock)progressBlock &lt;span class=&quot;string&quot;&gt;completed:&lt;/span&gt;(SDWebImageCompletionBlock)completedBlock&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    [self sd_cancelCurrentImageLoad];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//    objc_setAssociatedObject(self, &amp;amp;imageURLKey, url, OBJC_ASSOCIATION_RETAIN_NONATOMIC);&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (url) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        __weak __typeof(self)wself = self;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        id &amp;lt;SDWebImageOperation&amp;gt; operation = [SDWebImageManager.sharedManager &lt;span class=&quot;string&quot;&gt;downloadImageWithURL:&lt;/span&gt;url &lt;span class=&quot;string&quot;&gt;options:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;progress:&lt;/span&gt;progressBlock &lt;span class=&quot;string&quot;&gt;completed:&lt;/span&gt;^(UIImage *image, NSError *error, SDImageCacheType cacheType, BOOL finished, NSURL *imageURL) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//            if (!wself) return;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            dispatch_main_sync_safe(^&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//                if (!wself) return;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (image &amp;amp;&amp;amp; completedBlock)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    completedBlock(image, error, cacheType, url);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (image) &amp;#123;   &lt;span class=&quot;comment&quot;&gt;//没有回调,但是图片下载完成了&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;    &lt;span class=&quot;comment&quot;&gt;//image 下载失败&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completedBlock &amp;amp;&amp;amp; finished) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                    completedBlock(image, error, cacheType, url);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//这一步,将这个 View 之前的下载操作全部取消,然后将这次的操作放进去&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//        [self sd_setImageLoadOperation:operation forKey:@&quot;UIImageViewImageLoad&quot;];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125; &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        dispatch_main_async_safe(^&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            NSError *error = [NSError &lt;span class=&quot;string&quot;&gt;errorWithDomain:&lt;/span&gt;SDWebImageErrorDomain &lt;span class=&quot;string&quot;&gt;code:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;userInfo:&lt;/span&gt;@&amp;#123;&lt;span class=&quot;string&quot;&gt;NSLocalizedDescriptionKey :&lt;/span&gt; @&lt;span class=&quot;string&quot;&gt;&quot;Trying to load a nil url&quot;&lt;/span&gt;&amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completedBlock) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                completedBlock(nil, error, SDImageCacheTypeNone, url);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title=&quot;效果&quot;&gt;&lt;/a&gt;效果&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/webpwebP%20加载%20html.gif&quot; width=&quot;373&quot; height=&quot;674&quot;&gt;&lt;/p&gt;
&lt;p&gt;只能说成功了,但是看着效果明显很龊,下面说说其他办法&lt;/p&gt;
&lt;h3 id=&quot;第二种办法-NSURLProtocol&quot;&gt;&lt;a href=&quot;#第二种办法-NSURLProtocol&quot; class=&quot;headerlink&quot; title=&quot;第二种办法 NSURLProtocol&quot;&gt;&lt;/a&gt;第二种办法 NSURLProtocol&lt;/h3&gt;&lt;h4 id=&quot;分析&quot;&gt;&lt;a href=&quot;#分析&quot; class=&quot;headerlink&quot; title=&quot;分析&quot;&gt;&lt;/a&gt;分析&lt;/h4&gt;&lt;p&gt;采用 &lt;code&gt;webP&lt;/code&gt; 的目的就是减少网络传输数据量,加快请求整体速度,现在的问题就在于 &lt;code&gt;webView&lt;/code&gt; 不识别 &lt;code&gt;webP&lt;/code&gt; 这种格式而已,再想想 iOS内的所有网络请求/响应我们都可以控制,那我们获取到数据时,转化成它识别的给它就可以了,而可以帮我们在拿到数据时进行某些操作,操作完以后又正常进行网络流程的,就是接下来的主角了 — &lt;code&gt;NSURLProtocol&lt;/code&gt;,如果大家和我一样平时用的少的话,可以看看 &lt;code&gt;JamesYu&lt;/code&gt; 的这篇简书 &lt;a href=&quot;http://www.jianshu.com/p/0244e431fb3c&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;iOS中的 NSURLProtocol&lt;/a&gt; &lt;/p&gt;
&lt;p&gt;再看 taobao 前辈们的说法:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/webpQQ20151218-2.png&quot; width=&quot;782&quot; height=&quot;138&quot;&gt;&lt;/p&gt;
&lt;p&gt;估计也是这样做的, OK. 那开撸&lt;/p&gt;
&lt;h4 id=&quot;NSURLProtocol&quot;&gt;&lt;a href=&quot;#NSURLProtocol&quot; class=&quot;headerlink&quot; title=&quot;NSURLProtocol&quot;&gt;&lt;/a&gt;NSURLProtocol&lt;/h4&gt;&lt;h5 id=&quot;自定义一个-YCCustomURLProtocol-继承自-NSURLProtocol&quot;&gt;&lt;a href=&quot;#自定义一个-YCCustomURLProtocol-继承自-NSURLProtocol&quot; class=&quot;headerlink&quot; title=&quot;自定义一个 YCCustomURLProtocol 继承自 NSURLProtocol&quot;&gt;&lt;/a&gt;自定义一个 &lt;code&gt;YCCustomURLProtocol&lt;/code&gt; 继承自 &lt;code&gt;NSURLProtocol&lt;/code&gt;&lt;/h5&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;Foundation/Foundation.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCCustomURLProtocol&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;NSURLProtocol&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;在-delegate-注册下这个协议&quot;&gt;&lt;a href=&quot;#在-delegate-注册下这个协议&quot; class=&quot;headerlink&quot; title=&quot;在 delegate 注册下这个协议&quot;&gt;&lt;/a&gt;在 delegate 注册下这个协议&lt;/h5&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)application:(&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; *)application didFinishLaunchingWithOptions:(&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *)launchOptions &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//注册protocol&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	[&lt;span class=&quot;built_in&quot;&gt;NSURLProtocol&lt;/span&gt; registerClass:[CustomURLProtocol &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt;]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h5 id=&quot;实现协议内容&quot;&gt;&lt;a href=&quot;#实现协议内容&quot; class=&quot;headerlink&quot; title=&quot;实现协议内容&quot;&gt;&lt;/a&gt;实现协议内容&lt;/h5&gt;&lt;p&gt;有几个注意点: &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;NSURLConnection&lt;/code&gt; 活跃的iOS版本,&lt;code&gt;NSURLSession&lt;/code&gt; 可以酌情代替之&lt;/li&gt;
&lt;li&gt;不论 &lt;code&gt;NSURLConnection&lt;/code&gt; 还是 &lt;code&gt;NSURLSession&lt;/code&gt;,尽量把 &lt;code&gt;URLProtocol didFailWithError&lt;/code&gt; &lt;code&gt;URLProtocol DidFinishLoading&lt;/code&gt; &lt;code&gt;URLProtocol didLoadData&lt;/code&gt; &lt;code&gt;URLProtocol didReceiveResponse&lt;/code&gt; 几个方法写全,避免网络请求产生不可预知的 BUG&lt;/li&gt;
&lt;li&gt;暂时就这些&lt;/li&gt;
&lt;/ol&gt;
&lt;h6 id=&quot;NSURLConnection&quot;&gt;&lt;a href=&quot;#NSURLConnection&quot; class=&quot;headerlink&quot; title=&quot;NSURLConnection&quot;&gt;&lt;/a&gt;NSURLConnection&lt;/h6&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;YCCustomURLProtocol.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;UIImage+WebP.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *URLProtocolHandledKey = &lt;span class=&quot;string&quot;&gt;@&quot;URLHasHandle&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCCustomURLProtocol&lt;/span&gt;()&amp;lt;&lt;span class=&quot;title&quot;&gt;NSURLSessionDelegate&lt;/span&gt;,&lt;span class=&quot;title&quot;&gt;NSURLSessionDataDelegate&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *connection;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCCustomURLProtocol&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 初始化请求&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)canInitWithRequest:(&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *)request&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//只处理http和https请求&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *scheme = [[request URL] scheme];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ( ([scheme caseInsensitiveCompare:&lt;span class=&quot;string&quot;&gt;@&quot;http&quot;&lt;/span&gt;] == &lt;span class=&quot;built_in&quot;&gt;NSOrderedSame&lt;/span&gt; ||&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          [scheme caseInsensitiveCompare:&lt;span class=&quot;string&quot;&gt;@&quot;https&quot;&lt;/span&gt;] == &lt;span class=&quot;built_in&quot;&gt;NSOrderedSame&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//看看是否已经处理过了，防止无限循环&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;NSURLProtocol&lt;/span&gt; propertyForKey:URLProtocolHandledKey inRequest:request]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *) canonicalRequestForRequest:(&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *)request &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; request;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 通信协议内容实现&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)startLoading&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSMutableURLRequest&lt;/span&gt; *mutableReqeust = [[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; request] mutableCopy];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//标示改request已经处理过了，防止无限循环&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;built_in&quot;&gt;NSURLProtocol&lt;/span&gt; setProperty:@YES forKey:URLProtocolHandledKey inRequest:mutableReqeust];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL absoluteString] hasSuffix:&lt;span class=&quot;string&quot;&gt;@&quot;webp&quot;&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;正常请求,让它 goon &quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;检测到了 webp---%@,拦截它&quot;&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection = [&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; connectionWithRequest:mutableReqeust delegate:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)stopLoading&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.connection cancel];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 请求管理 connection&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) connection:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection didReceiveResponse:(&lt;span class=&quot;built_in&quot;&gt;NSURLResponse&lt;/span&gt; *)response &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didReceiveResponse:response cacheStoragePolicy:&lt;span class=&quot;built_in&quot;&gt;NSURLCacheStorageNotAllowed&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) connection:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection didReceiveData:(&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)data &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([connection.currentRequest.URL.absoluteString hasSuffix:&lt;span class=&quot;string&quot;&gt;@&quot;webp&quot;&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;webp---%@---替换它&quot;&lt;/span&gt;,connection);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *imgData = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; sd_imageWithWebPData:data];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *jpgData = &lt;span class=&quot;built_in&quot;&gt;UIImageJPEGRepresentation&lt;/span&gt;(imgData, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;f);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didLoadData:jpgData];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didLoadData:data];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;) connectionDidFinishLoading:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocolDidFinishLoading:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)connection:(&lt;span class=&quot;built_in&quot;&gt;NSURLConnection&lt;/span&gt; *)connection didFailWithError:(&lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *)error &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didFailWithError:error];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&quot;NSURLSession&quot;&gt;&lt;a href=&quot;#NSURLSession&quot; class=&quot;headerlink&quot; title=&quot;NSURLSession&quot;&gt;&lt;/a&gt;NSURLSession&lt;/h6&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;42&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;43&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;44&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;45&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;46&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;47&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;48&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;49&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;50&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;51&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;52&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;53&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;54&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;55&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;56&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;57&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;58&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;59&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;60&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;61&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;62&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;63&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;64&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;65&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;66&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;67&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;68&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;69&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;70&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;71&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;72&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;73&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;74&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;75&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;76&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;77&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;78&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;79&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;80&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;81&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;82&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;83&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;84&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;85&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;86&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;87&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;88&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;89&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;90&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;91&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;92&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;93&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;94&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;95&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;96&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;YCCustomURLProtocol.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;UIImage+WebP.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *URLProtocolHandledKey = &lt;span class=&quot;string&quot;&gt;@&quot;URLHasHandle&quot;&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCCustomURLProtocol&lt;/span&gt;()&amp;lt;&lt;span class=&quot;title&quot;&gt;NSURLSessionDelegate&lt;/span&gt;,&lt;span class=&quot;title&quot;&gt;NSURLSessionDataDelegate&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;strong&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;NSURLSession&lt;/span&gt; *session;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCCustomURLProtocol&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 初始化请求&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)canInitWithRequest:(&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *)request&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//只处理http和https请求&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *scheme = [[request URL] scheme];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ( ([scheme caseInsensitiveCompare:&lt;span class=&quot;string&quot;&gt;@&quot;http&quot;&lt;/span&gt;] == &lt;span class=&quot;built_in&quot;&gt;NSOrderedSame&lt;/span&gt; ||&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;          [scheme caseInsensitiveCompare:&lt;span class=&quot;string&quot;&gt;@&quot;https&quot;&lt;/span&gt;] == &lt;span class=&quot;built_in&quot;&gt;NSOrderedSame&lt;/span&gt;))&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//看看是否已经处理过了，防止无限循环&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([&lt;span class=&quot;built_in&quot;&gt;NSURLProtocol&lt;/span&gt; propertyForKey:URLProtocolHandledKey inRequest:request]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;NO&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;+ (&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *) canonicalRequestForRequest:(&lt;span class=&quot;built_in&quot;&gt;NSURLRequest&lt;/span&gt; *)request &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; request;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark 通信协议内容实现&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)startLoading&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSMutableURLRequest&lt;/span&gt; *mutableReqeust = [[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; request] mutableCopy];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//标示改request已经处理过了，防止无限循环&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;built_in&quot;&gt;NSURLProtocol&lt;/span&gt; setProperty:@YES forKey:URLProtocolHandledKey inRequest:mutableReqeust];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (![[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL absoluteString] hasSuffix:&lt;span class=&quot;string&quot;&gt;@&quot;webp&quot;&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;是一个正常的,%@&quot;&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;检测到了 webp---%@,拦截它&quot;&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.request.URL);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSURLSessionConfiguration&lt;/span&gt; *config = [&lt;span class=&quot;built_in&quot;&gt;NSURLSessionConfiguration&lt;/span&gt; defaultSessionConfiguration];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session = [&lt;span class=&quot;built_in&quot;&gt;NSURLSession&lt;/span&gt; sessionWithConfiguration:config delegate:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; delegateQueue:[&lt;span class=&quot;built_in&quot;&gt;NSOperationQueue&lt;/span&gt; currentQueue]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session dataTaskWithRequest:mutableReqeust] resume];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)stopLoading&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.session invalidateAndCancel];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#pragma mark dataDelegate&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)URLSession:(&lt;span class=&quot;built_in&quot;&gt;NSURLSession&lt;/span&gt; *)session dataTask:(&lt;span class=&quot;built_in&quot;&gt;NSURLSessionDataTask&lt;/span&gt; *)dataTask didReceiveResponse:(&lt;span class=&quot;built_in&quot;&gt;NSURLResponse&lt;/span&gt; *)response completionHandler:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt; (^)(&lt;span class=&quot;built_in&quot;&gt;NSURLSessionResponseDisposition&lt;/span&gt; disposition))completionHandler&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didReceiveResponse:response cacheStoragePolicy:&lt;span class=&quot;built_in&quot;&gt;NSURLCacheStorageNotAllowed&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (completionHandler) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        completionHandler(&lt;span class=&quot;built_in&quot;&gt;NSURLSessionResponseAllow&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)URLSession:(&lt;span class=&quot;built_in&quot;&gt;NSURLSession&lt;/span&gt; *)session dataTask:(&lt;span class=&quot;built_in&quot;&gt;NSURLSessionDataTask&lt;/span&gt; *)dataTask didReceiveData:(&lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *)data&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSData&lt;/span&gt; *transData = data;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([dataTask.currentRequest.URL.absoluteString hasSuffix:&lt;span class=&quot;string&quot;&gt;@&quot;webp&quot;&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;webp---%@---替换它&quot;&lt;/span&gt;,dataTask.currentRequest.URL);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//采用 SDWebImage 的转换方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; *imgData = [&lt;span class=&quot;built_in&quot;&gt;UIImage&lt;/span&gt; sd_imageWithWebPData:data];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        transData = &lt;span class=&quot;built_in&quot;&gt;UIImageJPEGRepresentation&lt;/span&gt;(imgData, &lt;span class=&quot;number&quot;&gt;1.0&lt;/span&gt;f);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didLoadData:transData];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)URLSession:(&lt;span class=&quot;built_in&quot;&gt;NSURLSession&lt;/span&gt; *)session task:(&lt;span class=&quot;built_in&quot;&gt;NSURLSessionTask&lt;/span&gt; *)task didCompleteWithError:(&lt;span class=&quot;keyword&quot;&gt;nullable&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;NSError&lt;/span&gt; *)error&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (error) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocol:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; didFailWithError:error];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.client URLProtocolDidFinishLoading:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h6 id=&quot;实际效果&quot;&gt;&lt;a href=&quot;#实际效果&quot; class=&quot;headerlink&quot; title=&quot;实际效果&quot;&gt;&lt;/a&gt;实际效果&lt;/h6&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/webpQQ20151218-4.png&quot; width=&quot;373&quot; height=&quot;674&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;结尾语&quot;&gt;&lt;a href=&quot;#结尾语&quot; class=&quot;headerlink&quot; title=&quot;结尾语&quot;&gt;&lt;/a&gt;结尾语&lt;/h1&gt;&lt;p&gt;ok, 至此已经全部成功,不过 &lt;code&gt;NSURLProtocol&lt;/code&gt; 会影响 App 内所有请求,稍有遗漏的话后果比较严重,大家一定要慎重.不过相比效果,电商类 App 采用大量图片的话还是值得转换到 &lt;code&gt;webP&lt;/code&gt; 阵营的&lt;/p&gt;
&lt;p&gt;谢谢观看,个人水平有限,如有遗漏/不妥,请指出&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;    webP格式图片在iOS中的应用,详见内&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>扩大按钮点击范围</title>
    <link href="http://yoursite.com/2015/12/17/%E6%89%A9%E5%A4%A7%E6%8C%89%E9%92%AE%E7%82%B9%E5%87%BB%E8%8C%83%E5%9B%B4/"/>
    <id>http://yoursite.com/2015/12/17/扩大按钮点击范围/</id>
    <published>2015-12-17T08:53:00.000Z</published>
    <updated>2015-12-17T10:15:53.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;在不改变按钮尺寸的前提下,扩大按钮的点击范围&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;场景&quot;&gt;&lt;a href=&quot;#场景&quot; class=&quot;headerlink&quot; title=&quot;场景:&quot;&gt;&lt;/a&gt;场景:&lt;/h2&gt;&lt;p&gt;UI/PM说:你这个按钮根本就点不到嘛!&lt;/p&gt;
&lt;p&gt;攻城狮说:你给我的效果图就这么大啊!!!!!&lt;/p&gt;
&lt;p&gt;UI/PM说:尺寸大了不好看嘛~不管,反正我点不到…你给我弄大…还有,尺寸不准变!&lt;/p&gt;
&lt;p&gt;旁 白说: UI/PM piapiapia 的走了…..&lt;/p&gt;
&lt;p&gt;攻城狮说:凸=.=凸&lt;/p&gt;
&lt;h2 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求:&quot;&gt;&lt;/a&gt;需求:&lt;/h2&gt;&lt;p&gt;按钮尺寸不变,按钮能够接收点击事件的范围变大&lt;/p&gt;
&lt;h2 id=&quot;分析&quot;&gt;&lt;a href=&quot;#分析&quot; class=&quot;headerlink&quot; title=&quot;分析:&quot;&gt;&lt;/a&gt;分析:&lt;/h2&gt;&lt;p&gt;好吧,作为攻城狮(嗷嗷,自行脑补下狮子的呐喊),咱们不能说不行&lt;/p&gt;
&lt;p&gt;其实挺简单,WWDC 2012 Session中提到了一种解决方式。它重写了按钮中的&lt;code&gt;pointInside&lt;/code&gt;方法,临时改变按钮的&lt;code&gt;Inset&lt;/code&gt;来扩大点击事件的接收范围,来判断触摸点是否在按钮的点击热区(接收有效点击事件,触发按钮的点击方法)内&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//官方在视频中给出的示例源码&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)pointInside:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)point withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt;*)withEvent&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; widthDelta = &lt;span class=&quot;number&quot;&gt;44.0&lt;/span&gt; - bounds.size.width;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; heightDelta = &lt;span class=&quot;number&quot;&gt;44.0&lt;/span&gt; - bounds.size.height;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    bounds = &lt;span class=&quot;built_in&quot;&gt;CGRectInset&lt;/span&gt;(bounds, &lt;span class=&quot;number&quot;&gt;-0.5&lt;/span&gt; * widthDelta, &lt;span class=&quot;number&quot;&gt;-0.5&lt;/span&gt; * heightDelta);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CGRectContainsPoint&lt;/span&gt;(bounds, point);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;44&lt;/code&gt;是人机交互设计指南推荐的点击范围,不过既然要改,咱们就改自由点,由咱们来控制多好&lt;/p&gt;
&lt;p&gt;分析完了,开撸&lt;/p&gt;
&lt;h2 id=&quot;code&quot;&gt;&lt;a href=&quot;#code&quot; class=&quot;headerlink&quot; title=&quot;code:&quot;&gt;&lt;/a&gt;code:&lt;/h2&gt;&lt;p&gt;我自定义一个按钮类&lt;code&gt;YCBigClickAreaBtn&lt;/code&gt;,实现如下&lt;/p&gt;
&lt;p&gt;.h 文件&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&amp;lt;UIKit/UIKit.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@interface&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCBigClickAreaBtn&lt;/span&gt; : &lt;span class=&quot;title&quot;&gt;UIButton&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/// 1.想要放大 btn 的点击热区的范围,注意,只在 btn 的父视图范围内有效&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/// 2.这个范围是按钮的整体宽度,如果需要以中心点开始计算,则需要*2&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@property&lt;/span&gt; (&lt;span class=&quot;keyword&quot;&gt;nonatomic&lt;/span&gt;,&lt;span class=&quot;keyword&quot;&gt;assign&lt;/span&gt;) &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; clickAreaRadious;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;.m 文件&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#import &lt;span class=&quot;meta-string&quot;&gt;&quot;YCBigClickAreaBtn.h&quot;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@implementation&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;YCBigClickAreaBtn&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)pointInside:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)point withEvent:(&lt;span class=&quot;built_in&quot;&gt;UIEvent&lt;/span&gt;*)event&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGRect&lt;/span&gt; bounds = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.bounds;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; widthDelta = MAX(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.clickAreaRadious - bounds.size.width, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;CGFloat&lt;/span&gt; heightDelta = MAX(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.clickAreaRadious - bounds.size.height, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    bounds = &lt;span class=&quot;built_in&quot;&gt;CGRectInset&lt;/span&gt;(bounds, &lt;span class=&quot;number&quot;&gt;-0.5&lt;/span&gt; * widthDelta, &lt;span class=&quot;number&quot;&gt;-0.5&lt;/span&gt; * heightDelta);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;CGRectContainsPoint&lt;/span&gt;(bounds, point);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;@end&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;调用&lt;/p&gt;
&lt;figure class=&quot;highlight gams&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;YCBigClickAreaBtn *tickBtn = [[YCBigClickAreaBtn alloc] init];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//扩大按钮的点击热区,并且保持最小50&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;tickBtn.clickAreaRadious = &lt;span class=&quot;built-in&quot;&gt;MAX&lt;/span&gt;(变量,&lt;span class=&quot;number&quot;&gt;50&lt;/span&gt;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;thx-有用自取-欢迎交流更好的方法&quot;&gt;&lt;a href=&quot;#thx-有用自取-欢迎交流更好的方法&quot; class=&quot;headerlink&quot; title=&quot;thx, 有用自取,欢迎交流更好的方法&quot;&gt;&lt;/a&gt;thx, 有用自取,欢迎交流更好的方法&lt;/h2&gt;&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;在不改变按钮尺寸的前提下,扩大按钮的点击范围&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="项目技巧" scheme="http://yoursite.com/tags/%E9%A1%B9%E7%9B%AE%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>11-12月小回顾</title>
    <link href="http://yoursite.com/2015/12/17/11-12%E6%9C%88%E5%B0%8F%E5%9B%9E%E9%A1%BE/"/>
    <id>http://yoursite.com/2015/12/17/11-12月小回顾/</id>
    <published>2015-12-17T08:18:39.000Z</published>
    <updated>2015-12-17T10:15:49.000Z</updated>
    
    <content type="html">&lt;p&gt;&lt;br&gt;一晃眼,已经十二月中旬了&lt;br&gt;回顾上一次提笔已经过去了一月有余&lt;br&gt;这个月经历了还是蛮多的,看看能不能一一列出来&lt;br&gt;&lt;/p&gt;
&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;学习&quot;&gt;&lt;a href=&quot;#学习&quot; class=&quot;headerlink&quot; title=&quot;学习:&quot;&gt;&lt;/a&gt;学习:&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;swift2.1+的进展(优先级高,进度还好)&lt;/li&gt;
&lt;li&gt;RAC 的学习并且使用&lt;/li&gt;
&lt;li&gt;webP 的实际运用调研(关联到 webView 和网络请求管理)&lt;/li&gt;
&lt;li&gt;3DTouch 的学习使用&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;生活&quot;&gt;&lt;a href=&quot;#生活&quot; class=&quot;headerlink&quot; title=&quot;生活:&quot;&gt;&lt;/a&gt;生活:&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;坚持了一个星期的晚间锻炼…又松懈了,阿西吧&lt;/li&gt;
&lt;li&gt;吃早餐总算是坚持下来了&lt;/li&gt;
&lt;li&gt;回家的火车票已经搞定,过年来北京的票还没落实&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;工作&quot;&gt;&lt;a href=&quot;#工作&quot; class=&quot;headerlink&quot; title=&quot;工作:&quot;&gt;&lt;/a&gt;工作:&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;不断做需求&lt;/li&gt;
&lt;li&gt;不断做新东西&lt;/li&gt;
&lt;li&gt;不断改以前的 BUG&lt;/li&gt;
&lt;li&gt;没啥好说的了&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;BTW-说说最近那越滚越远了的思绪&quot;&gt;&lt;a href=&quot;#BTW-说说最近那越滚越远了的思绪&quot; class=&quot;headerlink&quot; title=&quot;BTW,说说最近那越滚越远了的思绪:&quot;&gt;&lt;/a&gt;BTW,说说最近那越滚越远了的思绪:&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;自己构思了N个App,将其列成了一个列表,并且开始动手设计其中一个 App,摸索着使用 Axure, 效果还不错(自我感觉),还打算用 swift 来制作,自己都想对自己说:呵呵.不过近期进度,设计部分停滞, swift 方面依然跟进,所以,还好吧.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;最近简直兴趣泛滥,对 U3D 制作游戏也开始有了兴趣,并且产生了一股制作一个卡牌类游戏的念头,甚是躁动,不过这事儿优先级不高,等上面那个忙活完了再说吧,O(∩_∩)O哈！&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;突然想了想,觉得我应该拥有 N 个 Blog,1个写技术(技术 Blog 要专一),1个私密的用来安放自己那颗愤青玛丽苏的❤️,一个用来对外的个人杂记.不过,想想就觉得麻烦…..还是藏在心里吧&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;/blockquote&gt;&lt;br&gt;一晃眼,已经十二月中旬了&lt;br&gt;回顾上一次提笔已经过去了一月有余&lt;br&gt;这个月经历了还是蛮多的,看看能不能一一列出来&lt;br&gt;&lt;/blockquote&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="杂事记二三" scheme="http://yoursite.com/categories/%E6%9D%82%E4%BA%8B%E8%AE%B0%E4%BA%8C%E4%B8%89/"/>
    
    
      <category term="杂记" scheme="http://yoursite.com/tags/%E6%9D%82%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>modal 后的层级结构与storyboard-的-dismiss</title>
    <link href="http://yoursite.com/2015/11/16/modal%20%E5%90%8E%E7%9A%84%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84%E4%B8%8Estoryboard-%E7%9A%84-dismiss/"/>
    <id>http://yoursite.com/2015/11/16/modal 后的层级结构与storyboard-的-dismiss/</id>
    <published>2015-11-16T09:40:10.000Z</published>
    <updated>2015-11-16T12:14:58.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;场景&quot;&gt;&lt;a href=&quot;#场景&quot; class=&quot;headerlink&quot; title=&quot;场景&quot;&gt;&lt;/a&gt;场景&lt;/h1&gt;&lt;p&gt;界面 A 被一个 Nav 所包含,界面 B 也被另一个 nav 所包含.&lt;br&gt;通过界面 A, 我们 modal 出一个界面 B.&lt;/p&gt;
&lt;h2 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title=&quot;效果:&quot;&gt;&lt;/a&gt;效果:&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/story及modal相关/testNavModal.gif&quot; width=&quot;375&quot; height=&quot;686&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;首先讲-storyboard-的-dismiss&quot;&gt;&lt;a href=&quot;#首先讲-storyboard-的-dismiss&quot; class=&quot;headerlink&quot; title=&quot;首先讲 storyboard 的 dismiss&quot;&gt;&lt;/a&gt;首先讲 storyboard 的 dismiss&lt;/h1&gt;&lt;h2 id=&quot;问题所在&quot;&gt;&lt;a href=&quot;#问题所在&quot; class=&quot;headerlink&quot; title=&quot;问题所在&quot;&gt;&lt;/a&gt;问题所在&lt;/h2&gt;&lt;p&gt;Q: 在 storyboard 中,无法直接拖线条的方式拖出 dismiss 效果.&lt;br&gt;A: 因为:storyboard 中得线条其实就是一条条的 segue.&lt;/p&gt;
&lt;p&gt;   Storyboard Segue 设计就是单向跳转。&lt;/p&gt;
&lt;p&gt;   每个 segue 都会创建一个目标控制器, 由调用 segue 的控制器作为来源控制器.就算表面上你看起来依然是由 A-&amp;gt;B,再 B-&amp;gt;A .但是这时候的 A 已经不是原来的 A 了,而是重新创建了一个 A.&lt;/p&gt;
&lt;p&gt;想要实现 storyboard 中的 dismiss, 方法如下:&lt;/p&gt;
&lt;h2 id=&quot;方法一&quot;&gt;&lt;a href=&quot;#方法一&quot; class=&quot;headerlink&quot; title=&quot;方法一:&quot;&gt;&lt;/a&gt;方法一:&lt;/h2&gt;&lt;p&gt;写一个自定义 segue 能做到，但任何时候都不应该用 segue 来做 pop 或 dismiss 。原因是会创建一个新的控制器,而非原来的.&lt;/p&gt;
&lt;h2 id=&quot;方法二&quot;&gt;&lt;a href=&quot;#方法二&quot; class=&quot;headerlink&quot; title=&quot;方法二:&quot;&gt;&lt;/a&gt;方法二:&lt;/h2&gt;&lt;p&gt;在界面 B 实现方法:&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (IBAction)&lt;span class=&quot;selector-tag&quot;&gt;back&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(id)sender&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;selector-attr&quot;&gt;[self dismissViewControllerAnimated:YES completion:nil]&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;方法三&quot;&gt;&lt;a href=&quot;#方法三&quot; class=&quot;headerlink&quot; title=&quot;方法三:&quot;&gt;&lt;/a&gt;方法三:&lt;/h2&gt;&lt;p&gt;想要在 B 界面点一个按钮,实现 B–&amp;gt;A, 那么:&lt;/p&gt;
&lt;p&gt;一. 在 A 里面实现一个空方法&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (IBAction)&lt;span class=&quot;selector-tag&quot;&gt;unwindSegueToRedViewController&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(UIStoryboardSegue&lt;/span&gt; *)&lt;span class=&quot;selector-tag&quot;&gt;segue&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;二. 在storyboard 中 B 上,添加一个按钮 button&lt;/p&gt;
&lt;p&gt;三. 在storyboard 中 A 上,点击&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/story及modal相关/QQ20151116-0.png&quot; width=&quot;180&quot; height=&quot;82&quot;&gt;,将出现的&lt;code&gt;unwindSegueXXX&lt;/code&gt;方法和界面 B 的 按钮 button 相连即可&lt;/p&gt;
&lt;h1 id=&quot;modal-后的视图层级&quot;&gt;&lt;a href=&quot;#modal-后的视图层级&quot; class=&quot;headerlink&quot; title=&quot;modal 后的视图层级&quot;&gt;&lt;/a&gt;modal 后的视图层级&lt;/h1&gt;&lt;p&gt;场景:在界面 A–&lt;code&gt;ViewController&lt;/code&gt;中,点击按钮, modal 出界面 B –&lt;code&gt;MyVC&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;在界面 A 打印下当前 Nav 的子控制器们,&lt;br&gt;在界面 B 打印下当前 Nav 的子控制器们及 &lt;code&gt;appdelegate&lt;/code&gt; 的 &lt;code&gt;rootViewController&lt;/code&gt; 的子控制器们&lt;br&gt;并且改变 nav 的颜色.&lt;/p&gt;
&lt;h2 id=&quot;效果-1&quot;&gt;&lt;a href=&quot;#效果-1&quot; class=&quot;headerlink&quot; title=&quot;效果:&quot;&gt;&lt;/a&gt;效果:&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/story及modal相关/testNavModal.gif&quot; width=&quot;375&quot; height=&quot;686&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;code&quot;&gt;&lt;a href=&quot;#code&quot; class=&quot;headerlink&quot; title=&quot;code:&quot;&gt;&lt;/a&gt;code:&lt;/h2&gt;&lt;p&gt;一. 在界面 A:&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)viewDidAppear:(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)animated&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewDidAppear:animated];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.navigationController viewControllers]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;打印结果:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ViewController: 0x7fdac9631de0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;二. 在界面 B:&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)viewDidAppear:(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)animated&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; viewDidAppear:animated];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.navigationController viewControllers]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UINavigationController&lt;/span&gt; *nav = (&lt;span class=&quot;built_in&quot;&gt;UINavigationController&lt;/span&gt; *)[&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; sharedApplication].keyWindow.rootViewController;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,[nav viewControllers]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [nav.navigationBar setBackgroundColor:[&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; orangeColor]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;打印结果:&lt;/p&gt;
&lt;p&gt;第一个 &lt;code&gt;NSLOG&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MyVC: 0x7fdac957c8e0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;第二个 &lt;code&gt;NSLOG&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ViewController: 0x7fdac9631de0&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#结论&quot; class=&quot;headerlink&quot; title=&quot;结论&quot;&gt;&lt;/a&gt;结论&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/story及modal相关/QQ20151116-1.png&quot; width=&quot;1013&quot; height=&quot;632&quot;&gt;&lt;/p&gt;
&lt;p&gt;可以看到,有界面 A 控制器 &lt;code&gt;modal&lt;/code&gt; 出来的界面 B,&lt;code&gt;[UIApplication sharedApplication].keyWindow.rootViewController&lt;/code&gt;指向的依然是界面 A, 虽然说我们用Xcode层级结构看不见.&lt;/p&gt;
&lt;p&gt;但是咱们用 &lt;code&gt;self.navigationController&lt;/code&gt;表示的却是当前控制器 B 的&lt;code&gt;navigationController&lt;/code&gt;&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;场景&quot;&gt;&lt;a href=&quot;#场景&quot; class=&quot;headerlink&quot; title=&quot;场景&quot;&gt;&lt;/a&gt;场景&lt;/h1&gt;&lt;p&gt;界面 A 被一个 Nav 所包含,界面 B 也被另一个 nav 所包含.&lt;br&gt;通过界面 A, 我们 modal 出一个界面 B.&lt;/p&gt;

    
    </summary>
    
    
      <category term="storyboard" scheme="http://yoursite.com/tags/storyboard/"/>
    
  </entry>
  
  <entry>
    <title>3D-TOUCH实践-学习</title>
    <link href="http://yoursite.com/2015/11/09/3D-TOUCH%E5%AE%9E%E8%B7%B5/"/>
    <id>http://yoursite.com/2015/11/09/3D-TOUCH实践/</id>
    <published>2015-11-09T03:42:17.000Z</published>
    <updated>2015-11-12T10:37:35.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;3DTouch是啥&quot;&gt;&lt;a href=&quot;#3DTouch是啥&quot; class=&quot;headerlink&quot; title=&quot;3DTouch是啥&quot;&gt;&lt;/a&gt;3DTouch是啥&lt;/h1&gt;&lt;p&gt;这是苹果2015年推出的 IOS9上的一个新特性:在屏幕上增加了一个压力的感触,通过区分轻按和重按来进行不同的用户交互,有Peek/Pop两种新手势.也就是Apple Watch上采用的Force Touch的升级版.&lt;/p&gt;
&lt;h1 id=&quot;how-to-start&quot;&gt;&lt;a href=&quot;#how-to-start&quot; class=&quot;headerlink&quot; title=&quot;how to start&quot;&gt;&lt;/a&gt;how to start&lt;/h1&gt;&lt;p&gt;首先,苹果说:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;With Xcode 7.0 you must develop on a device that supports 3D Touch. Simulator in Xcode 7.0 does not support 3D Touch.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;也就是 Xcode7可以搞,但是模拟器器不支持.&lt;br&gt;没关系,N 早就有牛人解决了这个问题.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;git地址：&lt;a href=&quot;https://github.com/DeskConnect/SBShortcutMenuSimulator。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/DeskConnect/SBShortcutMenuSimulator。&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;clone&quot;&gt;&lt;a href=&quot;#clone&quot; class=&quot;headerlink&quot; title=&quot;clone&quot;&gt;&lt;/a&gt;clone&lt;/h2&gt;&lt;p&gt;进入Termnial执行&lt;/p&gt;
&lt;figure class=&quot;highlight vim&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;git clone http&lt;span class=&quot;variable&quot;&gt;s:&lt;/span&gt;//github.&lt;span class=&quot;keyword&quot;&gt;com&lt;/span&gt;/DeskConnect/SBShortcutMenuSimulator.git&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;cd&lt;/span&gt; SBShortcutMenuSimulator&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;make&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;切换模拟器-电脑上只有-X7的可以跳过这一步&quot;&gt;&lt;a href=&quot;#切换模拟器-电脑上只有-X7的可以跳过这一步&quot; class=&quot;headerlink&quot; title=&quot;切换模拟器 (电脑上只有 X7的可以跳过这一步)&quot;&gt;&lt;/a&gt;切换模拟器 (电脑上只有 X7的可以跳过这一步)&lt;/h2&gt;&lt;p&gt;如果电脑里有多个 Xcode(比如我自己目前有 X6,X7两个版本),则需要先进行Xcode 路径设置,如下:&lt;/p&gt;
&lt;figure class=&quot;highlight gradle&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;sudo xcode-select -&lt;span class=&quot;keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;regexp&quot;&gt;/Applications/&lt;/span&gt;Xcode2.app&lt;span class=&quot;regexp&quot;&gt;/Contents/&lt;/span&gt;Developer&lt;span class=&quot;regexp&quot;&gt;/&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;PS:上面命令中,Xcode2.app是你电脑中Xcode的名字,这里如要特别注意,如果名字中有空格,需要修改一下,把空格去掉,否则会影响命令的执行。&lt;/p&gt;
&lt;h2 id=&quot;执行模拟器翻新&quot;&gt;&lt;a href=&quot;#执行模拟器翻新&quot; class=&quot;headerlink&quot; title=&quot;执行模拟器翻新(^_^)&quot;&gt;&lt;/a&gt;执行模拟器翻新(^_^)&lt;/h2&gt;&lt;p&gt;之后在SBShortcutMenuSimulator的目录中执行如下操作&lt;/p&gt;
&lt;figure class=&quot;highlight stylus&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;xcrun simctl spawn booted launchctl debug system/com&lt;span class=&quot;selector-class&quot;&gt;.apple&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SpringBoard&lt;/span&gt; --environment DYLD_INSERT_LIBRARIES=&lt;span class=&quot;variable&quot;&gt;$PWD&lt;/span&gt;/SBShortcutMenuSimulator&lt;span class=&quot;selector-class&quot;&gt;.dylib&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;xcrun simctl spawn booted launchctl stop com&lt;span class=&quot;selector-class&quot;&gt;.apple&lt;/span&gt;&lt;span class=&quot;selector-class&quot;&gt;.SpringBoard&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;测试一下&quot;&gt;&lt;a href=&quot;#测试一下&quot; class=&quot;headerlink&quot; title=&quot;测试一下&quot;&gt;&lt;/a&gt;测试一下&lt;/h2&gt;&lt;p&gt;我们可以通过向指定端口发送消息的方法来在模拟器上模拟3D Touch的效果(此处用的是日历 App, 自己的 App 记得改 BundleID)&lt;/p&gt;
&lt;p&gt;PS: 如果失效了,重置模拟器–&amp;gt;重复翻新步骤–&amp;gt; 接着 echo 就好了&lt;/p&gt;
&lt;figure class=&quot;highlight lsl&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;echo &#39;com.apple.mobilecal&#39; | nc &lt;span class=&quot;number&quot;&gt;127.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;.1&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;8000&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouch/QQ20151109-0.png&quot; width=&quot;375&quot; height=&quot;689&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;进行自定义3DTouch相关开发&quot;&gt;&lt;a href=&quot;#进行自定义3DTouch相关开发&quot; class=&quot;headerlink&quot; title=&quot;进行自定义3DTouch相关开发&quot;&gt;&lt;/a&gt;进行自定义3DTouch相关开发&lt;/h1&gt;&lt;h2 id=&quot;Quick-Actions&quot;&gt;&lt;a href=&quot;#Quick-Actions&quot; class=&quot;headerlink&quot; title=&quot;Quick Actions&quot;&gt;&lt;/a&gt;Quick Actions&lt;/h2&gt;&lt;h3 id=&quot;staticquick-actions&quot;&gt;&lt;a href=&quot;#staticquick-actions&quot; class=&quot;headerlink&quot; title=&quot;staticquick actions&quot;&gt;&lt;/a&gt;staticquick actions&lt;/h3&gt;&lt;p&gt;直接在 info.plist 里添加字段即可.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;UIApplicationShortcutItems,数组key 值&lt;/li&gt;
&lt;li&gt;每一个 item 内部如下:&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;下面的是必选的&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;UIApplicationShortcutItemTitle      - [string],quick actions名称(显示在手机桌面)&lt;/li&gt;
&lt;li&gt;UIApplicationShortcutItemType      - [string],quick actions类型(开发用)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;em&gt;下面的是可选的&lt;/em&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;UIApplicationShortcutItemSubtitle - [string],quick actions副标题(显示在上面的标题下)&lt;/li&gt;
&lt;li&gt;UIApplicationShortcutItemIconFile - [string],quick actions自定义图标,有尺寸要求,如果设置的话,就忽略UIApplicationShortcutItemIconType选项的内容&lt;/li&gt;
&lt;li&gt;UIApplicationShortcutItemIconType - [string],quick actions系统图标类型,有一堆预设的&lt;/li&gt;
&lt;li&gt;UIApplicationShortcutItemUserInfo - [array] ,quick actions自定义信息(开发用)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;API 介绍如下:&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouchQQ20151110-0.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;PS:quick actions系统图标的枚举如下.&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconType&lt;/span&gt; : &lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeCompose&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypePlay&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypePause&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeAdd&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeLocation&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeSearch&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeShare&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;comment&quot;&gt;//此处截断,上面的9.0+可用,下面的9.1+可用&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeProhibit&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeContact&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeHome&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeMarkLocation&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeFavorite&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeLove&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeCloud&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeInvitation&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeConfirmation&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeMail&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeMessage&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeDate&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeTime&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeCapturePhoto&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeCaptureVideo&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeTask&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeTaskCompleted&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeAlarm&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeBookmark&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeShuffle&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeAudio&lt;/span&gt;,&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconTypeUpdate&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; &lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutIconType&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouchQQ20151109-1.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;设置好以后,直接运行,退回到模拟器桌面,在命令行工具重复 echo 那句代码,可以看到效果&lt;/p&gt;
&lt;p&gt;要实现进入 App 后的操作,实现下面方法&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)application:(&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; *)application performActionForShortcutItem:(&lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutItem&lt;/span&gt; *)shortcutItem completionHandler:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;(^)(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; succeeded))completionHandler &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_0)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,shortcutItem);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;dynamic-quick-actions&quot;&gt;&lt;a href=&quot;#dynamic-quick-actions&quot; class=&quot;headerlink&quot; title=&quot;dynamic quick actions&quot;&gt;&lt;/a&gt;dynamic quick actions&lt;/h3&gt;&lt;p&gt;需要在代码里运行代码来添加到桌面上&lt;/p&gt;
&lt;p&gt;假设场景为:当用户进入过某页面后,更新3DTouch 中得某一个quick actions&lt;/p&gt;
&lt;p&gt;1.下面是生成dynamic quick actions的代码:&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//简单版&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;UIApplicationShortcutItem *item =[[UIApplicationShortcutItem alloc] &lt;span class=&quot;string&quot;&gt;initWithType:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;localizedTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;你点我试试&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//复杂版&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;UIApplicationShortcutItem *item2 = [[UIApplicationShortcutItem alloc] &lt;span class=&quot;string&quot;&gt;initWithType:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;test2&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;localizedTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;大哥,我错了,你别点我&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;localizedSubtitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;上有老,下有小...&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;icon:&lt;/span&gt;[UIApplicationShortcutIcon &lt;span class=&quot;string&quot;&gt;iconWithType:&lt;/span&gt;UIApplicationShortcutIconTypeLocation] &lt;span class=&quot;string&quot;&gt;userInfo:&lt;/span&gt;nil];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;记得添加到quick actions数组&lt;/p&gt;
&lt;figure class=&quot;highlight accesslog&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;[UIApplication sharedApplication]&lt;/span&gt;.shortcutItems = @&lt;span class=&quot;string&quot;&gt;[item,item2]&lt;/span&gt;;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;2.注意一个地方,正常启动 App 的时候,&lt;code&gt;launchOptions&lt;/code&gt;为 nil, 从3DTouch 启动的时候&lt;code&gt;launchOptions&lt;/code&gt;为一个包含有 &lt;code&gt;UIApplicationShortcutItem&lt;/code&gt; 对象的字典,我们应在合适的时候,此方法返回 NO 来避免重复调用&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;)application:(&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; *)application didFinishLaunchingWithOptions:(&lt;span class=&quot;built_in&quot;&gt;NSDictionary&lt;/span&gt; *)launchOptions &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Override point for customization after application launch.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,launchOptions);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;3.在 Appdelegate 文件里,实现下面方法来处理通过 qucikActions 进入 App 的情况:&lt;br&gt;(注意, static quick actions也是这个方法)&lt;br&gt;(注意2:这个方法会在&lt;code&gt;- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions&lt;/code&gt;调用完毕之后调用)&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)application:(&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; *)application performActionForShortcutItem:(&lt;span class=&quot;built_in&quot;&gt;UIApplicationShortcutItem&lt;/span&gt; *)shortcutItem completionHandler:(&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;(^)(&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt; succeeded))completionHandler &lt;span class=&quot;built_in&quot;&gt;NS_AVAILABLE_IOS&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;9&lt;/span&gt;_0)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,shortcutItem);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;dynamic-quick-actions的更新&quot;&gt;&lt;a href=&quot;#dynamic-quick-actions的更新&quot; class=&quot;headerlink&quot; title=&quot;dynamic quick actions的更新&quot;&gt;&lt;/a&gt;dynamic quick actions的更新&lt;/h3&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//1. 获取当前App 的所有quick actions&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSANSArray&lt;/span&gt; *existingShortcutItems = [[&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; sharedApplication] shortcutItems];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//2. 获取quick actions数组中某一个&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//3. 由于quick actions也分可变/不可变,所以我们要改变的时候,先 mutable 一下&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;UIMutableApplicationShortcutItem&lt;/span&gt; *curItem = [[existingShortcutItems objectAtIndex: &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;] mutableCopy];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//4. 更新数据&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[curItem setLocalizedTitle: &lt;span class=&quot;string&quot;&gt;@&quot;你再打我试试!&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//5. 更新quick actions数组&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSMutableArray&lt;/span&gt; *newShortcutItems = [existingShortcutItems mutableCopy];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[newShortcutItems replaceObjectAtIndex:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt; withObject:curItem];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;built_in&quot;&gt;UIApplication&lt;/span&gt; sharedApplication].shortcutItems = newShortcutItems;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;效果如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouchtest3dtouch.gif&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;dynamic-staticquick-actions区别&quot;&gt;&lt;a href=&quot;#dynamic-staticquick-actions区别&quot; class=&quot;headerlink&quot; title=&quot;dynamic/staticquick actions区别&quot;&gt;&lt;/a&gt;dynamic/staticquick actions区别&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;staticquick actions:就算程序从没有启动过,也可以正常使用(当然逻辑业务数据需要自己弄)&lt;/li&gt;
&lt;li&gt;dynamic quick actions:程序启动过一次以后就配置成功了.以后就可以正常使用了&lt;/li&gt;
&lt;li&gt;dynamic/staticquick actions主/副标题最多2行字,超出部分…&lt;/li&gt;
&lt;li&gt;dynamic/staticquick actions一共最多4个&lt;/li&gt;
&lt;li&gt;staticquick actions排序在dynamic quick actions上&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;—-分割线-下面的就没办法用模拟器了-必须6S-走起—&quot;&gt;&lt;a href=&quot;#—-分割线-下面的就没办法用模拟器了-必须6S-走起—&quot; class=&quot;headerlink&quot; title=&quot;—-分割线,下面的就没办法用模拟器了,必须6S 走起—-&quot;&gt;&lt;/a&gt;—-分割线,下面的就没办法用模拟器了,必须6S 走起—-&lt;/h2&gt;&lt;h2 id=&quot;Peek-amp-Pop&quot;&gt;&lt;a href=&quot;#Peek-amp-Pop&quot; class=&quot;headerlink&quot; title=&quot;Peek &amp;amp; Pop&quot;&gt;&lt;/a&gt;Peek &amp;amp; Pop&lt;/h2&gt;&lt;p&gt;peek&amp;amp;pop 是敲击预览&lt;/p&gt;
&lt;p&gt;在App 内部,随着用户按压力量的增加，交互会出现三个阶段:  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;暗示内容预览是可使用的  &lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;展示预览(peek)，和快捷选项菜单（peek quick actions）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;可选的跳转到预览中的视图(pop)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;当你使用 peek 和 pop 时,系统通过压力决定从哪个阶段过度至下一个。&lt;/p&gt;
&lt;p&gt;说了这么多,其实就是一个字:用力按屏幕!&lt;/p&gt;
&lt;h3 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title=&quot;效果&quot;&gt;&lt;/a&gt;效果&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouchD3D67E514BA44620B7F1BABC5EB61E96.png&quot; width=&quot;375&quot; height=&quot;689&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouch4054B455B5292C9DEEA21AFF45A484F7.png&quot; width=&quot;375&quot; height=&quot;689&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouchE76A2A38560D39B7C71148DE91BF39C9.png&quot; width=&quot;375&quot; height=&quot;689&quot;&gt;&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/3DTouchA7609212F37B234A37A51D57FDF714D4.png&quot; width=&quot;375&quot; height=&quot;689&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;code&quot;&gt;&lt;a href=&quot;#code&quot; class=&quot;headerlink&quot; title=&quot;code&quot;&gt;&lt;/a&gt;code&lt;/h3&gt;&lt;p&gt;场景:界面 A 有一堆 cell, 用户可以通过 peek&amp;amp;pop 弹出预览视图界面 B,并且有一些自定义选项给用户选择&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;界面 A 遵循协议&lt;code&gt;UIViewControllerPreviewingDelegate&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;界面 A 实现2个方法&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)previewingContext:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIViewControllerPreviewing&lt;/span&gt;&amp;gt;)previewingContext commitViewController:(&lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; *)viewControllerToCommit &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;comment&quot;&gt;//显示目前 VC&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; showViewController:viewControllerToCommit sender:&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; *)previewingContext:(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIViewControllerPreviewing&lt;/span&gt;&amp;gt;)previewingContext viewControllerForLocation:(&lt;span class=&quot;built_in&quot;&gt;CGPoint&lt;/span&gt;)location &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 从 storyboard 创建的 VC&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIStoryboard&lt;/span&gt; *sb = [&lt;span class=&quot;built_in&quot;&gt;UIStoryboard&lt;/span&gt; storyboardWithName:&lt;span class=&quot;string&quot;&gt;@&quot;Main&quot;&lt;/span&gt; bundle:[&lt;span class=&quot;built_in&quot;&gt;NSBundle&lt;/span&gt; mainBundle]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    TableSonViewController *previewController = [sb instantiateViewControllerWithIdentifier:&lt;span class=&quot;string&quot;&gt;@&quot;TableSonViewController&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//实际显示的预览 view 的尺寸,注意,会从目前 VC 的中心朝四周截取对应的尺寸&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    previewController.preferredContentSize = &lt;span class=&quot;built_in&quot;&gt;CGSizeMake&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;400&lt;/span&gt;,&lt;span class=&quot;number&quot;&gt;600&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    previewingContext.sourceRect = previewController.view.bounds;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; previewController;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;上面2个方法,就可以让界面 A 通过强力指压,出现预览页面了.注意,预览页面的数据也在此处进行设置.&lt;/li&gt;
&lt;li&gt;界面 B 如果需要在预览的时候提供自定义按钮,则需要实现一个方法&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSArray&lt;/span&gt;&amp;lt;&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;&amp;lt;&lt;span class=&quot;built_in&quot;&gt;UIPreviewActionItem&lt;/span&gt;&amp;gt;&amp;gt; *)previewActionItems&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; *itemShare = [&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; actionWithTitle:&lt;span class=&quot;string&quot;&gt;@&quot;分享&quot;&lt;/span&gt; style:&lt;span class=&quot;built_in&quot;&gt;UIPreviewActionStyleDefault&lt;/span&gt; handler:^(&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; * _Nonnull action, &lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; * _Nonnull previewViewController) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;built_in&quot;&gt;UIAlertView&lt;/span&gt; *alertView = [[&lt;span class=&quot;built_in&quot;&gt;UIAlertView&lt;/span&gt; alloc] initWithTitle:&lt;span class=&quot;string&quot;&gt;@&quot;分享&quot;&lt;/span&gt; message:&lt;span class=&quot;string&quot;&gt;@&quot;分享内容&quot;&lt;/span&gt; delegate:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt; cancelButtonTitle:&lt;span class=&quot;string&quot;&gt;@&quot;确定&quot;&lt;/span&gt; otherButtonTitles: &lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [alertView show];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; *itemDelete = [&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; actionWithTitle:&lt;span class=&quot;string&quot;&gt;@&quot;删除&quot;&lt;/span&gt; style:&lt;span class=&quot;built_in&quot;&gt;UIPreviewActionStyleDestructive&lt;/span&gt; handler:^(&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; * _Nonnull action, &lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; * _Nonnull previewViewController) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;删除了&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; *itemSelect = [&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; actionWithTitle:&lt;span class=&quot;string&quot;&gt;@&quot;选择&quot;&lt;/span&gt; style:&lt;span class=&quot;built_in&quot;&gt;UIPreviewActionStyleSelected&lt;/span&gt; handler:^(&lt;span class=&quot;built_in&quot;&gt;UIPreviewAction&lt;/span&gt; * _Nonnull action, &lt;span class=&quot;built_in&quot;&gt;UIViewController&lt;/span&gt; * _Nonnull previewViewController) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;我的选择&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; @[itemShare,itemDelete,itemSelect];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ol&gt;
&lt;li&gt;最后一个,当出现预览界面 B 的时候, B 的&lt;code&gt;viewDidLoad&lt;/code&gt;方法也会正常执行,销毁的时候&lt;code&gt;dealloc&lt;/code&gt;也会执行&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;have-fun&quot;&gt;&lt;a href=&quot;#have-fun&quot; class=&quot;headerlink&quot; title=&quot;have fun&quot;&gt;&lt;/a&gt;have fun&lt;/h3&gt;&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;3DTouch是啥&quot;&gt;&lt;a href=&quot;#3DTouch是啥&quot; class=&quot;headerlink&quot; title=&quot;3DTouch是啥&quot;&gt;&lt;/a&gt;3DTouch是啥&lt;/h1&gt;&lt;p&gt;这是苹果2015年推出的 IOS9上的一个新特性:在屏幕上增加了一个压力的感触,通过
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>快速查看某个 View 的视图层次</title>
    <link href="http://yoursite.com/2015/11/05/%E5%BF%AB%E9%80%9F%E6%9F%A5%E7%9C%8B%E6%9F%90%E4%B8%AA-View-%E7%9A%84%E8%A7%86%E5%9B%BE%E5%B1%82%E6%AC%A1/"/>
    <id>http://yoursite.com/2015/11/05/快速查看某个-View-的视图层次/</id>
    <published>2015-11-05T06:57:47.000Z</published>
    <updated>2015-11-05T07:09:05.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;命令行查看视图层级&quot;&gt;&lt;a href=&quot;#命令行查看视图层级&quot; class=&quot;headerlink&quot; title=&quot;命令行查看视图层级&quot;&gt;&lt;/a&gt;命令行查看视图层级&lt;/h1&gt;&lt;p&gt;在某个 view 的有效范围内,断点,然后命令行输出:如下&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;po [view recursiveDescription]&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;即可立刻显示该 View 及子 View 的视图层级,相当霸气~还自带分隔线&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/查看视图结构/QQ20151105-0.png&quot; width=&quot;702&quot; height=&quot;156&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;看看视图结构是否能对应上-IB-里的&quot;&gt;&lt;a href=&quot;#看看视图结构是否能对应上-IB-里的&quot; class=&quot;headerlink&quot; title=&quot;看看视图结构是否能对应上 IB 里的&quot;&gt;&lt;/a&gt;看看视图结构是否能对应上 IB 里的&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/查看视图结构/QQ20151105-1.png&quot; width=&quot;1326&quot; height=&quot;692&quot;&gt;&lt;/p&gt;
&lt;p&gt;对应的很完美~&lt;/p&gt;
&lt;h1 id=&quot;有魔法-放心爱&quot;&gt;&lt;a href=&quot;#有魔法-放心爱&quot; class=&quot;headerlink&quot; title=&quot;有魔法,放心爱~&quot;&gt;&lt;/a&gt;有魔法,放心爱~&lt;/h1&gt;&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;命令行查看视图层级&quot;&gt;&lt;a href=&quot;#命令行查看视图层级&quot; class=&quot;headerlink&quot; title=&quot;命令行查看视图层级&quot;&gt;&lt;/a&gt;命令行查看视图层级&lt;/h1&gt;&lt;p&gt;在某个 view 的有效范围内,断点,然后命令行输出:如下&lt;/p&gt;
&lt;blockqu
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>探究浮点数</title>
    <link href="http://yoursite.com/2015/10/29/%E6%8E%A2%E7%A9%B6%E6%B5%AE%E7%82%B9%E6%95%B0/"/>
    <id>http://yoursite.com/2015/10/29/探究浮点数/</id>
    <published>2015-10-28T16:01:54.000Z</published>
    <updated>2015-10-28T16:19:24.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;浮点数有什么可研究的&quot;&gt;&lt;a href=&quot;#浮点数有什么可研究的&quot; class=&quot;headerlink&quot; title=&quot;浮点数有什么可研究的&quot;&gt;&lt;/a&gt;浮点数有什么可研究的&lt;/h2&gt;&lt;h3 id=&quot;先看代码&quot;&gt;&lt;a href=&quot;#先看代码&quot; class=&quot;headerlink&quot; title=&quot;先看代码&quot;&gt;&lt;/a&gt;先看代码&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数/123.jpg&quot; width=&quot;600&quot; height=&quot;260&quot;&gt;&lt;/p&gt;
&lt;p&gt;为何明明看起来很”整”的”小数”,并不像我们想象中,而是要么多了点儿,要么少了点儿,为什么会有这个情况发生?&lt;/p&gt;
&lt;h2 id=&quot;何为浮点数&quot;&gt;&lt;a href=&quot;#何为浮点数&quot; class=&quot;headerlink&quot; title=&quot;何为浮点数&quot;&gt;&lt;/a&gt;何为浮点数&lt;/h2&gt;&lt;p&gt;先问大家一个问题:  浮点数等价于小数吗?&lt;/p&gt;
&lt;p&gt;那么,我们先了解下浮点数与对应的定点数&lt;/p&gt;
&lt;h3 id=&quot;定点数&quot;&gt;&lt;a href=&quot;#定点数&quot; class=&quot;headerlink&quot; title=&quot;定点数&quot;&gt;&lt;/a&gt;定点数&lt;/h3&gt;&lt;p&gt;小数点在计算机中通常有两种表示方法,一种是约定所有数值数据的小数点隐含在某一个固定位置上，称为定点表 示法，简称 定点数 ；&lt;/p&gt;
&lt;p&gt;通常将小数点的位置固定在数据的最高位之前， 一般常称为定点小数(纯小数)&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数QQ20151028-2@2x.png&quot; width=&quot;400&quot; height=&quot;210&quot;&gt;&lt;/p&gt;
&lt;p&gt;或者是固定在最低位之后,称为定点整数(纯整数)。&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数QQ20151028-3@2x.png&quot; width=&quot;400&quot; height=&quot;210&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;浮点数&quot;&gt;&lt;a href=&quot;#浮点数&quot; class=&quot;headerlink&quot; title=&quot;浮点数&quot;&gt;&lt;/a&gt;浮点数&lt;/h3&gt;&lt;p&gt;数值的小数点可以在不同位置上任意浮动，称为浮点表示法，简称浮点数;&lt;br&gt;而通常小数可以用科学计数法表示,小数点位置可以任意移动,因此小数也被很多人直接等同于浮点数.&lt;/p&gt;
&lt;h2 id=&quot;计算机中的浮点数&quot;&gt;&lt;a href=&quot;#计算机中的浮点数&quot; class=&quot;headerlink&quot; title=&quot;计算机中的浮点数&quot;&gt;&lt;/a&gt;计算机中的浮点数&lt;/h2&gt;&lt;h3 id=&quot;浮点数的存储方式&quot;&gt;&lt;a href=&quot;#浮点数的存储方式&quot; class=&quot;headerlink&quot; title=&quot;浮点数的存储方式&quot;&gt;&lt;/a&gt;浮点数的存储方式&lt;/h3&gt;&lt;p&gt;C语言中，对于浮点类型的数据采用单精度类型（float）和双精度类型(double),按照浮点数存储标准(IEEE 制定)来存储，float数据占用32bit,double数据占用64bit&lt;/p&gt;
&lt;p&gt;无论是单精度还是双精度在存储中都分为三个部分：&lt;br&gt;符号位(Sign) : 0代表正，1代表负&lt;br&gt;指数位（Exponent）:用于存储科学计数法中的指数数据，并且采用移位存储方式&lt;br&gt;尾数部分（Mantissa）：尾数部分&lt;/p&gt;
&lt;p&gt;其中单精度的存储方式如下图所示：&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数QQ20151028-0@2x.png&quot; width=&quot;400&quot; height=&quot;210&quot;&gt;&lt;/p&gt;
&lt;p&gt;而双精度的存储方式为:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数QQ20151028-1@2x.png&quot; width=&quot;400&quot; height=&quot;210&quot;&gt;&lt;/p&gt;
&lt;p&gt;PS:以下没有特别声明的研究都建立在单精度上&lt;/p&gt;
&lt;p&gt;而IEEE都是用科学计数法来存储数据的,9.125存储为:9.125*10^0.&lt;/p&gt;
&lt;p&gt;在十进制中,指数的基数位10,并且表示小数点移动多少位以生成系数.&lt;/p&gt;
&lt;p&gt;但是,计算机根本不认识十进制的数据，他只认识0，1.所以在计算机存储中，首先要将上面的数更改为二进制的数据,相应的,科学计数法也要改成二进制的.&lt;/p&gt;
&lt;p&gt;系数和指数基于二进制,那么用 XXX*2^N 即可&lt;/p&gt;
&lt;p&gt;单精度尾数有23bit, 但是加上固定的一位整数位1,实际可表示精度的有24bit.&lt;br&gt;而根据9==&amp;gt;1001二进制转换,4个 bit 可以表示1位十进制.所以24bit/4 = 6位.&lt;br&gt;所以. float 可以精度到小数点6位.double 可以精确到小数点13位&lt;/p&gt;
&lt;h3 id=&quot;十进制转换二进制&quot;&gt;&lt;a href=&quot;#十进制转换二进制&quot; class=&quot;headerlink&quot; title=&quot;十进制转换二进制&quot;&gt;&lt;/a&gt;十进制转换二进制&lt;/h3&gt;&lt;p&gt;整数转换二进制很简单,9 ==&amp;gt; 1001&lt;/p&gt;
&lt;p&gt;小数部分怎么转换?&lt;br&gt;小数部分转换二进制方法为—&amp;gt;小数乘以2,取整,小数部分继续乘以2,取整,得到小数部分0为止,将整数顺序排列.&lt;/p&gt;
&lt;p&gt;比如0.2&lt;br&gt;0.2&lt;em&gt;2 = 0.4,取整0,小数部分0.4&lt;br&gt;0.4&lt;/em&gt;2 = 0.8,取整0,小数部分0.8&lt;br&gt;0.8&lt;em&gt;2 = 1.6,取整1,小数部分0.6&lt;br&gt;0.6&lt;/em&gt;2 = 1.2,取整1,小数部分0.2&lt;br&gt;….无限循环&lt;br&gt;即为0011*N&lt;/p&gt;
&lt;p&gt;简便办法(虽然并没有多简便),也可以用分数来&lt;br&gt;二进制           分数                                                   十进制&lt;br&gt;0.1          1/(2的1次方&lt;em&gt;1)                                             0.5&lt;br&gt;0.01        1/(2的1次方&lt;/em&gt;0)+1/(2的2次方*1) ==&amp;gt; 1/4      0.25&lt;/p&gt;
&lt;h3 id=&quot;转换二进制后又怎么存储&quot;&gt;&lt;a href=&quot;#转换二进制后又怎么存储&quot; class=&quot;headerlink&quot; title=&quot;转换二进制后又怎么存储&quot;&gt;&lt;/a&gt;转换二进制后又怎么存储&lt;/h3&gt;&lt;p&gt;任何一个数的科学计数法表示都为(+/-)1.xxx*2^N,+/-表示符号位,尾数部分就可以表示为xxxx,指数部分用 N&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;整数部分第一位都是1,所以可以直接省略.&lt;/li&gt;
&lt;li&gt;对于指数部分N,因为指数可正可负，8位的指数位能表示的指数范围就应该为:-127~128,所以可以对他进行置偏,根据浮点数的存储标注(IEEE),float 类型的指数起始数为127(二进制0111 1111),double类型的指数起始数为1023(二进制011 1111 1111),在此基础上加指数,得到的就是内存中的指数的表示形式.所以指数部分的存储采用移位存储，存储的数据为32位则元数据+127   ,64位则+1023&lt;/li&gt;
&lt;li&gt;尾数则直接填入,位数不够则补0,位数过多则0舍1入&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;举个栗子🌰:&lt;/p&gt;
&lt;p&gt;接之前:9.125 ==&amp;gt;1001.001&lt;em&gt;2^0 ==&amp;gt; 1.001001&lt;/em&gt;2^3&lt;/p&gt;
&lt;p&gt;9.125==&amp;gt;9==&amp;gt;1001&lt;br&gt;0.125==&amp;gt;&lt;br&gt;0.125&lt;em&gt;2 = 0.25 ==&amp;gt;     取整0,余数0.25        ==&amp;gt;0&lt;br&gt;0.25&lt;/em&gt;2   = 0.5   ==&amp;gt;     取整0,余数0.5          ==&amp;gt;0&lt;br&gt;0.5*2     = 1.0   ==&amp;gt;     取整1                       ==&amp;gt;1&lt;/p&gt;
&lt;p&gt;拼接后&lt;br&gt;9.125 ==&amp;gt; 1001.001==&amp;gt; 1.001001*2^3&lt;/p&gt;
&lt;p&gt;1.001001*2^3 ==&amp;gt;&lt;br&gt;0  127 +3         0010 01 ==&amp;gt;&lt;br&gt;0  1000 0001    0010 01 ==&amp;gt;&lt;/p&gt;
&lt;p&gt;所以内存里9.125实际存储的为 01000001000100100000000000000000 这一段二进制&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数QQ20151028-4@2x.png&quot; width=&quot;500&quot; height=&quot;260&quot;&gt;&lt;/p&gt;
&lt;p&gt;再来看2.2,咱们倒着推:&lt;/p&gt;
&lt;p&gt;2.2—&amp;gt;整数部分 10,小数部分看上面 知道了是0011&lt;em&gt;N&lt;br&gt;10.00110011001100110011001100110011…&lt;br&gt;1.0 0011 0011…&lt;/em&gt;2^1&lt;br&gt;0      1                    0 0011 0011&lt;br&gt;0      127+1            0 0011 0011&lt;br&gt;0      128                0 0011 0011&lt;br&gt;0      1000 0000     0 0011 0011&lt;br&gt;0      1000 0000      00011 0011 0011 0011 0011 00—&amp;gt;小数部分23位&lt;br&gt;0 0111 1110 00110011001100110011000&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数/A78F4D22-DE32-41A2-9083-D83852E692B0.png&quot; width=&quot;500&quot; height=&quot;260&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;精度丢失是什么&quot;&gt;&lt;a href=&quot;#精度丢失是什么&quot; class=&quot;headerlink&quot; title=&quot;精度丢失是什么&quot;&gt;&lt;/a&gt;精度丢失是什么&lt;/h3&gt;&lt;p&gt;2.2转换成二进制为0 0111 1110 00110011001100110011 ….无穷,但是因为 float 和 double 存储的位数都有限,那么超出位数部分的肯定就被截断了.&lt;br&gt;这就导致2.2最终被保留下来的可能就是:&lt;br&gt;0 (1位符号位)  0111 1110(8位指数位)    00110011001100110011…(23位位数)&lt;/p&gt;
&lt;p&gt;那么我们将这一段太监二进制再转换回十进制以后,他一定不完整了~ 符号位和指数位一定安全,但是尾数部分 00110011001100110011…(23位位数)肯定和 0011^N 代表的值不一样.&lt;br&gt;so, 精度丢失了.丢失在保存为二进制和转换回去的时候.&lt;/p&gt;
&lt;p&gt;回头过来看代码&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数/123.jpg&quot; width=&quot;580&quot; height=&quot;260&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/浮点数/321.jpg&quot; width=&quot;180&quot; height=&quot;130&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;特殊数&quot;&gt;&lt;a href=&quot;#特殊数&quot; class=&quot;headerlink&quot; title=&quot;特殊数&quot;&gt;&lt;/a&gt;特殊数&lt;/h3&gt;&lt;h4 id=&quot;NaN&quot;&gt;&lt;a href=&quot;#NaN&quot; class=&quot;headerlink&quot; title=&quot;NaN&quot;&gt;&lt;/a&gt;NaN&lt;/h4&gt;&lt;p&gt;上面提到的指数位为-127或者+128的时候,其实是保留了做特殊用途的.&lt;br&gt;关于这一系列特殊数,相当有意思.特别是 NaN(Not a Number)&lt;br&gt;可以看看&lt;a href=&quot;http://www.cnblogs.com/kingwolfofsky/archive/2011/07/21/2112299.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这篇文章&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#总结&quot; class=&quot;headerlink&quot; title=&quot;总结&quot;&gt;&lt;/a&gt;总结&lt;/h2&gt;&lt;h3 id=&quot;浮点数存储方式&quot;&gt;&lt;a href=&quot;#浮点数存储方式&quot; class=&quot;headerlink&quot; title=&quot;浮点数存储方式&quot;&gt;&lt;/a&gt;浮点数存储方式&lt;/h3&gt;&lt;p&gt;要把小数装入计算机，总共分几步？你猜对了，3 步。&lt;/p&gt;
&lt;p&gt;第一步：转换成二进制&lt;br&gt;第二步：用二进制科学计算法表示&lt;br&gt;第三步：表示成 IEEE 形式&lt;/p&gt;
&lt;p&gt;在上面的第一步和第三步都有可能 丢失精度。&lt;/p&gt;
&lt;h3 id=&quot;有浮点数可以不丢失精度么&quot;&gt;&lt;a href=&quot;#有浮点数可以不丢失精度么&quot; class=&quot;headerlink&quot; title=&quot;有浮点数可以不丢失精度么?&quot;&gt;&lt;/a&gt;有浮点数可以不丢失精度么?&lt;/h3&gt;&lt;p&gt;有,通常来说不丢失精度的小数最后一位都是5,但是位数是5的不一定不丢失.&lt;br&gt;为什么?可以按照之前的方法算一算就知道了&lt;/p&gt;
&lt;p&gt;PS:&lt;a href=&quot;http://jinzhi.supfree.net/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;任意进制转换-网站&lt;/a&gt;&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;浮点数有什么可研究的&quot;&gt;&lt;a href=&quot;#浮点数有什么可研究的&quot; class=&quot;headerlink&quot; title=&quot;浮点数有什么可研究的&quot;&gt;&lt;/a&gt;浮点数有什么可研究的&lt;/h2&gt;&lt;h3 id=&quot;先看代码&quot;&gt;&lt;a href=&quot;#先看代码&quot; class=&quot;head
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>instancetype 与 id</title>
    <link href="http://yoursite.com/2015/10/25/instancetype-%E4%B8%8E-id/"/>
    <id>http://yoursite.com/2015/10/25/instancetype-与-id/</id>
    <published>2015-10-25T07:35:37.000Z</published>
    <updated>2015-10-25T12:08:46.000Z</updated>
    
    <content type="html">&lt;h2 id=&quot;what’s-instancetype&quot;&gt;&lt;a href=&quot;#what’s-instancetype&quot; class=&quot;headerlink&quot; title=&quot;what’s instancetype&quot;&gt;&lt;/a&gt;what’s instancetype&lt;/h2&gt;&lt;p&gt;&lt;code&gt;instancetype&lt;/code&gt; 是和 &lt;code&gt;id&lt;/code&gt; 一样的返回值类型,都表示返回值的类型不确定.&lt;/p&gt;
&lt;h2 id=&quot;different-with-id&quot;&gt;&lt;a href=&quot;#different-with-id&quot; class=&quot;headerlink&quot; title=&quot;different with id&quot;&gt;&lt;/a&gt;different with id&lt;/h2&gt;&lt;p&gt;通过下面的代码可以很清楚的看出区别:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/instancetypeQQ20151025-0@2x.png&quot; width=&quot;400&quot; height=&quot;80&quot;&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;其实2个方法返回的都是Person类实例对象.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;但是用 instancetype 作为返回值类型的方法,编译器可以清楚的知道它现在的类别,所以我们可以正常调用该类的一些属性和方法&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;而 id 作为返回值类型的,其类型在编译器看来就是一个不确定的类型,无法当做 Person 类使用,除非进行类型转换&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;instancetype 不能像 id 一样作为参数的类型修饰&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;子类调用&quot;&gt;&lt;a href=&quot;#子类调用&quot; class=&quot;headerlink&quot; title=&quot;子类调用&quot;&gt;&lt;/a&gt;子类调用&lt;/h3&gt;&lt;p&gt;可以看到子类调用父类的方法,&lt;code&gt;instancetype&lt;/code&gt;返回的是子类的类型&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/instancetypeQQ20151025-2@2x.png&quot; width=&quot;400&quot; height=&quot;100&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#结论&quot; class=&quot;headerlink&quot; title=&quot;结论&quot;&gt;&lt;/a&gt;结论&lt;/h2&gt;&lt;p&gt;合理的使用&lt;code&gt;instancetype&lt;/code&gt;,可以帮助我们在编码时更轻松~&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;what’s-instancetype&quot;&gt;&lt;a href=&quot;#what’s-instancetype&quot; class=&quot;headerlink&quot; title=&quot;what’s instancetype&quot;&gt;&lt;/a&gt;what’s instancetype&lt;/h2&gt;&lt;p&gt;&lt;c
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>RAC学习笔记</title>
    <link href="http://yoursite.com/2015/10/23/RAC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <id>http://yoursite.com/2015/10/23/RAC学习笔记/</id>
    <published>2015-10-23T15:35:28.000Z</published>
    <updated>2015-10-25T13:13:46.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;体会-RAC-的魅力&quot;&gt;&lt;a href=&quot;#体会-RAC-的魅力&quot; class=&quot;headerlink&quot; title=&quot;体会 RAC 的魅力&quot;&gt;&lt;/a&gt;体会 RAC 的魅力&lt;/h1&gt;&lt;p&gt;大多数朋友可能和我一样,刚接触 RAC 的时候一头雾水~&lt;/p&gt;
&lt;p&gt;so,我们通过一次体验来认识 RAC~&lt;/p&gt;
&lt;p&gt;&lt;em&gt;下面我要举个栗子:&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151023-5@2x.png&quot; width=&quot;260&quot; height=&quot;200&quot;&gt;&lt;/p&gt;
&lt;p&gt;我们对 username 和 password 进行监听,当输入任何值时候,我们打印it&lt;/p&gt;
&lt;p&gt;PS:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;栗子来源&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://cdn2.raywenderlich.com/wp-content/uploads/2014/01/ReactivePlayground-Starter.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;栗子工程下载&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;咱们直接用起来,RAC 可以用如下代码解决:&lt;/p&gt;
&lt;h2 id=&quot;subscribeNext–订阅者的回调-block&quot;&gt;&lt;a href=&quot;#subscribeNext–订阅者的回调-block&quot; class=&quot;headerlink&quot; title=&quot;subscribeNext–订阅者的回调 block&quot;&gt;&lt;/a&gt;subscribeNext–订阅者的回调 block&lt;/h2&gt;&lt;p&gt;对usernameTextField的 text 进行监听,一旦有新值则调用 subscribeNext block&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[self.usernameTextField.rac_textSignal subscribeNext:^(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;%@&quot;&lt;/span&gt;, x)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时,结果如下:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-0@2x.png&quot; width=&quot;500&quot; height=&quot;170&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;filter–过滤&quot;&gt;&lt;a href=&quot;#filter–过滤&quot; class=&quot;headerlink&quot; title=&quot;filter–过滤&quot;&gt;&lt;/a&gt;filter–过滤&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;对usernameTextField的 text 进行监听&lt;/li&gt;
&lt;li&gt;当filter 返回 YES 的时候,才调用 subscribeNext block&lt;/li&gt;
&lt;li&gt;当filter 返回 NO  的时候,不调用 subscribeNext block&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//当usernameTextField的 text 长度&amp;gt;3的时候,才调用subscribeNext block&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.usernameTextField.rac_textSignal filter:^&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; value)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *text = value;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; text.length &amp;gt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; subscribeNext:^(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;, x);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果如下,从4个 q 开始输出&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-1@2x.png&quot; width=&quot;500&quot; height=&quot;160&quot;&gt;&lt;/p&gt;
&lt;p&gt;你会发现下面的代码和上面的代码有一样的效果,下面的代码中我将每一步分离出来了,更有效的帮助我们理解 RAC 的运行过程&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//获取一个 Signal &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *usernameSourceSignal = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.usernameTextField.rac_textSignal;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//将 usernameSourceSignal 经过 filter 过滤一下,返回一个经过 filter 包装后的崭新 Signal&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//此时,只有当 usernameSourceSignal 满足 filter 的条件时,才能返回一个包装成功的崭新 Signal&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *filteredUsername = [usernameSourceSignal filter:^&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; value)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;									&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt;*text = value;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;									&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; text.length &amp;gt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                               &amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//包装后的 Signal 依然是对最初的 self.usernameTextField 进行 text 的监听&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//不过此时订阅到得 text 值都是经历过 filter 筛选后能满足条件的值&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[filteredUsername subscribeNext:^(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;, x);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;map–转换传值&quot;&gt;&lt;a href=&quot;#map–转换传值&quot; class=&quot;headerlink&quot; title=&quot;map–转换传值&quot;&gt;&lt;/a&gt;map–转换传值&lt;/h2&gt;&lt;p&gt;&lt;code&gt;map&lt;/code&gt;从上一个&lt;code&gt;next&lt;/code&gt;事件接收数据，通过执行&lt;code&gt;block&lt;/code&gt;把自定义的返回值传给下一个&lt;code&gt;next&lt;/code&gt;事件。&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//监听self.usernameTextField的 text 值变化&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[[[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.usernameTextField.rac_textSignal map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt;*text)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; @(text.length);				&lt;span class=&quot;comment&quot;&gt;//将得到的 text 新值改变为@(text.length)传给 filter&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   filter:^&lt;span class=&quot;built_in&quot;&gt;BOOL&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt;*length)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;[length integerValue] &amp;gt; &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;;	&lt;span class=&quot;comment&quot;&gt;//判断订阅到得值是否大于3来决定是否传递&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   subscribeNext:^(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;, x);					&lt;span class=&quot;comment&quot;&gt;//订阅到新值就打印&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时,结果如下,输出的变成了数字(字符串长度),而且从4开始输出:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-2@2x.png&quot; width=&quot;500&quot; height=&quot;160&quot;&gt;&lt;/p&gt;
&lt;p&gt;在上面的代码中，&lt;code&gt;map&lt;/code&gt;以&lt;code&gt;NSString&lt;/code&gt;为输入，取字符串的长度，返回一个&lt;code&gt;NSNumber&lt;/code&gt;。&lt;/p&gt;
&lt;h1 id=&quot;自定义-RAC&quot;&gt;&lt;a href=&quot;#自定义-RAC&quot; class=&quot;headerlink&quot; title=&quot;自定义 RAC&quot;&gt;&lt;/a&gt;自定义 RAC&lt;/h1&gt;&lt;h2 id=&quot;RAC&quot;&gt;&lt;a href=&quot;#RAC&quot; class=&quot;headerlink&quot; title=&quot;RAC&quot;&gt;&lt;/a&gt;RAC&lt;/h2&gt;&lt;p&gt;ReactiveCocoa signal（RACSignal）发送事件流给它的subscriber。目前总共有三种类型的事件：&lt;code&gt;next&lt;/code&gt;、&lt;code&gt;error&lt;/code&gt;、&lt;code&gt;completed&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;一个signal在因error终止或者完成前，可以发送任意数量的next事件。&lt;/p&gt;
&lt;h2 id=&quot;自定义RACSignal使用步骤&quot;&gt;&lt;a href=&quot;#自定义RACSignal使用步骤&quot; class=&quot;headerlink&quot; title=&quot;自定义RACSignal使用步骤&quot;&gt;&lt;/a&gt;自定义RACSignal使用步骤&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;创建信号,&lt;code&gt;didubscr&lt;/code&gt;这个 block 会在有订阅者订阅信号的时候调用&lt;/p&gt;
&lt;p&gt; &lt;code&gt;+ (RACSignal *)createSignal:(RACDisposable * (^)(id&amp;lt;RACSubscriber&amp;gt; subscriber))didubscr&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;订阅信号,才会激活信号,&lt;code&gt;netBlock&lt;/code&gt;这个block会在有信号发送数据时调用&lt;/p&gt;
&lt;p&gt; &lt;code&gt;- (RACDisposable *)subscribeNext:(void (^)(id x))netBlock&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;发送信号&lt;/p&gt;
&lt;p&gt; &lt;code&gt;- (void)sendNext:(idvalue&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;创建-RACSignal-对象&quot;&gt;&lt;a href=&quot;#创建-RACSignal-对象&quot; class=&quot;headerlink&quot; title=&quot;创建 RACSignal 对象&quot;&gt;&lt;/a&gt;创建 RACSignal 对象&lt;/h2&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//创建2个RACSignal对象,根据输入框的值,转换为经过 Valid 方法验证后的值&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *validUsernameSignal =&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.usernameTextField.rac_textSignal map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *text) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; @([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isValidUsername:text]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *validPasswordSignal = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.passwordTextField.rac_textSignal map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *text) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; @([&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; isValidPassword:text]);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;看看2个 Valid 方法&lt;/p&gt;
&lt;figure class=&quot;highlight less&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//2个方法都是检验长度是否&amp;gt;3&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (BOOL)&lt;span class=&quot;selector-tag&quot;&gt;isValidUsername&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(NSString&lt;/span&gt; *)&lt;span class=&quot;selector-tag&quot;&gt;username&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  return username&lt;span class=&quot;selector-class&quot;&gt;.length&lt;/span&gt; &amp;gt; &lt;span class=&quot;selector-tag&quot;&gt;3&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;selector-tag&quot;&gt;-&lt;/span&gt; (BOOL)&lt;span class=&quot;selector-tag&quot;&gt;isValidPassword&lt;/span&gt;&lt;span class=&quot;selector-pseudo&quot;&gt;:(NSString&lt;/span&gt; *)&lt;span class=&quot;selector-tag&quot;&gt;password&lt;/span&gt; &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;  return password&lt;span class=&quot;selector-class&quot;&gt;.length&lt;/span&gt; &amp;gt; &lt;span class=&quot;selector-tag&quot;&gt;3&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;RACSignal创建好了,现在需要对RACSignal值改变的情况做不同的应对&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//将validPasswordSignal对象的值,经过bool验证后, 转换为UIColor对象传给下一个事件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[[validPasswordSignal map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *passwordValid)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;[passwordValid boolValue] ? [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; clearColor]:[&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; yellowColor];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; subscribeNext:^(&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; *color)&amp;#123;	&lt;span class=&quot;comment&quot;&gt;//将受到的 UIColor 对象直接设置为背景色&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.passwordTextField.backgroundColor = color;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;执行结果如下:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-4@2x.png&quot; width=&quot;300&quot; height=&quot;150&quot;&gt;&lt;/p&gt;
&lt;p&gt;PS: &lt;code&gt;不要使用上面&lt;/code&gt;这段代码，&lt;code&gt;下面&lt;/code&gt;有一种更好的写法！上面这段代码只是帮助我们理解过程&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.passwordTextField, backgroundColor) = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	[validPasswordSignal map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *passwordValid)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;[passwordValid boolValue] ? [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; clearColor]:[&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; yellowColor];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RAC(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.usernameTextField, backgroundColor) = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	[validUsernameSignal map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;built_in&quot;&gt;NSNumber&lt;/span&gt; *passwordValid)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;[passwordValid boolValue] ? [&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; clearColor]:[&lt;span class=&quot;built_in&quot;&gt;UIColor&lt;/span&gt; yellowColor];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面浓缩代码的解析如下:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-5@2x.png&quot; width=&quot;450&quot; height=&quot;150&quot;&gt;&lt;/p&gt;
&lt;p&gt;RAC宏允许直接把信号的输出应用到对象的属性上。&lt;/p&gt;
&lt;p&gt;RAC宏有两个参数，第一个是需要设置属性值的对象，第二个是属性名。每次信号产生一个&lt;code&gt;next&lt;/code&gt;事件，传递过来的值都会应用到该属性上。&lt;/p&gt;
&lt;h2 id=&quot;combineLatest–聚合&quot;&gt;&lt;a href=&quot;#combineLatest–聚合&quot; class=&quot;headerlink&quot; title=&quot;combineLatest–聚合&quot;&gt;&lt;/a&gt;combineLatest–聚合&lt;/h2&gt;&lt;p&gt;现在的代码中已经有可以产生用户名和密码输入框是否有效的信号了——&lt;code&gt;validUsernameSignal&lt;/code&gt;和&lt;code&gt;validPasswordSignal&lt;/code&gt;了。现在需要做的就是聚合这两个信号来决定登录按钮是否可用。&lt;/p&gt;
&lt;figure class=&quot;highlight inform7&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *signUpActiveSignal =&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;[RACSignal combineLatest:@&lt;span class=&quot;comment&quot;&gt;[validUsernameSignal, validPasswordSignal]&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                      reduce:^id(NSNumber*usernameValid, NSNumber *passwordValid)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                          return @(&lt;span class=&quot;comment&quot;&gt;[usernameValid boolValue]&lt;/span&gt;&amp;amp;&amp;amp;&lt;span class=&quot;comment&quot;&gt;[passwordValid boolValue]&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                      &amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面的代码使用&lt;code&gt;combineLatest:reduce:&lt;/code&gt;方法把&lt;code&gt;validUsernameSignal&lt;/code&gt;和&lt;code&gt;validPasswordSignal&lt;/code&gt;产生的最新的值聚合在一起，并生成一个新的信号。每次这两个源信号的任何一个产生新值时，&lt;code&gt;reduce block&lt;/code&gt;都会执行，&lt;code&gt;block&lt;/code&gt;的返回值会发给下一个信号。&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[signUpActiveSignal subscribeNext:^(&lt;span class=&quot;name&quot;&gt;NSNumber*signupActive&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        self.signInButton.enabled =[signupActive boolValue]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;运行结果:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-6@2x.png&quot; width=&quot;250&quot; height=&quot;150&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;Button类-RAC-使用&quot;&gt;&lt;a href=&quot;#Button类-RAC-使用&quot; class=&quot;headerlink&quot; title=&quot;Button类 RAC 使用&quot;&gt;&lt;/a&gt;Button类 RAC 使用&lt;/h2&gt;&lt;p&gt;给button的 TouchUpInside 事件绑定一个信号,给这个信号添加了订阅,每当这个事件触发的时候,调用订阅的 block 方法&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[[self.signInButton rac_signalForControlEvents:UIControlEventTouchUpInside] 	subscribeNext:^(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; x) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;button clicked&quot;&lt;/span&gt;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;信号内信号-map-与-flattenMap&quot;&gt;&lt;a href=&quot;#信号内信号-map-与-flattenMap&quot; class=&quot;headerlink&quot; title=&quot;信号内信号- map 与 flattenMap&quot;&gt;&lt;/a&gt;信号内信号- map 与 flattenMap&lt;/h2&gt;&lt;p&gt;下面这个是给 button 的点击事件,添加一个信号,用 map 转换后,传给下一个订阅者打印出来&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (void)test &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	[[[self.signInButton rac_signalForControlEvents:UIControlEventTouchUpInside]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;      map:&lt;/span&gt;^id(id x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		return[self signInSignal]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;      subscribeNext:&lt;/span&gt;^(id x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		NSLog(@&lt;span class=&quot;string&quot;&gt;&quot;Sign in result: %@&quot;&lt;/span&gt;, x)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (RACSignal *)signInSignal &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   return [RACSignal createSignal:^RACDisposable *(id&amp;lt;RACSubscriber&amp;gt; &lt;span class=&quot;keyword&quot;&gt;subscriber)&amp;#123;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		[self.signInService signInWithUsername:self.usernameTextField&lt;span class=&quot;meta&quot;&gt;.text&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;									   password:&lt;/span&gt;self.passwordTextField&lt;span class=&quot;meta&quot;&gt;.text&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;								       complete:&lt;/span&gt;^(&lt;span class=&quot;keyword&quot;&gt;BOOL &lt;/span&gt;success)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;								           [&lt;span class=&quot;keyword&quot;&gt;subscriber &lt;/span&gt;sendNext:@(success)]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;								           [&lt;span class=&quot;keyword&quot;&gt;subscriber &lt;/span&gt;sendCompleted]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;								       &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		return nil&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (void)signInWithUsername:(NSString *)username password:(NSString *)password &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;	complete:&lt;/span&gt;(RWSignInResponse)completeBlock &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	    double delayInSeconds = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;.&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	    &lt;span class=&quot;keyword&quot;&gt;dispatch_time_t &lt;/span&gt;popTime = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	    &lt;span class=&quot;keyword&quot;&gt;dispatch_time(DISPATCH_TIME_NOW, &lt;/span&gt;(int64_t)(delayInSeconds * NSEC_PER_SEC))&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	    &lt;span class=&quot;keyword&quot;&gt;dispatch_after(popTime, &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;dispatch_get_main_queue(), &lt;/span&gt;^(void)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	        &lt;span class=&quot;keyword&quot;&gt;BOOL &lt;/span&gt;success = [username isEqualToString:@&lt;span class=&quot;string&quot;&gt;&quot;user&quot;&lt;/span&gt;] &amp;amp;&amp;amp; [password 		isEqualToString:@&lt;span class=&quot;string&quot;&gt;&quot;password&quot;&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	        completeBlock(success)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	    &amp;#125;)&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这段代码我们想要执行的效果是监控到&lt;code&gt;UIControlEventTouchUpInside&lt;/code&gt;后判断输入的账号密码是否正确,并且将判断结果(BOOL)打印出来&lt;/p&gt;
&lt;p&gt;实际结果:&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151025-4@2x.png&quot; width=&quot;600&quot; height=&quot;76&quot;&gt;&lt;/p&gt;
&lt;p&gt;这是什么鬼?说好的&lt;code&gt;BOOL&lt;/code&gt;呢?&lt;/p&gt;
&lt;p&gt;分析一下,我们将 上面第一个方法分解后,如下&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *singnal1 = &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.signInButton rac_signalForControlEvents:&lt;span class=&quot;built_in&quot;&gt;UIControlEventTouchUpInside&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;RACSignal *singnal2 = [singnal1 map:^&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt;(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;[&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; signInSignal];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[singnal2 subscribeNext:^(&lt;span class=&quot;keyword&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;	&lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;Sign in result: %@&quot;&lt;/span&gt;, x);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看出每一步传递的都是一个 &lt;code&gt;RACSingnal&lt;/code&gt;信号,其中 map 调用了&lt;code&gt;- (RACSignal *)signInSignal&lt;/code&gt;是要把信号传递的参数改变了.&lt;/p&gt;
&lt;p&gt;但是&lt;code&gt;- (RACSignal *)signInSignal&lt;/code&gt;内部自己又创建了一个信号,并且返回了这个信号,所以我们在 &lt;code&gt;NSLog&lt;/code&gt;打印的时候是一个乱七八糟鬼~代码如下&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151025-7@2x.png&quot; width=&quot;600&quot; height=&quot;263&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-8@2x.png&quot; width=&quot;600&quot; height=&quot;207&quot;&gt;&lt;/p&gt;
&lt;p&gt;其实我们想要的是&lt;code&gt;- (RACSignal *)signInSignal&lt;/code&gt;内部&lt;code&gt;[subscriber sendNext:@(success)];&lt;/code&gt;这个传递的数据.&lt;/p&gt;
&lt;p&gt;RAC封装了另外一种 &lt;code&gt;flattenMap&lt;/code&gt; 方法来代替 &lt;code&gt;map&lt;/code&gt;处理这种信号中含有信号的情况,会自动转换&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151025-6@2x.png&quot; width=&quot;600&quot; height=&quot;315&quot;&gt;&lt;/p&gt;
&lt;p&gt;所以,遇到信号中包含另一个信号,并且想将&lt;code&gt;sendNext:&lt;/code&gt;发送的数据传到外部信号中,可以用&lt;code&gt;flattenMap&lt;/code&gt;代替&lt;code&gt;map&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[[[self.signInButton rac_signalForControlEvents:UIControlEventTouchUpInside]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   flattenMap:&lt;span class=&quot;comment&quot;&gt;^id&lt;/span&gt;(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		return[self signInSignal]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   subscribeNext:^(&lt;span class=&quot;name&quot;&gt;NSNumber*signedIn&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		BOOL success =[signedIn boolValue]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		self.signInFailureText.hidden = success;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		if(&lt;span class=&quot;name&quot;&gt;success&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;			[self performSegueWithIdentifier:@&lt;span class=&quot;string&quot;&gt;&quot;signInSuccess&quot;&lt;/span&gt; sender:self]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;		&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;code&gt;subscribeNext:block&lt;/code&gt;从登录信号中取得结果，相应地更新&lt;code&gt;signInFailureText&lt;/code&gt;是否可见。如果登录成功执行导航跳转。&lt;/p&gt;
&lt;h2 id=&quot;doNext–-附加操作&quot;&gt;&lt;a href=&quot;#doNext–-附加操作&quot; class=&quot;headerlink&quot; title=&quot;doNext– 附加操作&quot;&gt;&lt;/a&gt;doNext– 附加操作&lt;/h2&gt;&lt;p&gt;当我们想在每一次按钮被点击,发送事件的过程中,做一点与事件本身并无联系的事儿,可以用 &lt;code&gt;doNext:&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[[[[self.signInButton&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   rac_signalForControlEvents:UIControlEventTouchUpInside]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   doNext:^(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     self.signInButton.enabled =NO;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     self.signInFailureText.hidden =YES;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   flattenMap:&lt;span class=&quot;comment&quot;&gt;^id&lt;/span&gt;(&lt;span class=&quot;name&quot;&gt;id&lt;/span&gt; x)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     return[self signInSignal]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   subscribeNext:^(&lt;span class=&quot;name&quot;&gt;NSNumber*signedIn&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     self.signInButton.enabled =YES;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     BOOL success =[signedIn boolValue]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     self.signInFailureText.hidden = success;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     if(&lt;span class=&quot;name&quot;&gt;success&lt;/span&gt;)&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;       [self performSegueWithIdentifier:@&lt;span class=&quot;string&quot;&gt;&quot;signInSuccess&quot;&lt;/span&gt; sender:self]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;   &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面的代码将每一次按钮点击后按钮本身置为不可点状态,并且隐藏错误文本,当校验失败时再重新恢复按钮为可点击状态,并且显示错误文本~&lt;/p&gt;
&lt;h2 id=&quot;最终工程&quot;&gt;&lt;a href=&quot;#最终工程&quot; class=&quot;headerlink&quot; title=&quot;最终工程&quot;&gt;&lt;/a&gt;最终工程&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;http://cdn1.raywenderlich.com/wp-content/uploads/2014/01/ReactivePlayground-Final.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;上面栗子最终工程下载点我&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;RAC-Tips&quot;&gt;&lt;a href=&quot;#RAC-Tips&quot; class=&quot;headerlink&quot; title=&quot;RAC Tips&quot;&gt;&lt;/a&gt;RAC Tips&lt;/h1&gt;&lt;h2 id=&quot;RAC-事件传递的值是什么&quot;&gt;&lt;a href=&quot;#RAC-事件传递的值是什么&quot; class=&quot;headerlink&quot; title=&quot;RAC 事件传递的值是什么?&quot;&gt;&lt;/a&gt;RAC 事件传递的值是什么?&lt;/h2&gt;&lt;p&gt;可以看到下面的打印 X 为一个 button, &lt;code&gt;NSLog&lt;/code&gt;内的却是0&lt;/p&gt;
&lt;p&gt;0来源于图1 block中传递的 BOOL, 那么 button 对象来源于哪儿?&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-9@2x.png&quot; width=&quot;600&quot; height=&quot;326&quot;&gt;&lt;/p&gt;
&lt;p&gt;从 button 订阅点击事件的信号中可以看到,调用 sendNext: 的对象是 &lt;code&gt;subscriber&lt;/code&gt;,但是:内传递的参数是 button 自己,所以外面打印的x 就是 button&lt;br&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/RAC/QQ20151024-8@2x.png&quot; width=&quot;600&quot; height=&quot;207&quot;&gt;&lt;/p&gt;
&lt;p&gt;so. 信号订阅者接收到得值是什么,取决于上一个信号 &lt;code&gt;sendNext:&lt;/code&gt;方法里发送的是什么&lt;/p&gt;
&lt;h2 id=&quot;RAC使后感&quot;&gt;&lt;a href=&quot;#RAC使后感&quot; class=&quot;headerlink&quot; title=&quot;RAC使后感&quot;&gt;&lt;/a&gt;RAC使后感&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;RAC 函数调用,环环相扣~e.g.调用形式:&lt;code&gt;[[[XXX map] filter] subscribeNext:Block]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;每次调用方法的实例对象都是 RACSignal 对象&lt;/li&gt;
&lt;li&gt;RACSignal对象直接传递的值也是一个对象&lt;/li&gt;
&lt;li&gt;代码中没有用来表示两个输入框有效状态的私有属性。这就是用&lt;code&gt;响应式编程&lt;/code&gt;的一个关键区别，你不需要使用实例变量来追踪瞬时状态。&lt;/li&gt;
&lt;li&gt;下一个订阅者收到的传递参数,取决于上一个RACSignal对象 sendNext 的值是什么&lt;/li&gt;
&lt;/ol&gt;
&lt;hr&gt;
&lt;h2 id=&quot;来源&quot;&gt;&lt;a href=&quot;#来源&quot; class=&quot;headerlink&quot; title=&quot;来源:&quot;&gt;&lt;/a&gt;来源:&lt;/h2&gt;&lt;p&gt;1.&lt;a href=&quot;http://www.raywenderlich.com/62699/reactivecocoa-tutorial-pt1&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;raywenderlich’s Blog&lt;/a&gt;&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;本站文章若无特别说明,均为原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;体会-RAC-的魅力&quot;&gt;&lt;a href=&quot;#体会-RAC-的魅力&quot; class=&quot;headerlink&quot; title=&quot;体会 RAC 的魅力&quot;&gt;&lt;/a&gt;体会 RAC 的魅力&lt;/h1&gt;&lt;p&gt;大多数朋友可能和我一样,刚接触 RAC 的时候一头雾水~&lt;/p&gt;
&lt;p&gt;so
    
    </summary>
    
      <category term="OC" scheme="http://yoursite.com/categories/OC/"/>
    
    
      <category term="ReactiveCocoa" scheme="http://yoursite.com/tags/ReactiveCocoa/"/>
    
  </entry>
  
  <entry>
    <title>调试 bug 收集</title>
    <link href="http://yoursite.com/2015/10/22/%E8%B0%83%E8%AF%95-bug-%E6%94%B6%E9%9B%86/"/>
    <id>http://yoursite.com/2015/10/22/调试-bug-收集/</id>
    <published>2015-10-22T02:36:58.000Z</published>
    <updated>2015-12-17T10:02:05.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;调试 Bug 收集~ 详见内~&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;真机调试的时候出现”The-identity-used-to-sign-the-executable-is-no-longer-valid”&quot;&gt;&lt;a href=&quot;#真机调试的时候出现”The-identity-used-to-sign-the-executable-is-no-longer-valid”&quot; class=&quot;headerlink&quot; title=&quot;真机调试的时候出现”The identity used to sign the executable is no longer valid”&quot;&gt;&lt;/a&gt;真机调试的时候出现”The identity used to sign the executable is no longer valid”&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;解决:其实 Xcode 悄悄把你 BuildSetting 里的 profile 改回去了,此时你回去看应该是一堆乱码.重新设置即可解决&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;随时补充&quot;&gt;&lt;a href=&quot;#随时补充&quot; class=&quot;headerlink&quot; title=&quot;随时补充&quot;&gt;&lt;/a&gt;随时补充&lt;/h1&gt;&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;调试 Bug 收集~ 详见内~&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>指数的威力</title>
    <link href="http://yoursite.com/2015/10/19/%E6%8C%87%E6%95%B0%E7%9A%84%E5%A8%81%E5%8A%9B/"/>
    <id>http://yoursite.com/2015/10/19/指数的威力/</id>
    <published>2015-10-19T02:57:44.000Z</published>
    <updated>2015-10-19T03:37:04.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;有一张很大很大的纸，对折 38 次，会有多高呢？ 一米？一百米？比珠峰还高？&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;blockquote&gt;
&lt;p&gt;再次考验你心脏承受能力的时刻到了：它不仅仅比珠峰高，其实它已经快到达月球了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;&lt;br&gt;有一张很大很大的纸，对折 38 次，会有多高呢？ 一米？一百米？比珠峰还高？&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
      <category term="哲学" scheme="http://yoursite.com/categories/%E5%93%B2%E5%AD%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>解析 html 乱码</title>
    <link href="http://yoursite.com/2015/10/15/%E8%A7%A3%E6%9E%90-html-%E4%B9%B1%E7%A0%81/"/>
    <id>http://yoursite.com/2015/10/15/解析-html-乱码/</id>
    <published>2015-10-15T06:01:15.000Z</published>
    <updated>2015-10-15T06:09:06.000Z</updated>
    
    <content type="html">&lt;p&gt;缘由:&lt;br&gt;遇到HTML解析乱码,由于 QA 反馈是在 IOS9下,第一反应就是 IOS9有什么隐藏 bug~~&lt;br&gt;HTML 代码举例如下,本地是 UTF8解码&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;test&lt;/span&gt;&amp;gt;&lt;/span&gt;新用户注册即享优惠礼包&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;test&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;排查后,最后发现 HTML 的问题,指定字符集即可&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;php&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?&lt;/span&gt;xml version=&lt;span class=&quot;string&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;string&quot;&gt;&quot;utf-8&quot;&lt;/span&gt;&lt;span class=&quot;meta&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;test&lt;/span&gt;&amp;gt;&lt;/span&gt;充就送！！！新用户充值就送60元代金券1张&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;test&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;root&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;缘由:&lt;br&gt;遇到HTML解析乱码,由于 QA 反馈是在 IOS9下,第一反应就是 IOS9有什么隐藏 bug~~&lt;br&gt;HTML 代码举例如下,本地是 UTF8解码&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td clas
    
    </summary>
    
      <category term="OC" scheme="http://yoursite.com/categories/OC/"/>
    
    
  </entry>
  
  <entry>
    <title>study/tips collection</title>
    <link href="http://yoursite.com/2015/10/11/tips-collection/"/>
    <id>http://yoursite.com/2015/10/11/tips-collection/</id>
    <published>2015-10-11T12:23:26.000Z</published>
    <updated>2015-10-14T16:46:20.000Z</updated>
    
    <content type="html">&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;     世界上没有什么事是一顿烧烤解决不了的,如果有,那就两顿&lt;br&gt;                                                —尼古拉斯·赵四&lt;br&gt;&lt;/blockquote&gt;

&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;序&quot;&gt;&lt;a href=&quot;#序&quot; class=&quot;headerlink&quot; title=&quot;序&quot;&gt;&lt;/a&gt;序&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;从网络收集整理,资料来自 @sunnyxx , @程序猿(chenyilong)等先驱,此处只作个人备份使用&lt;/p&gt;
&lt;p&gt;PS:今年9月有幸和 @程序猿(chenyilong) 见了一面,当时人很多,估计 chenyilong 老师不记得我,不过我记得 ta 的诙谐幽默,😄,谁说 coder 都是闷骚的,明明就是明骚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;lldb（gdb）常用的调试命令？&quot;&gt;&lt;a href=&quot;#lldb（gdb）常用的调试命令？&quot; class=&quot;headerlink&quot; title=&quot;lldb（gdb）常用的调试命令？&quot;&gt;&lt;/a&gt;lldb（gdb）常用的调试命令？&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;po(打印)&lt;/li&gt;
&lt;li&gt;bt(显示最近一次调用的堆栈)&lt;/li&gt;
&lt;li&gt;next(在不单步执行进入其他函数的情况下，向前执行一行源代码)&lt;/li&gt;
&lt;li&gt;continue(继续执行正在调试的程序)&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;如何调试-BAD-ACCESS-错误&quot;&gt;&lt;a href=&quot;#如何调试-BAD-ACCESS-错误&quot; class=&quot;headerlink&quot; title=&quot;如何调试 BAD_ACCESS 错误&quot;&gt;&lt;/a&gt;如何调试 BAD_ACCESS 错误&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;设置 xcode 环境变量环境变量 NSZombieEnabled 来查看具体位置等&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;IBOutlet-连出来的视图属性为什么可以被设置成-weak&quot;&gt;&lt;a href=&quot;#IBOutlet-连出来的视图属性为什么可以被设置成-weak&quot; class=&quot;headerlink&quot; title=&quot;IBOutlet 连出来的视图属性为什么可以被设置成 weak?&quot;&gt;&lt;/a&gt;IBOutlet 连出来的视图属性为什么可以被设置成 weak?&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;使用storyboard(xib不行)创建的vc,会有一个叫&lt;code&gt;_topLevelObjectsToKeepAliveFromStoryboard&lt;/code&gt;的私有数组强引用所有top level的对象，所以这时即便&lt;code&gt;outlet&lt;/code&gt;声明成weak也没关系&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;IB中User-Defined-Runtime-Attributes如何使用？&quot;&gt;&lt;a href=&quot;#IB中User-Defined-Runtime-Attributes如何使用？&quot; class=&quot;headerlink&quot; title=&quot;IB中User Defined Runtime Attributes如何使用？&quot;&gt;&lt;/a&gt;IB中User Defined Runtime Attributes如何使用？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;它能够通过KVC的方式配置一些你在interface builder 中不能配置的属性。当你希望在IB中作尽可能多得事情，这个特性能够帮助你编写更加轻量级的viewcontroller&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;为什么对字符串等赋值的时候默认是-copy-的&quot;&gt;&lt;a href=&quot;#为什么对字符串等赋值的时候默认是-copy-的&quot; class=&quot;headerlink&quot; title=&quot;为什么对字符串等赋值的时候默认是 copy 的&quot;&gt;&lt;/a&gt;为什么对字符串等赋值的时候默认是 copy 的&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;用 &lt;code&gt;@property&lt;/code&gt; 声明 NSString、NSArray、NSDictionary 经常使用 copy 关键字，是因为他们有对应的可变类型：NSMutableString、NSMutableArray、NSMutableDictionary，他们之间可能进行赋值操作，为确保对象中的字符串值不会无意间变动，应该在设置新属性值时拷贝一份。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;weak-和-assign-有什么不同&quot;&gt;&lt;a href=&quot;#weak-和-assign-有什么不同&quot; class=&quot;headerlink&quot; title=&quot;weak 和 assign 有什么不同&quot;&gt;&lt;/a&gt;weak 和 assign 有什么不同&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;assigin 可以用非 OC 对象,而 weak 必须用于 OC 对象&lt;/li&gt;
&lt;li&gt;assigin 引用的对象不会增加引用计数,也不会自动置为 nil,如果该对象销毁,assign 依然访问的话,会造成野指针错误&lt;/li&gt;
&lt;li&gt;weak 引用的对象如果释放会自动置为 nil, 访问时给 nil 发消息不会崩溃&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;property-的本质是什么？ivar、getter、setter-是如何生成并添加到这个类中的&quot;&gt;&lt;a href=&quot;#property-的本质是什么？ivar、getter、setter-是如何生成并添加到这个类中的&quot; class=&quot;headerlink&quot; title=&quot;@property 的本质是什么？ivar、getter、setter 是如何生成并添加到这个类中的&quot;&gt;&lt;/a&gt;@property 的本质是什么？ivar、getter、setter 是如何生成并添加到这个类中的&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;@property = ivar + getter + setter;&lt;/li&gt;
&lt;li&gt;属性定义后,编译器在编译期自动编写访问这些属性所需的方法(getter + setter),向类中添加适当类型的实例变量(ivar)，并且在属性名前面加下划线&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;runtime-如何实现-weak-属性&quot;&gt;&lt;a href=&quot;#runtime-如何实现-weak-属性&quot; class=&quot;headerlink&quot; title=&quot;runtime 如何实现 weak 属性&quot;&gt;&lt;/a&gt;runtime 如何实现 weak 属性&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;runtime 对注册的类， 会进行布局，对于 weak 对象会放入一个 hash 表中。 用 weak 指向的对象内存地址作为 key&lt;/li&gt;
&lt;li&gt;当此对象的引用计数为0的时候会&lt;code&gt;dealloc&lt;/code&gt;，假如 weak 指向的对象内存地址是a，那么就会以a为键， 在这个 weak 表中搜索，找到所有以a为键的 weak 对象，从而设置为 nil。&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？&quot;&gt;&lt;a href=&quot;#ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？&quot; class=&quot;headerlink&quot; title=&quot;ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？&quot;&gt;&lt;/a&gt;ARC下，不显式指定任何属性关键字时，默认的关键字都有哪些？&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;对应基本数据类型默认关键字是: &lt;code&gt;atomic,readwrite,assign&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;对于普通的OC对象: &lt;code&gt;atomic,readwrite,strong&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;objc中向一个对象发送消息-obj-foo-和objc-msgSend-函数之间有什么关系？&quot;&gt;&lt;a href=&quot;#objc中向一个对象发送消息-obj-foo-和objc-msgSend-函数之间有什么关系？&quot; class=&quot;headerlink&quot; title=&quot;objc中向一个对象发送消息[obj foo]和objc_msgSend()函数之间有什么关系？&quot;&gt;&lt;/a&gt;objc中向一个对象发送消息[obj foo]和objc_msgSend()函数之间有什么关系？&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;方法编译之后就是objc_msgSend()函数调用.大概是这样的:&lt;br&gt;&lt;br&gt;&lt;code&gt;((void()(id,SEL))(void)objc_msgSend)((id)obj,sel_registerName(&amp;quot;foo&amp;quot;));&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;也就是说:&lt;code&gt;[obj foo];&lt;/code&gt;在objc动态编译时，会被转意为:&lt;br&gt;&lt;br&gt;&lt;code&gt;objc_msgSend(obj, @selector(foo));&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;对象的内存销毁时间表&quot;&gt;&lt;a href=&quot;#对象的内存销毁时间表&quot; class=&quot;headerlink&quot; title=&quot;对象的内存销毁时间表&quot;&gt;&lt;/a&gt;对象的内存销毁时间表&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;分四个步骤：&lt;br&gt;&lt;figure class=&quot;highlight stata&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 对象的内存销毁时间表&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http://weibo.com/luohanchenyilong/ (微博@iOS程序犭袁)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// https://github.com/ChenYilong&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// 根据 WWDC 2011, Session 322 (36分22秒)中发布的内存销毁时间表 &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt; 1. 调用 -release ：引用计数变为零&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 对象正在被销毁，生命周期即将结束.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 不能再有新的 __weak 弱引用， 否则将指向 nil.&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 调用 [self dealloc] &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; 2. 父类 调用 -dealloc&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 继承关系中最底层的父类 在调用 -dealloc&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 如果是 MRC 代码 则会手动释放实例变量们（iVars）&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 继承关系中每一层的父类 都在调用 -dealloc&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; 3. NSObject 调 -dealloc&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 只做一件事：调用 Objective-C runtime 中的 object_dispose() 方法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; 4. 调用 object_dispose()&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 为 C++ 的实例变量们（iVars）调用 destructors &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 为 ARC 状态下的 实例变量们（iVars） 调用 -release &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 解除所有使用 runtime Associate方法关联的对象&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 解除所有 __weak 引用&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;     * 调用 free()&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;objc中的类方法和实例方法有什么本质区别和联系？&quot;&gt;&lt;a href=&quot;#objc中的类方法和实例方法有什么本质区别和联系？&quot; class=&quot;headerlink&quot; title=&quot;objc中的类方法和实例方法有什么本质区别和联系？&quot;&gt;&lt;/a&gt;objc中的类方法和实例方法有什么本质区别和联系？&lt;/h2&gt;&lt;blockquote&gt;
&lt;figure class=&quot;highlight markdown&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;类方法：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;1. &lt;/span&gt;类方法是属于类对象的&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;2. &lt;/span&gt;类方法只能通过类对象调用&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;3. &lt;/span&gt;类方法中的self是类对象&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;4. &lt;/span&gt;类方法可以调用其他的类方法&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;5. &lt;/span&gt;类方法中不能访问成员变量&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;6. &lt;/span&gt;类方法中不定直接调用对象方法&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;实例方法：&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;1. &lt;/span&gt;实例方法是属于实例对象的&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;2. &lt;/span&gt;实例方法只能通过实例对象调用&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;3. &lt;/span&gt;实例方法中的self是实例对象&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;4. &lt;/span&gt;实例方法中可以访问成员变量&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;5. &lt;/span&gt;实例方法中直接调用实例方法&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;bullet&quot;&gt;6. &lt;/span&gt;实例方法中也可以调用类方法(通过类名)&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;runloop和线程有什么关系？&quot;&gt;&lt;a href=&quot;#runloop和线程有什么关系？&quot; class=&quot;headerlink&quot; title=&quot;runloop和线程有什么关系？&quot;&gt;&lt;/a&gt;runloop和线程有什么关系？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;runloop 详解:&lt;a href=&quot;http://blog.csdn.net/wzzvictory/article/details/9237973&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/wzzvictory/article/details/9237973&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;主线程的 run loop 默认是启动的&lt;/li&gt;
&lt;li&gt;对其它线程来说，run loop 默认是没有启动的&lt;/li&gt;
&lt;li&gt;&lt;p&gt;可以通过以下代码来获取到当前线程的 run loop&lt;/p&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;NSRunLoop&lt;/span&gt; *runloop = [&lt;span class=&quot;built_in&quot;&gt;NSRunLoop&lt;/span&gt; currentRunLoop];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;NSRunLoop 类并不是线程安全的&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Run loop 同时也负责 autorelease pool 的创建和释放&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;runloop的mode作用是什么？&quot;&gt;&lt;a href=&quot;#runloop的mode作用是什么？&quot; class=&quot;headerlink&quot; title=&quot;runloop的mode作用是什么？&quot;&gt;&lt;/a&gt;runloop的mode作用是什么？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;model 主要是用来指定事件在运行循环中的优先级的，分为：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;NSDefaultRunLoopMode（kCFRunLoopDefaultMode）：默认，空闲状态&lt;/li&gt;
&lt;li&gt;UITrackingRunLoopMode：ScrollView滑动时&lt;/li&gt;
&lt;li&gt;UIInitializationRunLoopMode：启动时&lt;/li&gt;
&lt;li&gt;NSRunLoopCommonModes（kCFRunLoopCommonModes）：Mode集合&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;每个 runloop 只能运行在一种 model 下,所以遇到ScrollView滑动时 timer 不响应的问题,将 timer 加入到 NSRunLoopCommonModes 即可&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;以-scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？&quot;&gt;&lt;a href=&quot;#以-scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？&quot; class=&quot;headerlink&quot; title=&quot;以+ scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？&quot;&gt;&lt;/a&gt;以+ scheduledTimerWithTimeInterval…的方式触发的timer，在滑动页面上的列表时，timer会暂定回调，为什么？如何解决？&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ScrollView滚动过程中NSDefaultRunLoopMode（kCFRunLoopDefaultMode）的mode会切换到UITrackingRunLoopMode来保证ScrollView的流畅滑动&lt;/li&gt;
&lt;li&gt;NSTimer对象以NSDefaultRunLoopMode（kCFRunLoopDefaultMode）添加到主运行循环中的时候, ScrollView滚动过程中会因为mode的切换，而导致NSTimer将不再被调度&lt;/li&gt;
&lt;li&gt;可以通过将timer添加到NSRunLoopCommonModes（kCFRunLoopCommonModes）来解决&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;runloop内部是如何实现的&quot;&gt;&lt;a href=&quot;#runloop内部是如何实现的&quot; class=&quot;headerlink&quot; title=&quot;runloop内部是如何实现的&quot;&gt;&lt;/a&gt;runloop内部是如何实现的&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;一般来讲，一个线程一次只能执行一个任务，执行完成后线程就会退出。如果我们需要一个机制，让线程能随时处理事件但并不退出,通常的代码逻辑 是这样的:&lt;br&gt;&lt;figure class=&quot;highlight cs&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// http://weibo.com/luohanchenyilong/ (微博@iOS程序犭袁)&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// https://github.com/ChenYilong&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;main&lt;/span&gt;(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;int&lt;/span&gt; argc, &lt;span class=&quot;keyword&quot;&gt;char&lt;/span&gt; * argv[]&lt;/span&gt;) &lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;comment&quot;&gt;//程序一直运行状态&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;while&lt;/span&gt; (AppIsRunning) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//睡眠状态，等待唤醒事件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      id whoWakesMe = SleepForWakingUp();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//得到唤醒事件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      id &lt;span class=&quot;keyword&quot;&gt;event&lt;/span&gt; = GetEvent(whoWakesMe);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;span class=&quot;comment&quot;&gt;//开始处理事件&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      HandleEvent(&lt;span class=&quot;keyword&quot;&gt;event&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt; &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？&quot;&gt;&lt;a href=&quot;#不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？&quot; class=&quot;headerlink&quot; title=&quot;不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？&quot;&gt;&lt;/a&gt;不手动指定autoreleasepool的前提下，一个autorealese对象在什么时刻释放？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;分两种情况：手动干预释放时机、系统自动去释放。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;手动干预释放时机–指定autoreleasepool 就是所谓的：当前作用域大括号结束时释放。&lt;/li&gt;
&lt;li&gt;系统自动去释放–不手动指定autoreleasepool&lt;br&gt;Autorelease对象出了作用域之后，会被添加到最近一次创建的自动释放池中，并会在当前的 runloop 迭代结束时释放。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;释放的时机总结起来，可以用下图来表示&lt;br&gt;&lt;img src=&quot;https://camo.githubusercontent.com/56f8ea718f47679e7771d247d8f6f820de2e0ab5/687474703a2f2f6936312e74696e797069632e636f6d2f32386b6f6477702e6a7067&quot; alt=&quot;runloop&quot;&gt;&lt;/p&gt;
&lt;p&gt;下面对这张图进行详细的解释：&lt;/p&gt;
&lt;p&gt;从程序启动到加载完成是一个完整的运行循环，然后会停下来，等待用户交互，用户的每一次交互都会启动一次运行循环，来处理用户所有的点击事件、触摸事件。&lt;/p&gt;
&lt;p&gt;我们都是知道： 所有 autorelease 的对象，在出了作用域之后，会被自动添加到最近创建的自动释放池中。&lt;/p&gt;
&lt;p&gt;但是如果每次都放进应用程序的 main.m 中的 autoreleasepool 中，迟早有被撑满的一刻。这个过程中必定有一个释放的动作。何时？&lt;/p&gt;
&lt;p&gt;在一次完整的运行循环结束之前，会被销毁。&lt;/p&gt;
&lt;p&gt;那什么时间会创建自动释放池？运行循环检测到事件并启动后，就会创建自动释放池。&lt;/p&gt;
&lt;p&gt;子线程的 runloop 默认是不工作，无法主动创建，必须手动创建。&lt;/p&gt;
&lt;p&gt;自定义的 NSOperation 和 NSThread 需要手动创建自动释放池。比如： 自定义的 NSOperation 类中的 main 方法里就必须添加自动释放池。否则出了作用域后，自动释放对象会因为没有自动释放池去处理它，而造成内存泄露。&lt;/p&gt;
&lt;p&gt;但对于 blockOperation 和 invocationOperation 这种默认的Operation ，系统已经帮我们封装好了，不需要手动创建自动释放池。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;@autoreleasepool&lt;/code&gt;当自动释放池被销毁或者耗尽时，会向自动释放池中的所有对象发送 release 消息，释放自动释放池中的所有对象。&lt;/p&gt;
&lt;p&gt;如果在一个vc的&lt;code&gt;viewDidLoad&lt;/code&gt;中创建一个 &lt;code&gt;Autorelease&lt;/code&gt;对象，那么该对象会在 &lt;code&gt;viewDidAppear&lt;/code&gt; 方法执行前就被销毁了。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;使用系统的某些block-api（如UIView的block版本写动画时），是否也考虑引用循环问题？&quot;&gt;&lt;a href=&quot;#使用系统的某些block-api（如UIView的block版本写动画时），是否也考虑引用循环问题？&quot; class=&quot;headerlink&quot; title=&quot;使用系统的某些block api（如UIView的block版本写动画时），是否也考虑引用循环问题？&quot;&gt;&lt;/a&gt;使用系统的某些block api（如UIView的block版本写动画时），是否也考虑引用循环问题？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;所谓“引用循环”是指双向的强引用，所以那些“单向的强引用”（block 强引用 self ）没有问题，比如这些：&lt;br&gt;&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[UIView animateWithDuration:duration animations:&lt;span class=&quot;comment&quot;&gt;^&amp;#123; [self.superview layoutIfNeeded]; &amp;#125;&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[[NSOperationQueue mainQueue] addOperationWithBlock:&lt;span class=&quot;comment&quot;&gt;^&amp;#123; self.someProperty = xyz; &amp;#125;&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&quot;highlight clojure&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;[[NSNotificationCenter defaultCenter] addObserverForName:@&lt;span class=&quot;string&quot;&gt;&quot;someNotification&quot;&lt;/span&gt; &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                  object:nil &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                           queue:[NSOperationQueue mainQueue]&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                              usingBlock:^(&lt;span class=&quot;name&quot;&gt;NSNotification&lt;/span&gt; * notification) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                    self.someProperty = xyz; &amp;#125;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;上面这些情况不需要考虑“引用循环”。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;BUT&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;如果你使用一些参数中可能含有 ivar 的系统 api ，如 GCD 、NSNotificationCenter就要小心一点：比如GCD 内部如果引用了 self，而且 GCD 的其他参数是 ivar，则要考虑到循环引用：&lt;br&gt;&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;__weak&lt;/span&gt; __typeof__(&lt;span class=&quot;keyword&quot;&gt;self) &lt;/span&gt;weakSelf = &lt;span class=&quot;keyword&quot;&gt;self;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;dispatch_group_async&lt;/span&gt;(_operationsGroup, _operationsQueue, ^&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     __typeof__(&lt;span class=&quot;keyword&quot;&gt;self) &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;strongSelf &lt;/span&gt;= weakSelf&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     [&lt;span class=&quot;keyword&quot;&gt;strongSelf &lt;/span&gt;doSomething]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;     [&lt;span class=&quot;keyword&quot;&gt;strongSelf &lt;/span&gt;doSomethingElse]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125; )&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;类似的：&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;__&lt;span class=&quot;keyword&quot;&gt;weak&lt;/span&gt; __typeof__(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) weakSelf = &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;_observer = [[&lt;span class=&quot;built_in&quot;&gt;NSNotificationCenter&lt;/span&gt; defaultCenter] addObserverForName:&lt;span class=&quot;string&quot;&gt;@&quot;testKey&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                              object:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                               queue:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                          usingBlock:^(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *note) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    __typeof__(&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;) strongSelf = weakSelf;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [strongSelf dismissModalViewControllerAnimated:&lt;span class=&quot;literal&quot;&gt;YES&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;self –&amp;gt; _observer –&amp;gt; block –&amp;gt; self 显然这也是一个循环引用。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）&quot;&gt;&lt;a href=&quot;#如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）&quot; class=&quot;headerlink&quot; title=&quot;如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）&quot;&gt;&lt;/a&gt;如何用GCD同步若干个异步调用？（如根据若干个url异步加载多张图片，然后在都下载完成后合成一张整图）&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;使用Dispatch Group追加block到Global Group Queue,这些block如果全部执行完毕，就会执行Main Dispatch Queue中的结束处理的block。&lt;br&gt;&lt;figure class=&quot;highlight lasso&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;dispatch_queue_t &lt;span class=&quot;built_in&quot;&gt;queue&lt;/span&gt; = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dispatch_group_t &lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt; = dispatch_group_create();&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dispatch_group_async(&lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;queue&lt;/span&gt;, ^&amp;#123; &lt;span class=&quot;comment&quot;&gt;/*加载图片1 */&lt;/span&gt; &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dispatch_group_async(&lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;queue&lt;/span&gt;, ^&amp;#123; &lt;span class=&quot;comment&quot;&gt;/*加载图片2 */&lt;/span&gt; &amp;#125;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dispatch_group_async(&lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;queue&lt;/span&gt;, ^&amp;#123; &lt;span class=&quot;comment&quot;&gt;/*加载图片3 */&lt;/span&gt; &amp;#125;); &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;dispatch_group_notify(&lt;span class=&quot;keyword&quot;&gt;group&lt;/span&gt;, dispatch_get_main_queue(), ^&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;// 合并图片&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;);&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;若一个类有实例变量-NSString-foo-，调用setValue-forKey-时，可以以foo还是-foo-作为key？&quot;&gt;&lt;a href=&quot;#若一个类有实例变量-NSString-foo-，调用setValue-forKey-时，可以以foo还是-foo-作为key？&quot; class=&quot;headerlink&quot; title=&quot;若一个类有实例变量 NSString *_foo ，调用setValue:forKey:时，可以以foo还是 _foo 作为key？&quot;&gt;&lt;/a&gt;若一个类有实例变量 NSString *_foo ，调用setValue:forKey:时，可以以foo还是 _foo 作为key？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;都可以。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;KVC和KVO的keyPath一定是属性么？&quot;&gt;&lt;a href=&quot;#KVC和KVO的keyPath一定是属性么？&quot; class=&quot;headerlink&quot; title=&quot;KVC和KVO的keyPath一定是属性么？&quot;&gt;&lt;/a&gt;KVC和KVO的keyPath一定是属性么？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;KVO支持实例变量&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;apple用什么方式实现对一个对象的KVO？&quot;&gt;&lt;a href=&quot;#apple用什么方式实现对一个对象的KVO？&quot; class=&quot;headerlink&quot; title=&quot;apple用什么方式实现对一个对象的KVO？&quot;&gt;&lt;/a&gt;apple用什么方式实现对一个对象的KVO？&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;KVO 原理:&lt;br&gt;当你观察一个对象时，一个新的类会被动态创建。这个类继承自该对象的原本的类，并重写了被观察属性的 setter 方法。重写的 setter 方法会负责在调用原 setter 方法之前和之后，通知所有观察对象：值的更改。最后通过 isa 混写（isa-swizzling） 把这个对象的 isa 指针 ( isa 指针告诉 Runtime 系统这个对象的类是什么 ) 指向这个新创建的子类，对象就神奇的变成了新创建的子类的实例。我(chenyilong)画了一张示意图，如下所示：&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&quot;https://camo.githubusercontent.com/9517b0d78961b5f32cf3392b99964f2e1f79fb35/687474703a2f2f6936322e74696e797069632e636f6d2f7379353775722e6a7067&quot; alt=&quot;KVO 原理图&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;详解:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;1.第一次对一个对象调用 addObserver:forKeyPath:options:context: 时，框架会创建这个类的新的 KVO 子类，并将被观察对象转换为新子类的对象。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;2.键值观察通知依赖于 NSObject 的两个方法: willChangeValueForKey: 和 didChangevlueForKey:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;3.在这个 KVO 特殊子类中,Cocoa 创建观察属性的 setter 方法，在一个被观察属性发生改变之前， willChangeValueForKey: 一定会被调用，这就会记录旧的值。而当改变发生后(调用 super 方法执行相关赋值操作)， didChangeValueForKey: 会被调用，继而 observeValueForKey:ofObject:change:context: 也会被调用。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)&lt;span class=&quot;string&quot;&gt;setNow:&lt;/span&gt;(NSDate *)aDate &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [self &lt;span class=&quot;string&quot;&gt;willChangeValueForKey:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;now&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;super&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;setValue:&lt;/span&gt;aDate &lt;span class=&quot;string&quot;&gt;forKey:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;now&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [self &lt;span class=&quot;string&quot;&gt;didChangeValueForKey:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;now&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;这种继承和方法注入是在运行时而不是编译时实现的。这就是正确命名如此重要的原因。只有在使用KVC命名约定时，KVO才能做到这一点。&lt;/p&gt;
&lt;p&gt;Apple 还重写、覆盖了 -class 方法并返回原来的类,具体过程是:KVO 在实现中通过 isa 混写（isa-swizzling） 把这个对象的 isa 指针 ( isa 指针告诉 Runtime 系统这个对象的类是什么 ) 指向这个新创建的子类，对象就神奇的变成了新创建的子类的实例。&lt;/p&gt;
&lt;p&gt;具体探究过程可参考 &lt;a href=&quot;https://www.mikeash.com/pyblog/friday-qa-2009-01-23.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://www.mikeash.com/pyblog/friday-qa-2009-01-23.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;如何自己动手实现-KVO&quot;&gt;&lt;a href=&quot;#如何自己动手实现-KVO&quot; class=&quot;headerlink&quot; title=&quot;如何自己动手实现 KVO&quot;&gt;&lt;/a&gt;如何自己动手实现 KVO&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;具体过程可参考&lt;a href=&quot;http://tech.glowing.com/cn/implement-kvo/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://tech.glowing.com/cn/implement-kvo/&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;明天上班了-今天暂告一段落…&quot;&gt;&lt;a href=&quot;#明天上班了-今天暂告一段落…&quot; class=&quot;headerlink&quot; title=&quot;明天上班了,今天暂告一段落…&quot;&gt;&lt;/a&gt;明天上班了,今天暂告一段落…&lt;/h2&gt;&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;     世界上没有什么事是一顿烧烤解决不了的,如果有,那就两顿&lt;br&gt;                                                —尼古拉斯·赵四&lt;br&gt;&lt;/blockquote&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>WatchKit App 与 iPhone 端显示名称的问题</title>
    <link href="http://yoursite.com/2015/10/08/WatchKit%20App%20%E4%B8%8E%20iPhone%20%E7%AB%AF%E6%98%BE%E7%A4%BA%E5%90%8D%E7%A7%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>http://yoursite.com/2015/10/08/WatchKit App 与 iPhone 端显示名称的问题/</id>
    <published>2015-10-08T03:05:16.000Z</published>
    <updated>2015-10-08T04:03:59.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;缘由&quot;&gt;&lt;a href=&quot;#缘由&quot; class=&quot;headerlink&quot; title=&quot;缘由&quot;&gt;&lt;/a&gt;缘由&lt;/h1&gt;&lt;p&gt;今天 Watch 项目被拒了,原因是 Watch 和 iPhone 端 App 显示名称没有做到全部一致.&lt;/p&gt;
&lt;h1 id=&quot;具体问题&quot;&gt;&lt;a href=&quot;#具体问题&quot; class=&quot;headerlink&quot; title=&quot;具体问题&quot;&gt;&lt;/a&gt;具体问题&lt;/h1&gt;&lt;h2 id=&quot;被拒描述&quot;&gt;&lt;a href=&quot;#被拒描述&quot; class=&quot;headerlink&quot; title=&quot;被拒描述&quot;&gt;&lt;/a&gt;被拒描述&lt;/h2&gt;&lt;figure class=&quot;highlight applescript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;While your iTunes Connect Application State shows &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; Metadata Rejected, we don&#39;t require a new binary &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; correct this issue. Once this information &lt;span class=&quot;keyword&quot;&gt;is&lt;/span&gt; available, we can &lt;span class=&quot;keyword&quot;&gt;continue&lt;/span&gt; your review. &lt;span class=&quot;number&quot;&gt;3.4&lt;/span&gt; Details&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;We noticed &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; app &lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; be displayed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; App Store &lt;span class=&quot;keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; app &lt;span class=&quot;built_in&quot;&gt;name&lt;/span&gt; displayed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; a device do &lt;span class=&quot;keyword&quot;&gt;not&lt;/span&gt; sufficiently match, which makes &lt;span class=&quot;keyword&quot;&gt;it&lt;/span&gt; difficult &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; users &lt;span class=&quot;keyword&quot;&gt;to&lt;/span&gt; find &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; app they just downloaded. The &lt;span class=&quot;built_in&quot;&gt;application&lt;/span&gt; names are:&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- Name &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;the&lt;/span&gt; App Store: 我是一个中文名(随便写的)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- Name displayed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; iPhone: 我是一个中文名&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- Name displayed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; Apple Watch companion app: woshiyigezhongwen&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- Name displayed &lt;span class=&quot;keyword&quot;&gt;on&lt;/span&gt; Apple Watch: 我是一个中文名&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;分析&quot;&gt;&lt;a href=&quot;#分析&quot; class=&quot;headerlink&quot; title=&quot;分析&quot;&gt;&lt;/a&gt;分析&lt;/h2&gt;&lt;p&gt;是 iPhone 端的 Apple Watch 这个 App 里项目名称显示不对&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/QQ20151008-1@2x.png&quot; width=&quot;328&quot; height=&quot;328&quot;&gt;&lt;/p&gt;
&lt;h2 id=&quot;解决办法&quot;&gt;&lt;a href=&quot;#解决办法&quot; class=&quot;headerlink&quot; title=&quot;解决办法&quot;&gt;&lt;/a&gt;解决办法&lt;/h2&gt;&lt;p&gt;1.经过测试,发现修改 Host App 的 info.plist 里的 Bundle Name 为中文可解决&lt;/p&gt;
&lt;p&gt;但是这个会导致一些其他问题,而且不优雅~ so ,我们一开始就拒绝了&lt;/p&gt;
&lt;p&gt;2.在 infoplist.strings 里,增加如下字段(记得添加齐全,别漏)&lt;/p&gt;
&lt;figure class=&quot;highlight mipsasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&quot;CFBundleName&quot;&lt;/span&gt; =&lt;span class=&quot;string&quot;&gt;&quot;我是一个中文&quot;&lt;/span&gt;&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;最终效果&quot;&gt;&lt;a href=&quot;#最终效果&quot; class=&quot;headerlink&quot; title=&quot;最终效果&quot;&gt;&lt;/a&gt;最终效果&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/QQ20151008-2@2x.png&quot; width=&quot;328&quot; height=&quot;328&quot;&gt;&lt;/p&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;缘由&quot;&gt;&lt;a href=&quot;#缘由&quot; class=&quot;headerlink&quot; title=&quot;缘由&quot;&gt;&lt;/a&gt;缘由&lt;/h1&gt;&lt;p&gt;今天 Watch 项目被拒了,原因是 Watch 和 iPhone 端 App 显示名称没有做到全部一致.&lt;/p&gt;
&lt;h1 id=&quot;具体问题
    
    </summary>
    
      <category term="WatchKit" scheme="http://yoursite.com/categories/WatchKit/"/>
    
    
  </entry>
  
  <entry>
    <title>限制textfield输入</title>
    <link href="http://yoursite.com/2015/09/30/%E9%99%90%E5%88%B6textfield%E8%BE%93%E5%85%A5/"/>
    <id>http://yoursite.com/2015/09/30/限制textfield输入/</id>
    <published>2015-09-30T03:01:35.000Z</published>
    <updated>2015-10-10T07:16:10.000Z</updated>
    
    <content type="html">&lt;h1 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;require:&lt;br&gt;项目里经常有一种需求,需要限制用户输入的字数,但是有的PM为了更好的用户体验,允许用户在没有确认前可以无限输入&lt;/p&gt;
&lt;p&gt;optional:&lt;br&gt;1.不允许输入emoji表情&lt;br&gt;2.不允许输入空格等&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;效果&quot;&gt;&lt;a href=&quot;#效果&quot; class=&quot;headerlink&quot; title=&quot;效果&quot;&gt;&lt;/a&gt;效果&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://7xn5aw.com1.z0.glb.clouddn.com/textfield限制输入.gif&quot; width=&quot;200&quot; height=&quot;400&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;分析&quot;&gt;&lt;a href=&quot;#分析&quot; class=&quot;headerlink&quot; title=&quot;分析&quot;&gt;&lt;/a&gt;分析&lt;/h1&gt;&lt;h2 id=&quot;有几种场景&quot;&gt;&lt;a href=&quot;#有几种场景&quot; class=&quot;headerlink&quot; title=&quot;有几种场景&quot;&gt;&lt;/a&gt;有几种场景&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;1.各种输入法&lt;/p&gt;
&lt;p&gt;2.输入非法字符&lt;/p&gt;
&lt;p&gt;3.输入的中文拼音还没选文字就点确定了&lt;/p&gt;
&lt;p&gt;4.你们补充下…&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;实现&quot;&gt;&lt;a href=&quot;#实现&quot; class=&quot;headerlink&quot; title=&quot;实现&quot;&gt;&lt;/a&gt;实现&lt;/h1&gt;&lt;h2 id=&quot;创建一个弹框-监听输入&quot;&gt;&lt;a href=&quot;#创建一个弹框-监听输入&quot; class=&quot;headerlink&quot; title=&quot;创建一个弹框,监听输入&quot;&gt;&lt;/a&gt;创建一个弹框,监听输入&lt;/h2&gt;&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;UIAlertView *alertView = [[UIAlertView alloc] &lt;span class=&quot;string&quot;&gt;initWithTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;message:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;msg&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;delegate:&lt;/span&gt;self &lt;span class=&quot;string&quot;&gt;cancelButtonTitle:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;取消&quot;&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;otherButtonTitles:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;确定&quot;&lt;/span&gt;, nil];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;alertView.alertViewStyle = UIAlertViewStylePlainTextInput;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;UITextField *textFiled = [alertView &lt;span class=&quot;string&quot;&gt;textFieldAtIndex:&lt;/span&gt;&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;textFiled.delegate = self;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//监听输入&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[[NSNotificationCenter defaultCenter] &lt;span class=&quot;string&quot;&gt;addObserver:&lt;/span&gt;self &lt;span class=&quot;string&quot;&gt;selector:&lt;/span&gt;&lt;span class=&quot;meta&quot;&gt;@selector&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;textFiledEditChanged:&lt;/span&gt;)&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;name:&lt;/span&gt;@&lt;span class=&quot;string&quot;&gt;&quot;UITextFieldTextDidChangeNotification&quot;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;object:&lt;/span&gt;textFiled];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[alertView show];&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;blockquote&gt;
&lt;p&gt;记得遵守协议&lt;br&gt;&lt;figure class=&quot;highlight gherkin&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@interface&lt;/span&gt; ViewController ()&lt;span class=&quot;variable&quot;&gt;&amp;lt;UIAlertViewDelegate,UITextFieldDelegate&amp;gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;给定一个限制数&lt;br&gt;&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;meta-keyword&quot;&gt;define&lt;/span&gt; kMaxLableLength 10  &lt;span class=&quot;comment&quot;&gt;//限制10个字符&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;过滤非法文字&quot;&gt;&lt;a href=&quot;#过滤非法文字&quot; class=&quot;headerlink&quot; title=&quot;过滤非法文字&quot;&gt;&lt;/a&gt;过滤非法文字&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;因为咱们要过滤非法字符嘛,那么先把方法准备好,一会儿直接调就好啦&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//过滤非法字符&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)disable_Text:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)text&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;过滤---&amp;gt;%@&quot;&lt;/span&gt;,text);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    text = [text stringByReplacingOccurrencesOfString:&lt;span class=&quot;string&quot;&gt;@&quot; &quot;&lt;/span&gt; withString:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    text = [text stringByReplacingOccurrencesOfString:&lt;span class=&quot;string&quot;&gt;@&quot;\n&quot;&lt;/span&gt; withString:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//过滤emoji表情&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; disable_emoji:text];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;//过滤emoj表情&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)disable_emoji:(&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)text&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSRegularExpression&lt;/span&gt; *regex = [&lt;span class=&quot;built_in&quot;&gt;NSRegularExpression&lt;/span&gt; regularExpressionWithPattern:&lt;span class=&quot;string&quot;&gt;@&quot;[^\\u0020-\\u007E\\u00A0-\\u00BE\\u2E80-\\uA4CF\\uF900-\\uFAFF\\uFE30-\\uFE4F\\uFF00-\\uFFEF\\u0080-\\u009F\\u2000-\\u201f\r\n]&quot;&lt;/span&gt; options:&lt;span class=&quot;built_in&quot;&gt;NSRegularExpressionCaseInsensitive&lt;/span&gt; error:&lt;span class=&quot;literal&quot;&gt;nil&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *modifiedString = [regex stringByReplacingMatchesInString:text&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                               options:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                                 range:&lt;span class=&quot;built_in&quot;&gt;NSMakeRange&lt;/span&gt;(&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;, [text length])&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                                                          withTemplate:&lt;span class=&quot;string&quot;&gt;@&quot;&quot;&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; modifiedString;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;获取输入文字&quot;&gt;&lt;a href=&quot;#获取输入文字&quot; class=&quot;headerlink&quot; title=&quot;获取输入文字&quot;&gt;&lt;/a&gt;获取输入文字&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;这一步我们需要实时获取用户输入的文字,并且交给一个专门的检验方法来检验&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)textFiledEditChanged:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)noti&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *textField = (&lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *)noti.object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; validationText:textField];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;检验文字内容&quot;&gt;&lt;a href=&quot;#检验文字内容&quot; class=&quot;headerlink&quot; title=&quot;检验文字内容&quot;&gt;&lt;/a&gt;检验文字内容&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;检验之前先去掉空格等非法字符吧,调用之前准备好的方法,一步到位过滤完全&lt;br&gt;&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;NSString&lt;/span&gt; *toBeString = [&lt;span class=&quot;keyword&quot;&gt;self &lt;/span&gt;disable_Text:textField&lt;span class=&quot;meta&quot;&gt;.text&lt;/span&gt;]&lt;span class=&quot;comment&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;咱们是不是直接截断就可以了?&lt;br&gt;&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;&lt;span class=&quot;symbol&quot;&gt;NSString&lt;/span&gt; *&lt;span class=&quot;keyword&quot;&gt;strNew &lt;/span&gt;= [NSString &lt;span class=&quot;keyword&quot;&gt;stringWithString:toBeString];&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;[textField setText:[&lt;span class=&quot;keyword&quot;&gt;strNew &lt;/span&gt;&lt;span class=&quot;keyword&quot;&gt;substringToIndex:kMaxLableLength]];&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;项目经理会打死你的…..因为还有各种小细节需要处理呢&lt;/p&gt;
&lt;p&gt;咱们需要判断输入法,英文的直接截断就好啦,中文的咱们要允许他在有光标光亮的状态下可以无限输入文字&lt;/p&gt;
&lt;p&gt;完整代码如下&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;19&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;20&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;21&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;22&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;23&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;24&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;25&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;26&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;27&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;28&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;29&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;30&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;31&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;32&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;33&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;34&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;35&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;36&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;37&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;38&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;39&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;40&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;41&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *)validationText:(&lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *)textField&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//不论中文英文,如果有空格,回车,都要过滤掉&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *toBeString = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; disable_Text:textField.text];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *lang = [textField.textInputMode primaryLanguage];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;%@&quot;&lt;/span&gt;,lang);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;//判断输入法&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; ([lang isEqualToString:&lt;span class=&quot;string&quot;&gt;@&quot;zh-Hans&quot;&lt;/span&gt;]) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UITextRange&lt;/span&gt; *selectedRange = [textField markedTextRange];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UITextPosition&lt;/span&gt; *position = [textField positionFromPosition:selectedRange.start offset:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;      &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (!position) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (toBeString.length&amp;gt;=kMaxLableLength) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                &lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; *strNew = [&lt;span class=&quot;built_in&quot;&gt;NSString&lt;/span&gt; stringWithString:toBeString];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [textField setText:[strNew substringToIndex:kMaxLableLength]];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;                [textField setText:toBeString];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            &lt;span class=&quot;built_in&quot;&gt;NSLog&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;@&quot;输入的英文还没有转化为汉字的状态&quot;&lt;/span&gt;);&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (toBeString.length &amp;gt; kMaxLableLength) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            textField.text = [toBeString substringToIndex:kMaxLableLength];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;            textField.text = toBeString;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; textField.text;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;完&quot;&gt;&lt;a href=&quot;#完&quot; class=&quot;headerlink&quot; title=&quot;完&quot;&gt;&lt;/a&gt;完&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;大功告成!测试下,恩,OK~&lt;/p&gt;
&lt;p&gt;小明:拿给PM秀一下~顺便问问TA晚上约不约~&lt;/p&gt;
&lt;p&gt;PM:秀你妹啊!&lt;br&gt;PM:完个蛋啊!&lt;br&gt;PM:有bug!&lt;br&gt;PM:用户直接点确认怎么办!!!&lt;br&gt;PM:用户体验!用户体验!用户体验!重说三&lt;/p&gt;
&lt;p&gt;小明:😭😭😭😭&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;改bug&quot;&gt;&lt;a href=&quot;#改bug&quot; class=&quot;headerlink&quot; title=&quot;改bug&quot;&gt;&lt;/a&gt;改bug&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;是呀,用户在光标状态下,直接输入一大堆光标咱们是不限制,如果他直接点确认,光标内容也是会被记录的~&lt;/p&gt;
&lt;p&gt;还有个小细节:如果用户一进来,什么都不输入直接点确认~咱们要拦截这个操作~(PM如果有需求的话)&lt;/p&gt;
&lt;p&gt;fix it!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;5&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;6&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;7&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;8&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;9&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;10&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;11&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;12&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;13&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;14&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;15&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;16&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;17&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;18&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)alertView:(&lt;span class=&quot;built_in&quot;&gt;UIAlertView&lt;/span&gt; *)alertView clickedButtonAtIndex:(&lt;span class=&quot;built_in&quot;&gt;NSInteger&lt;/span&gt;)buttonIndex&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (buttonIndex == &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;) &amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *textFiled = [alertView textFieldAtIndex:&lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        [textFiled resignFirstResponder];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//什么都不输入直接返回&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; (textFiled.text.length == &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt;;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;comment&quot;&gt;//用户不选择文字直接确认&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt;.displayLable.text = [&lt;span class=&quot;keyword&quot;&gt;self&lt;/span&gt; validationText:textFiled];&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;        &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &amp;#125;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;完-1&quot;&gt;&lt;a href=&quot;#完-1&quot; class=&quot;headerlink&quot; title=&quot;完&quot;&gt;&lt;/a&gt;完&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;小明终于可以约PM了~&lt;/p&gt;
&lt;p&gt;PS:话说2个大老爷们约啥约~小明的世界我不懂~&lt;/p&gt;
&lt;p&gt;PS:第一次做分享,怎么才能装作经常做的样子,😭😭😭😭😭&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote class=&quot;blockquote-center&quot;&gt;&lt;br&gt;原创文章,转载请注明地址:   &lt;a href=&quot;https://kevinmky.github.io&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://kevinmky.github.io&lt;/a&gt;&lt;br&gt;&lt;/blockquote&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;require:&lt;br&gt;项目里经常有一种需求,需要限制用户输入的字数,但是有的PM为了更好的用户体验,允许用户在没
    
    </summary>
    
      <category term="OC" scheme="http://yoursite.com/categories/OC/"/>
    
    
      <category term="项目技巧" scheme="http://yoursite.com/tags/%E9%A1%B9%E7%9B%AE%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>学习markdown语法</title>
    <link href="http://yoursite.com/2015/09/30/%E5%AD%A6%E4%B9%A0markdown%E8%AF%AD%E6%B3%95/"/>
    <id>http://yoursite.com/2015/09/30/学习markdown语法/</id>
    <published>2015-09-29T16:00:14.000Z</published>
    <updated>2015-10-14T16:16:10.000Z</updated>
    
    <content type="html">&lt;p&gt;详见内&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;1-标题&quot;&gt;&lt;a href=&quot;#1-标题&quot; class=&quot;headerlink&quot; title=&quot;1.标题&quot;&gt;&lt;/a&gt;1.标题&lt;/h1&gt;&lt;h1 id=&quot;三个或更多-就是大标题-放标题下面&quot;&gt;&lt;a href=&quot;#三个或更多-就是大标题-放标题下面&quot; class=&quot;headerlink&quot; title=&quot;三个或更多=就是大标题,===放标题下面&quot;&gt;&lt;/a&gt;三个或更多=就是大标题,===放标题下面&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;大标题例子
===
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;三个或更多-就是小标题&quot;&gt;&lt;a href=&quot;#三个或更多-就是小标题&quot; class=&quot;headerlink&quot; title=&quot;三个或更多-就是小标题&quot;&gt;&lt;/a&gt;三个或更多-就是小标题&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;小标题例子
---
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;一级标题用1个&quot;&gt;&lt;a href=&quot;#一级标题用1个&quot; class=&quot;headerlink&quot; title=&quot;一级标题用1个&quot;&gt;&lt;/a&gt;一级标题用1个&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;# 我是一级标题(#后有个空格)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&quot;二级标题用2个&quot;&gt;&lt;a href=&quot;#二级标题用2个&quot; class=&quot;headerlink&quot; title=&quot;二级标题用2个&quot;&gt;&lt;/a&gt;二级标题用2个&lt;/h2&gt;&lt;pre&gt;&lt;code&gt;## 二级标题用2个#
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&quot;and-so-on&quot;&gt;&lt;a href=&quot;#and-so-on&quot; class=&quot;headerlink&quot; title=&quot;and so on&quot;&gt;&lt;/a&gt;and so on&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;###...依次类推吧,一共只有6级
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;2-字体&quot;&gt;&lt;a href=&quot;#2-字体&quot; class=&quot;headerlink&quot; title=&quot;2.字体&quot;&gt;&lt;/a&gt;2.字体&lt;/h1&gt;&lt;h2 id=&quot;斜体&quot;&gt;&lt;a href=&quot;#斜体&quot; class=&quot;headerlink&quot; title=&quot;斜体&quot;&gt;&lt;/a&gt;斜体&lt;/h2&gt;&lt;p&gt;将需要设置为斜体的文字两端使用1个“*”或者“_”夹起来,注意符号与字之间不要有空格&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;*斜不斜*
_斜不斜_
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;斜不斜&lt;/em&gt;&lt;br&gt;&lt;em&gt;斜不斜&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;粗体&quot;&gt;&lt;a href=&quot;#粗体&quot; class=&quot;headerlink&quot; title=&quot;粗体&quot;&gt;&lt;/a&gt;粗体&lt;/h2&gt;&lt;p&gt;将需要设置为斜体的文字两端使用2个“*”或者“_”夹起来&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;**粗不粗**
__粗不粗__
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;粗不粗&lt;/strong&gt;&lt;br&gt;&lt;strong&gt;粗不粗&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 id=&quot;3-无序列表&quot;&gt;&lt;a href=&quot;#3-无序列表&quot; class=&quot;headerlink&quot; title=&quot;3.无序列表&quot;&gt;&lt;/a&gt;3.无序列表&lt;/h1&gt;&lt;p&gt;一个 -/+/* (符号后面有空格哦)后面拼接一段话,就是一个无序列表&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- 无序例子1
+ 无序例子2
* 无序例子3
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;4-有序列表&quot;&gt;&lt;a href=&quot;#4-有序列表&quot; class=&quot;headerlink&quot; title=&quot;4.有序列表&quot;&gt;&lt;/a&gt;4.有序列表&lt;/h1&gt;&lt;p&gt;有序列表大致同无序列表,不过是用数字哦&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;1. 数字不能省略但是可以无序,老规矩(点号后面的空格不能省略)
2. 同上
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;5-嵌套列表&quot;&gt;&lt;a href=&quot;#5-嵌套列表&quot; class=&quot;headerlink&quot; title=&quot;5.嵌套列表&quot;&gt;&lt;/a&gt;5.嵌套列表&lt;/h1&gt;&lt;p&gt;嵌套列表,无非就是前面+个空格&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- 嵌套1层,用- 做前缀,注意空格
 + 嵌套2层,是起一行,在符号面前加一个空格,再用+ (注意还是有空格)
 + 嵌套2层,同上
  - 嵌套3层了,同上,符号前面在上面的基础上再加一个空格
- 还是嵌套1层,和第一个一样就可以了
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;5-我是漂亮的分割线-线-线-线-线-线-线-线&quot;&gt;&lt;a href=&quot;#5-我是漂亮的分割线-线-线-线-线-线-线-线&quot; class=&quot;headerlink&quot; title=&quot;5.我是漂亮的分割线~线~线~线~线~线~线~线~&quot;&gt;&lt;/a&gt;5.我是漂亮的分割线~线~线~线~线~线~线~线~&lt;/h1&gt;&lt;pre&gt;&lt;code&gt;---  直接用三条-,就是分割线,后面不要加任何东西
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;6-文字超链接&quot;&gt;&lt;a href=&quot;#6-文字超链接&quot; class=&quot;headerlink&quot; title=&quot;6.文字超链接&quot;&gt;&lt;/a&gt;6.文字超链接&lt;/h1&gt;&lt;p&gt;直接上文字,要显示的文字用[]包起来,后面紧跟一个(),(里面第一个参数写链接地址,然后空格 ,打””,”里面当然写上tip”)&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://kevinmky.github.io/&quot; title=&quot;KevinMKY的新博客哟~客官欢迎常来哟&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;我是屌屌的超链接&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;[我是屌屌的超链接](http://kevinmky.github.io/ &amp;quot;KevinMKY的新博客哟~客官欢迎常来哟&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;7-直接显示链接地址&quot;&gt;&lt;a href=&quot;#7-直接显示链接地址&quot; class=&quot;headerlink&quot; title=&quot;7.直接显示链接地址&quot;&gt;&lt;/a&gt;7.直接显示链接地址&lt;/h1&gt;&lt;p&gt;直接上文字,&amp;lt;&amp;gt;内些链接就可以了&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://kevinmky.github.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://kevinmky.github.io/&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;http://kevinmky.github.io/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;8-图片&quot;&gt;&lt;a href=&quot;#8-图片&quot; class=&quot;headerlink&quot; title=&quot;8.图片&quot;&gt;&lt;/a&gt;8.图片&lt;/h1&gt;&lt;p&gt;A.不指定图片大小,直接又大多放多大(就是任性).&lt;br&gt;  图片地址可以接外部地址,也可以是文件内地址&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/avatar.jpg&quot; alt=&quot;这里是图片下方的描述&quot;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;![这里是图片下方的描述](/path/to/img.jpg)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;B.指定大小的用IMG语法&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/avatar.jpg&quot; width=&quot;128&quot; height=&quot;128&quot; alt=&quot;黑眼圈的猫咪&quot;&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;img src=&amp;quot;/images/avatar.jpg&amp;quot;  width=&amp;quot;128&amp;quot; height=&amp;quot;128&amp;quot; alt=&amp;quot;黑眼圈的猫咪&amp;quot; /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;9-标记代码块&quot;&gt;&lt;a href=&quot;#9-标记代码块&quot; class=&quot;headerlink&quot; title=&quot;9.标记代码块&quot;&gt;&lt;/a&gt;9.标记代码块&lt;/h1&gt;&lt;p&gt;在每行想要当成代码块显示的文字前加上四个空格,或者按一下tab即可,记得和上一行的文字要隔开(打个回车)&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;空格 空格 空格 空格 code
或
TAB code
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;想要给一大段代码标记,2个方法&lt;/p&gt;
&lt;p&gt;A.整段代码前后分别加&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;pre&amp;gt;&amp;lt;code&amp;gt;
整段代码,效果如下,没有高亮
&amp;lt;/code&amp;gt;\&amp;lt;/pre&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;
- (void)textFiledEditChanged:(NSNotification *)obj
{

UITextField *textField = (UITextField *)obj.object;

}
&lt;/code&gt;&lt;/pre&gt;


&lt;p&gt;B.每一行都加4空格或TAB,就会高亮显示部分&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- (void)textFiledEditChanged:(NSNotification *)obj
{

    UITextField *textField = (UITextField *)obj.object;

}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;C.用三个`上下夹击一整段代码,`之间不要有空格&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;` ` `
- (void)textFiledEditChanged:(NSNotification *)obj
{

    UITextField *textField = (UITextField *)obj.object;

}
` ` `
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;效果如下(推荐这种,可读性更强,使用也便捷)&lt;br&gt;&lt;figure class=&quot;highlight objectivec&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;2&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;3&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;4&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;- (&lt;span class=&quot;keyword&quot;&gt;void&lt;/span&gt;)textFiledEditChanged:(&lt;span class=&quot;built_in&quot;&gt;NSNotification&lt;/span&gt; *)obj&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#123;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *textField = (&lt;span class=&quot;built_in&quot;&gt;UITextField&lt;/span&gt; *)obj.object;&lt;/div&gt;&lt;div class=&quot;line&quot;&gt;&amp;#125;&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;10-注释&quot;&gt;&lt;a href=&quot;#10-注释&quot; class=&quot;headerlink&quot; title=&quot;10.注释&quot;&gt;&lt;/a&gt;10.注释&lt;/h1&gt;&lt;p&gt;A.块注释&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过在文字开头添加“&amp;gt;”表示块注释。（当&amp;gt;和文字之间添加五个blank时，块注释的文字会有变化。）&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;我就是屌屌的块注释&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;我就是屌屌的块注释
&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;
&lt;pre&gt;&lt;code&gt;\&amp;gt;我就是屌屌的块注释     (忽略前面那个\,只需要一个&amp;gt;即可)

\&amp;gt;     我就是屌屌的块注释     (此处有5个空格,忽略前面那个\,只需要一个&amp;gt;即可)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;B.只有作者可见的注释,用下面这个&amp;lt;!-- 注释 --&gt;即可&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- 注释 --&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;11-转义&quot;&gt;&lt;a href=&quot;#11-转义&quot; class=&quot;headerlink&quot; title=&quot;11.转义&quot;&gt;&lt;/a&gt;11.转义&lt;/h1&gt;&lt;p&gt;加上一个\即可&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Markdown中的转义字符为\，转义的有：
\\ 反斜杠
\` 反引号
\* 星号
\_ 下划线
\{\} 大括号
\[\] 中括号
\(\) 小括号
\# 井号
\+ 加号
\- 减号
\. 英文句号
\! 感叹号
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id=&quot;12-划线部分&quot;&gt;&lt;a href=&quot;#12-划线部分&quot; class=&quot;headerlink&quot; title=&quot;12.划线部分&quot;&gt;&lt;/a&gt;12.划线部分&lt;/h1&gt;&lt;p&gt;&lt;del&gt;我是假的,去掉我&lt;/del&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight haml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;~~我是假的,去掉我~~&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h1 id=&quot;13-文字背景色&quot;&gt;&lt;a href=&quot;#13-文字背景色&quot; class=&quot;headerlink&quot; title=&quot;13.文字背景色&quot;&gt;&lt;/a&gt;13.文字背景色&lt;/h1&gt;&lt;p&gt;&lt;code&gt;我有背景色&lt;/code&gt;,用2个`包围就可以了&lt;/p&gt;
&lt;figure class=&quot;highlight autohotkey&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;`我有背景色`&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
&lt;h1 id=&quot;14-换行&quot;&gt;&lt;a href=&quot;#14-换行&quot; class=&quot;headerlink&quot; title=&quot;14.换行&quot;&gt;&lt;/a&gt;14.换行&lt;/h1&gt;&lt;figure class=&quot;highlight armasm&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;直接用&amp;lt;&lt;span class=&quot;keyword&quot;&gt;br &lt;/span&gt;/&amp;gt;,注意空格&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;hr&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;详见内&lt;br&gt;
    
    </summary>
    
      <category term="杂记" scheme="http://yoursite.com/categories/%E6%9D%82%E8%AE%B0/"/>
    
    
      <category term="markdown" scheme="http://yoursite.com/tags/markdown/"/>
    
  </entry>
  
</feed>
